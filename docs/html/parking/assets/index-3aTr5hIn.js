import{r as Fe,g as se,R as G,a as T,L as ne,E as Ue}from"./vendor-echarts-nZu8rBDa.js";import{r as Oe}from"./vendor-react-BVyvVbwp.js";import{r as Ge}from"./vendor-utils-F0zOxUcV.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();var X={exports:{}},H={};var ie;function Me(){if(ie)return H;ie=1;var e=Fe(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function u(d,c,m){var g,C={},w=null,p=null;m!==void 0&&(w=""+m),c.key!==void 0&&(w=""+c.key),c.ref!==void 0&&(p=c.ref);for(g in c)r.call(c,g)&&!o.hasOwnProperty(g)&&(C[g]=c[g]);if(d&&d.defaultProps)for(g in c=d.defaultProps,c)C[g]===void 0&&(C[g]=c[g]);return{$$typeof:t,type:d,key:w,ref:p,props:C,_owner:n.current}}return H.Fragment=a,H.jsx=u,H.jsxs=u,H}var le;function Ve(){return le||(le=1,X.exports=Me()),X.exports}var s=Ve(),z={},ce;function $e(){if(ce)return z;ce=1;var e=Oe();return z.createRoot=e.createRoot,z.hydrateRoot=e.hydrateRoot,z}var He=$e();const qe=se(He);var Q={exports:{}},ee,ue;function We(){if(ue)return ee;ue=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return ee=e,ee}var te,de;function Ke(){if(de)return te;de=1;var e=We();function t(){}function a(){}return a.resetWarningCache=t,te=function(){function r(u,d,c,m,g,C){if(C!==e){var w=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw w.name="Invariant Violation",w}}r.isRequired=r;function n(){return r}var o={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:n,element:r,elementType:r,instanceOf:n,node:r,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:a,resetWarningCache:t};return o.PropTypes=o,o},te}var pe;function Be(){return pe||(pe=1,Q.exports=Ke()()),Q.exports}var ze=Be();const v=se(ze);class we extends G.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Error caught by boundary:",t,a),this.setState({errorInfo:a})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()};render(){return this.state.hasError?s.jsx("div",{className:"error-boundary",children:s.jsxs("div",{className:"error-content",children:[s.jsx("h1",{children:"ðŸš¨ Oops! Something went wrong"}),s.jsx("p",{className:"error-message",children:"The application encountered an unexpected error."}),this.state.error&&s.jsxs("details",{className:"error-details",children:[s.jsx("summary",{children:"Error Details"}),s.jsx("pre",{children:this.state.error.toString()}),this.state.errorInfo&&s.jsx("pre",{children:this.state.errorInfo.componentStack})]}),s.jsx("button",{onClick:this.handleReset,className:"error-reset-btn",children:"ðŸ”„ Reload Application"})]})}):this.props.children}}we.propTypes={children:v.node.isRequired};const je=T.createContext(),Ee=({children:e})=>{const[t,a]=T.useState(localStorage.getItem("parking_theme")==="light");T.useEffect(()=>{t?(document.body.classList.remove("dark"),localStorage.setItem("parking_theme","light")):(document.body.classList.add("dark"),localStorage.setItem("parking_theme","dark"))},[t]);const r=()=>a(!t);return s.jsx(je.Provider,{value:{isLight:t,toggleTheme:r},children:e})};Ee.propTypes={children:v.node.isRequired};const Le=()=>T.useContext(je);var Je=Ge();const Ye=se(Je),me=e=>{let t;const a=new Set,r=(m,g)=>{const C=typeof m=="function"?m(t):m;if(!Object.is(C,t)){const w=t;t=g??(typeof C!="object"||C===null)?C:Object.assign({},t,C),a.forEach(p=>p(t,w))}},n=()=>t,d={setState:r,getState:n,getInitialState:()=>c,subscribe:m=>(a.add(m),()=>a.delete(m))},c=t=e(r,n,d);return d},Ze=(e=>e?me(e):me),Xe=e=>e;function Qe(e,t=Xe){const a=G.useSyncExternalStore(e.subscribe,G.useCallback(()=>t(e.getState()),[e,t]),G.useCallback(()=>t(e.getInitialState()),[e,t]));return G.useDebugValue(a),a}const he=e=>{const t=Ze(e),a=r=>Qe(t,r);return Object.assign(a,t),a},et=(e=>e?he(e):he),S=et(e=>({realtimeData:[],realtimeLoading:!0,realtimeError:null,lastRealtimeUpdate:null,historyData:[],historyLoading:!1,lastHistoryUpdate:null,fetchInProgress:!1,refreshCallback:null,stopAutoRefresh:null,cacheCleared:!1,setRealtimeData:a=>e({realtimeData:a}),setRealtimeLoading:a=>e({realtimeLoading:a}),setRealtimeError:a=>e({realtimeError:a}),setLastRealtimeUpdate:a=>e({lastRealtimeUpdate:a}),setHistoryData:a=>e({historyData:a}),setHistoryLoading:a=>e({historyLoading:a}),setLastHistoryUpdate:a=>e({lastHistoryUpdate:a}),setFetchInProgress:a=>e({fetchInProgress:a}),setRefreshCallback:a=>e({refreshCallback:a}),setStopAutoRefresh:a=>e({stopAutoRefresh:a}),setCacheCleared:a=>e({cacheCleared:a}),updateRealtimeState:a=>e(a),updateHistoryState:a=>e(a),resetStore:()=>e({realtimeData:[],realtimeLoading:!0,realtimeError:null,lastRealtimeUpdate:null,historyData:[],historyLoading:!1,lastHistoryUpdate:null,fetchInProgress:!1,refreshCallback:null})})),Ie=async()=>{const e=S.getState().refreshCallback;e?await e():console.warn("Refresh callback not set yet")},Ae=()=>{try{typeof localStorage<"u"&&(localStorage.removeItem("parking_realtime_cache"),localStorage.removeItem("parking_history_cache")),S.setState({fetchInProgress:!1,cacheCleared:!0});const e=S.getState().stopAutoRefresh;if(typeof e=="function")try{e()}catch(t){console.warn("stopAutoRefresh failed",t)}console.log("Cache cleared and auto-refresh stopped")}catch(e){console.error("clearCache failed",e)}};typeof window<"u"&&(window.clearCache=Ae);const tt=T.createContext(),at=["https://gd.zaparkuj.pl/api/freegroupcountervalue.json","https://gd.zaparkuj.pl/api/freegroupcountervalue-green.json"],rt="https://corsproxy.io/?",st="https://docs.google.com/spreadsheets/d/e/2PACX-1vTwLNDbg8KjlVHsZWj9JUnO_OBIyZaRgZ4gZ8_Gbyly2J3f6rlCW6lDHAihwbuLhxWbBkNMI1wdWRAq/pub?gid=411529798&single=true&output=csv",ot="https://docs.google.com/forms/d/e/1FAIpQLSdeQ-rmw_VfOidGmtSNb9DLkt1RfPdduu-jH898sf3lhj17LA/formResponse",J={GREENDAY_VALUE:"entry.2026993163",GREENDAY_TIME:"entry.51469670",UNI_VALUE:"entry.1412144904",UNI_TIME:"entry.364658642"},ge="parking_realtime_cache",re="parking_history_cache",F={GD_TIME:"gd_time",GD_VALUE:"greenday free",UNI_TIME:"uni_time",UNI_VALUE:"uni free"},fe=e=>e?e.trim().toLowerCase():"",nt=(e,t)=>{if(!e)return null;const a=fe(t);return Object.keys(e).find(r=>fe(r)===a)||null},Z=(e,t)=>{const a=nt(e,t);if(!a)return;const r=e[a];return typeof r=="string"?r.trim():r},it=e=>{if(!e)return null;const t=e.includes("T")?e:e.replace(" ","T"),a=new Date(t);return Number.isNaN(a.getTime())?null:a},ye=(e,t,a)=>{if(!e)return null;const r=Z(e,t),n=it(r);if(!n)return null;const o=Z(e,a),u=o==null||o===""?null:Number(o);return{raw:r,date:n,value:Number.isNaN(u)?null:u}},lt=e=>{if(!e||e.length===0)return{gd:null,uni:null};const t=e[e.length-1];return{gd:ye(t,F.GD_TIME,F.GD_VALUE),uni:ye(t,F.UNI_TIME,F.UNI_VALUE)}},xe=(e=[])=>{const t=new Set,a=[];return e.forEach(r=>{const n=Z(r,F.GD_TIME)||"",o=Z(r,F.UNI_TIME)||"",u=`${n}|||${o}`;t.has(u)||(t.add(u),a.push(r))}),a},be=e=>{if(!e||!e.Timestamp)return null;const t=e.Timestamp.trim();if(!t)return null;const a=t.includes("T")?t:t.replace(" ","T"),r=new Date(a);if(Number.isNaN(r.getTime()))return null;const n=Number(e.CurrentFreeGroupCounterValue);return{raw:t,date:r,value:Number.isNaN(n)?null:n}},ct=(e=[])=>Array.isArray(e)?e.map(t=>({...t||{}})):[],ut=(e,t)=>({[F.GD_TIME]:e?.Timestamp||"",[F.GD_VALUE]:e?.CurrentFreeGroupCounterValue??"",[F.UNI_TIME]:t?.Timestamp||"",[F.UNI_VALUE]:t?.CurrentFreeGroupCounterValue??""}),Se=()=>{if(typeof localStorage>"u")return{rows:[],timestamp:null,last:{gd:null,uni:null}};const e=localStorage.getItem(re);if(!e)return{rows:[],timestamp:null,last:{gd:null,uni:null}};try{const t=JSON.parse(e),a=Array.isArray(t.data)?t.data:[];return{rows:a,timestamp:t.timestamp||null,last:lt(a)}}catch(t){return console.error("Failed to parse history cache snapshot:",t),{rows:[],timestamp:null,last:{gd:null,uni:null}}}},De=({children:e})=>{const t=S(i=>i.setRealtimeData),a=S(i=>i.setRealtimeLoading),r=S(i=>i.setRealtimeError),n=S(i=>i.setLastRealtimeUpdate),o=S(i=>i.setHistoryData),u=S(i=>i.setHistoryLoading),d=S(i=>i.setLastHistoryUpdate),c=S(i=>i.setRefreshCallback),m=S(i=>i.setStopAutoRefresh),g=S(i=>i.historyData),C=T.useRef(!1),w=S(i=>i.cacheCleared),p=T.useCallback(i=>{const y=Array.isArray(i)?i:[],f=new Date;o(y),d(f);try{localStorage.setItem(re,JSON.stringify({data:y,timestamp:f.toISOString()})),console.log("History cache updated")}catch(l){console.error("Failed to cache history data:",l)}},[o,d]),O=T.useCallback(async i=>{try{const y=i[0],f=i[1];if(!y||!f){console.log("Missing data for form submission");return}const l=y.CurrentFreeGroupCounterValue||0,_=y.Timestamp||"",h=f.CurrentFreeGroupCounterValue||0,b=f.Timestamp||"",R=new URLSearchParams;R.append(J.GREENDAY_VALUE,l.toString()),R.append(J.GREENDAY_TIME,_),R.append(J.UNI_VALUE,h.toString()),R.append(J.UNI_TIME,b),console.log("Submitting to Google Form:",{greenDay:{value:l,time:_},uni:{value:h,time:b}}),await fetch(ot,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:R.toString(),mode:"no-cors"}),console.log("Form submission completed")}catch(y){console.error("Failed to submit to Google Form:",y)}},[]),D=T.useCallback(async()=>{if(w){console.log("Cache cleared â€” skipping history fetch");return}u(!0);try{const y=await(await fetch(`${st}&time=${Date.now()}`,{cache:"no-store"})).text();Ye.parse(y,{header:!0,skipEmptyLines:!0,complete:f=>{const l=xe(f.data||[]);console.log("CSV fetched, parsed, and deduplicated"),p(l),u(!1)}})}catch(i){console.error("Failed to fetch history data:",i),u(!1)}},[p,u,w]),x=T.useCallback(async i=>{try{const y=be(i[0]),f=be(i[1]);console.log("API timestamps:",{gd:y?.date?.toISOString(),uni:f?.date?.toISOString()});let l=Se();l.rows.length&&g.length===0&&(o(l.rows),l.timestamp&&d(new Date(l.timestamp)));const _=!y?.date||l.last.gd?.date&&y.date.getTime()<=l.last.gd.date.getTime(),h=!f?.date||l.last.uni?.date&&f.date.getTime()<=l.last.uni.date.getTime();if(l.rows.length>0&&_&&h){console.log("Fast path hit â€” cache already covers API timestamps");return}console.log("Slow path triggered â€” fetching CSV for reconciliation"),await D(),l=Se(),l.rows.length&&(o(l.rows),l.timestamp&&d(new Date(l.timestamp)));const R=y?.date?!l.last.gd?.date||y.date.getTime()>l.last.gd.date.getTime():!1,P=f?.date?!l.last.uni?.date||f.date.getTime()>l.last.uni.date.getTime():!1;if(!R&&!P){console.log("After reconciliation, no newer timestamps detected");return}const E=ct(i);for(;E.length<2;)E.push({});if(l.last.gd?.date){const L=y?.date;(!L||L.getTime()<l.last.gd.date.getTime())&&(E[0]={...E[0],Timestamp:l.last.gd.raw,CurrentFreeGroupCounterValue:l.last.gd.value??E[0].CurrentFreeGroupCounterValue??0})}if(l.last.uni?.date){const L=f?.date;(!L||L.getTime()<l.last.uni.date.getTime())&&(E[1]={...E[1],Timestamp:l.last.uni.raw,CurrentFreeGroupCounterValue:l.last.uni.value??E[1].CurrentFreeGroupCounterValue??0})}await O(E);const U=xe([...l.rows,ut(E[0],E[1])]);p(U)}catch(y){console.error("Error checking history update:",y)}},[D,g.length,p,O,o,d]),N=T.useCallback(async()=>{if(w){console.log("Cache cleared â€” skipping realtime fetch");return}if(C.current){console.log("Fetch already in progress, skipping...");return}C.current=!0,a(!0),r(null);try{const i=localStorage.getItem(ge);if(i)try{const l=JSON.parse(i);t(l.data),n(new Date(l.timestamp)),console.log("Real-time cache loaded")}catch(l){console.error("Failed to parse real-time cache:",l)}const y=await Promise.all(at.map(l=>fetch(`${rt}${encodeURIComponent(l+"?time="+Date.now())}`).then(_=>_.ok?_.json():Promise.reject(`HTTP ${_.status}`))));t(y);const f=new Date;n(f);try{localStorage.setItem(ge,JSON.stringify({data:y,timestamp:f.toISOString()}))}catch(l){console.error("Failed to cache real-time data:",l)}await x(y)}catch(i){console.error("Failed to fetch real-time data:",i),r(i.toString())}finally{a(!1),C.current=!1}},[t,a,r,n,x,w]);T.useEffect(()=>{const i=localStorage.getItem(re);if(i)try{const y=JSON.parse(i);o(y.data),d(new Date(y.timestamp)),console.log("History cache loaded on mount")}catch(y){console.error("Failed to load history cache on mount:",y)}},[o,d]),T.useEffect(()=>{if(w){console.log("Cache cleared â€” skipping initial realtime fetch and auto-refresh");return}N();const i=setInterval(N,300*1e3);try{m(()=>()=>clearInterval(i))}catch(y){console.warn("Failed to register stopAutoRefresh",y)}return()=>clearInterval(i)},[N,m,w]);const I=T.useCallback(async()=>{console.log("Manual refresh triggered"),await N()},[N]);T.useEffect(()=>{c(I)},[I,c]);const j=S(i=>i.realtimeData),A=S(i=>i.realtimeLoading),W=S(i=>i.realtimeError),K=S(i=>i.lastRealtimeUpdate),M=S(i=>i.historyLoading),$=S(i=>i.lastHistoryUpdate),B={realtimeData:j,realtimeLoading:A,realtimeError:W,lastRealtimeUpdate:K,historyData:g,historyLoading:M,lastHistoryUpdate:$,refresh:I};return s.jsx(tt.Provider,{value:B,children:e})};De.propTypes={children:v.node.isRequired};const oe=({title:e,shortTitle:t,icon:a,onRefresh:r,updateStatus:n,currentView:o,setView:u,children:d})=>{const{isLight:c,toggleTheme:m}=Le();return s.jsxs("header",{className:"header-controls",role:"banner",children:[s.jsxs("div",{className:"header-title-group",children:[s.jsxs("h1",{children:[s.jsx("span",{className:"title-icon",role:"img","aria-label":`${e} icon`,children:a}),s.jsxs("span",{className:"title-text-full",children:[" ",e]}),s.jsxs("span",{className:"title-text-short",children:[" ",t||e]})]}),s.jsx("div",{className:"status-info",role:"status","aria-live":"polite",children:n})]}),s.jsxs("div",{className:"header-actions",role:"navigation","aria-label":"Main navigation",children:[d,(typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams).has("clear_cache")?s.jsxs("button",{className:"nav-btn",onClick:()=>Ae(),"aria-label":"Clear cache",children:[s.jsx("span",{className:"btn-icon",role:"img","aria-label":"Broom icon",children:"ðŸ§¹"}),s.jsx("span",{className:"btn-text",children:"Clear Cache"})]}):r?s.jsxs("button",{className:"nav-btn",onClick:r,"aria-label":"Refresh data",children:[s.jsx("span",{className:"btn-icon",role:"img","aria-label":"Refresh icon",children:"âŸ³"}),s.jsx("span",{className:"btn-text",children:"Refresh"})]}):null,o==="stats"&&s.jsxs("button",{className:"nav-btn",onClick:()=>u("dashboard"),"aria-label":"Go to dashboard",children:[s.jsx("span",{className:"btn-icon",role:"img","aria-label":"Home icon",children:"ðŸ "}),s.jsx("span",{className:"btn-text",children:"Dashboard"})]}),o==="dashboard"&&s.jsxs("button",{className:"nav-btn",onClick:()=>u("stats"),"aria-label":"Go to statistics",children:[s.jsx("span",{className:"btn-icon",role:"img","aria-label":"Chart icon",children:"ðŸ“Š"}),s.jsx("span",{className:"btn-text",children:"Statistics"})]}),s.jsx("button",{className:"theme-toggle",onClick:m,"aria-label":c?"Switch to dark theme":"Switch to light theme",children:c?"ðŸŒ™":"â˜€ï¸"})]})]})};oe.propTypes={title:v.string.isRequired,shortTitle:v.string,icon:v.string.isRequired,onRefresh:v.func,updateStatus:v.string.isRequired,currentView:v.oneOf(["dashboard","stats"]).isRequired,setView:v.func.isRequired,children:v.node};const Ce={"Green Day":187,"Uni Wroc":41},q=30,dt=e=>e?e==="Bank_1"?"Uni Wroc":e:"Unknown",V=(e,t=new Date)=>{if(!e)return 1/0;const a=new Date(e.replace(" ","T"));return Math.max(0,Math.floor((t-a)/1e3/60))},pt=e=>{if(!Number.isFinite(e))return{display:"--",aria:"Data age unavailable"};const t=Math.max(0,Math.round(e));if(t<60){const c=`${t} min ago`,m=`Data from ${t} minute${t===1?"":"s"} ago`;return{display:c,aria:m}}if(t<1440){const c=Math.round(t/60),m=`${c} h ago`,g=`Data from ${c} hour${c===1?"":"s"} ago`;return{display:m,aria:g}}const a=t/1440,r=Math.round(a*2)/2,o=Number.isInteger(r)?r.toString():r.toFixed(1),u=`${o} d ago`,d=`Data from ${o} day${o==="1"?"":"s"} ago`;return{display:u,aria:d}},Re=e=>Ce[e]||Ce[dt(e)],Ne=(e,t,a=new Date)=>{if(!e||!t)return{approximated:null,original:null,isApproximated:!1,reason:"Missing data"};const r=V(e.Timestamp,a);if(r<q)return{approximated:e.CurrentFreeGroupCounterValue||0,original:e.CurrentFreeGroupCounterValue||0,isApproximated:!1,ageMinutes:r};const n=Re(e.ParkingGroupName),o=Re(t.ParkingGroupName);if(!n||!o)return{approximated:e.CurrentFreeGroupCounterValue||0,original:e.CurrentFreeGroupCounterValue||0,isApproximated:!1,ageMinutes:r,reason:"Unknown capacity"};const u=t.CurrentFreeGroupCounterValue||0,d=u/o,c=Math.round(d*n);return{approximated:c,original:e.CurrentFreeGroupCounterValue||0,isApproximated:!0,ageMinutes:r,freshRatio:d,calculation:`(${u} / ${o}) * ${n} = ${c}`}};let ae=null,ve=null,Te=null;const mt=(e,t=new Date)=>{if(!Array.isArray(e)||e.length===0)return[];if(e.length!==2)return e.map(g=>({...g,approximationInfo:{isApproximated:!1,original:g.CurrentFreeGroupCounterValue||0,approximated:g.CurrentFreeGroupCounterValue||0,ageMinutes:V(g?.Timestamp,t)}}));const a=e[0],r=e[1],n=V(a?.Timestamp,t),o=V(r?.Timestamp,t),u=n>=q&&o<q,d=o>=q&&n<q,c=JSON.stringify({area1Name:a?.ParkingGroupName,area1Value:a?.CurrentFreeGroupCounterValue,area1Timestamp:a?.Timestamp,area1NeedsApprox:u,area2Name:r?.ParkingGroupName,area2Value:r?.CurrentFreeGroupCounterValue,area2Timestamp:r?.Timestamp,area2NeedsApprox:d});if(ve===e&&Te===c&&ae)return ae;const m=[];if(u){const g=Ne(a,r,t);m.push({...a,approximationInfo:g})}else m.push({...a,approximationInfo:{isApproximated:!1,original:a?.CurrentFreeGroupCounterValue||0,approximated:a?.CurrentFreeGroupCounterValue||0,ageMinutes:n}});if(d){const g=Ne(r,a,t);m.push({...r,approximationInfo:g})}else m.push({...r,approximationInfo:{isApproximated:!1,original:r?.CurrentFreeGroupCounterValue||0,approximated:r?.CurrentFreeGroupCounterValue||0,ageMinutes:o}});return ve=e,Te=c,ae=m,m},_e=({data:e,now:t,allOffline:a})=>{const r=V(e.Timestamp,t),{display:n,aria:o}=pt(r);let u="",d=e.ParkingGroupName;d==="Bank_1"&&(d="Uni Wroc");const c=e.approximationInfo||{},m=!!c.isApproximated,g=m?c.approximated:e.CurrentFreeGroupCounterValue||0,C=c.original||e.CurrentFreeGroupCounterValue||0;return m?r>=15?u="age-old":r>5&&(u="age-medium"):a||r>=15?u="age-old":r>5&&(u="age-medium"),s.jsxs("div",{className:"parking-card",role:"article","aria-label":`${d} parking information`,children:[s.jsx("div",{className:"parking-name",children:d}),s.jsxs("div",{className:`free-spots ${u}`,"aria-label":`${g} free parking spaces${m?" (approximated)":""}`,children:[m&&s.jsx("span",{className:"approx-indicator",title:"Approximated value",children:"â‰ˆ"}),g]}),m&&s.jsxs("div",{className:"original-value","aria-label":`Original value: ${C}`,children:["(orig: ",C,")"]}),s.jsx("div",{className:"age-indicator-small","aria-label":o,children:n})]})};_e.propTypes={data:v.shape({ParkingGroupName:v.string.isRequired,CurrentFreeGroupCounterValue:v.number,Timestamp:v.string.isRequired,approximationInfo:v.shape({isApproximated:v.bool,approximated:v.number,original:v.number})}).isRequired,now:v.instanceOf(Date).isRequired,allOffline:v.bool.isRequired};const ke=({setView:e})=>{const t=S(x=>x.realtimeData),a=S(x=>x.realtimeLoading),r=S(x=>x.realtimeError),n=S(x=>x.lastRealtimeUpdate),[o,u]=T.useState(new Date);T.useEffect(()=>{const x=setInterval(()=>u(new Date),1e3);return()=>clearInterval(x)},[]);const d=T.useMemo(()=>mt(t,o),[t,o]),c=d.some(x=>x.approximationInfo?.isApproximated),m=d.reduce((x,N)=>{const I=N.approximationInfo||{},j=I.isApproximated?I.approximated:N.CurrentFreeGroupCounterValue||0;return x+j},0),g=t.reduce((x,N)=>x+(N.CurrentFreeGroupCounterValue||0),0),C=n?`Last update: ${n.toLocaleTimeString("pl-PL")}`:"Loading...",w=t.length>0&&t.every(x=>{const N=new Date(x.Timestamp.replace(" ","T"));return Math.max(0,Math.floor((o-N)/1e3/60))>=1440}),p=()=>{if(d.length===0)return{colorClass:"",statusMessage:"No data available",statusIcon:null,statusLabel:""};let x=0;d.forEach(j=>{const A=V(j.Timestamp,o);x=Math.max(x,A)});let N="",I="";return w?(N="age-old",I="All parking feeds appear offline"):x>=15?(N="age-old",I="Data outdated - figures may not reflect actual free spaces"):x>5?(N="age-medium",I="Data slightly outdated - refresh recommended"):(N="",I="Data is current and reliable"),{colorClass:N,statusMessage:I}},{colorClass:O,statusMessage:D}=p();return s.jsxs(s.Fragment,{children:[s.jsx(oe,{title:"Parking Monitor",icon:"ðŸ…¿ï¸",onRefresh:Ie,updateStatus:C,currentView:"dashboard",setView:e}),s.jsxs("main",{className:"container-main",role:"main","aria-label":"Parking dashboard",children:[s.jsx("div",{className:"subtitle",children:"Real-time parking availability â€¢ UBS WrocÅ‚aw"}),r&&s.jsxs("div",{className:"error",role:"alert","aria-live":"polite",children:[s.jsx("strong",{children:"ERROR:"})," ",r]}),s.jsx("div",{className:"grid-container",role:"list","aria-label":"Parking facilities",children:a&&t.length===0?s.jsx("div",{className:"loader",role:"status","aria-live":"polite",children:"Loading parking data..."}):d.map((x,N)=>s.jsx(_e,{data:x,now:o,allOffline:w},N))}),s.jsx("div",{className:`status-description ${O}`,"aria-label":"Status description",children:D}),s.jsx("div",{className:"status-panel",role:"complementary","aria-label":"Status information",children:s.jsxs("div",{className:"panel-sections-wrapper",children:[s.jsxs("div",{className:"panel-section",children:[s.jsx("div",{className:"status-label",children:"Total Spaces"}),s.jsxs("div",{className:`status-value big-value ${O}`,"aria-label":`Total free spaces: ${a?"loading":m}`,children:[c&&!a&&s.jsx("span",{className:"approx-indicator-small",title:"Includes approximated values",children:"â‰ˆ"}),a?"---":m]}),c&&!a&&s.jsxs("div",{className:"original-total","aria-label":`Original total: ${g}`,children:["(orig: ",g,")"]})]}),s.jsxs("div",{className:"panel-section",children:[s.jsx("div",{className:"status-label",children:"Last Update / Current Time"}),s.jsxs("div",{className:"time-group",children:[s.jsx("span",{"aria-label":`Last updated at ${n?n.toLocaleTimeString("pl-PL"):"unknown"}`,children:n?n.toLocaleTimeString("pl-PL"):"--:--:--"}),s.jsx("span",{className:"status-current-inline","aria-label":`Current time ${o.toLocaleTimeString("pl-PL")}`,children:o.toLocaleTimeString("pl-PL")})]})]}),s.jsxs("div",{className:"panel-section",children:[s.jsx("div",{className:"status-label",children:"Data Status"}),s.jsx("div",{className:"status-value",style:{color:r?"var(--warning)":c?"var(--age-medium)":"var(--success)"},role:"status","aria-live":"polite",children:a?"LOADING":r?"OFFLINE":c?"APPROX":"ONLINE"})]})]})})]})]})};ke.propTypes={setView:v.func.isRequired};const Y={neon:{gd:"#05ffa1",uni:"#01beff"},classic:{gd:"#3b82f6",uni:"#f59e0b"},cyberpunk:{gd:"#00d9ff",uni:"#ff00cc"},modern:{gd:"#10b981",uni:"#6366f1"}},Pe=({setView:e})=>{const t=S(p=>p.historyData),a=S(p=>p.historyLoading),[r,n]=G.useState("neon"),[o,u]=G.useState(!1),{isLight:d}=Le(),[c,m]=T.useState({start:0,end:100}),g=T.useRef(null),C=T.useMemo(()=>{if(!t||t.length===0)return null;const p=d?"#1e293b":"#8b95c9",O=d?"#cbd5e1":"#2d3b6b",D=window.innerWidth<=600,x=new Map,N=new Map;t.forEach(h=>{const b=L=>Object.keys(h).find(k=>k.trim().toLowerCase()===L),R=b("gd_time"),P=b("greenday free"),E=b("uni_time"),U=b("uni free");if(R&&P&&h[R]&&h[P]){const L=h[R].trim(),k=parseFloat(h[P]);isNaN(k)||x.set(L,k)}if(E&&U&&h[E]&&h[U]){const L=h[E].trim(),k=parseFloat(h[U]);isNaN(k)||N.set(L,k)}});const I=h=>Array.from(h.entries()).map(([b,R])=>({t:new Date(b),v:R,raw:b})).filter(b=>!isNaN(b.t.getTime())).sort((b,R)=>b.t-R.t);let j=I(x),A=I(N);const W=h=>{const b=new Set;return h.filter(R=>{const P=`${R.raw}|${R.v}`;return b.has(P)?!1:(b.add(P),!0)})};if(j=W(j),A=W(A),j.length>0&&A.length>0){const h=j[0].t.getTime(),b=A[0].t.getTime();b<h&&(A[0].t=new Date(h),A[0].raw=j[0].raw),h<b&&(j[0].t=new Date(b),j[0].raw=A[0].raw)}const K=[...j.map(h=>h.t.getTime()),...A.map(h=>h.t.getTime())],M=K.length>0?Math.max(...K):null;let $=null;if(M){const h=j.find(R=>R.t.getTime()===M),b=A.find(R=>R.t.getTime()===M);$=(h||b)?.raw}const B=(h,b,R)=>{if(h.length===0)return{solid:[],gaps:[],projections:[]};const P=[],E=[],U=[];for(let k=0;k<h.length;k++)P.push([h[k].raw,h[k].v]);const L=h[h.length-1];return L&&b&&b-L.t.getTime()>1e3&&(U.push([L.raw,L.v]),U.push([R,L.v])),{solid:P,gaps:E,projections:U}},i=B(j,M,$),y=B(A,M,$),f=Y[r],l=j.length>0?"GreenDay":"GreenDay - not found",_=A.length>0?"Uni Wroc":"Uni Wroc - not found";return{backgroundColor:"transparent",animation:!0,animationDuration:300,tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"cross"}},legend:{data:[l,_],top:5,textStyle:{color:p}},grid:{left:D?10:15,right:D?10:15,bottom:D?80:50,top:40,containLabel:!0},xAxis:{type:"time",axisLabel:{color:p,margin:10},axisLine:{lineStyle:{color:O}},splitLine:{show:!1}},yAxis:{type:"value",min:-5,max:200,splitLine:{lineStyle:{color:O,opacity:.3}},axisLabel:{color:p,formatter:h=>h<0?"":h}},dataZoom:[{type:"inside",start:c.start,end:c.end,filterMode:"none"},{type:"slider",start:c.start,end:c.end,bottom:D?40:10,height:D?30:25,textStyle:{color:p,fontSize:D?11:12},filterMode:"none",handleSize:D?"180%":"100%",borderColor:p,fillerColor:"rgba(100, 149, 237, 0.3)",dataBackground:{lineStyle:{color:p,opacity:.5},areaStyle:{color:p,opacity:.2}},moveHandleSize:D?10:7,emphasis:{handleStyle:{borderWidth:2}}}],series:[{name:l,type:"line",data:i.solid,showSymbol:o,lineStyle:{width:3,color:f.gd},itemStyle:{color:f.gd},areaStyle:{color:new ne(0,0,0,1,[{offset:0,color:`${f.gd}33`},{offset:1,color:`${f.gd}00`}])},markLine:{symbol:"none",data:[{yAxis:187,lineStyle:{color:f.gd,type:"dotted",opacity:1},label:{position:"start",formatter:"187",color:f.gd,fontWeight:"bold",fontSize:13}}]}},{name:l,type:"line",data:i.gaps,showSymbol:!1,lineStyle:{width:2,color:f.gd,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:l,type:"line",data:i.projections,showSymbol:!1,lineStyle:{width:1.5,color:f.gd,type:[5,5],opacity:.5},tooltip:{show:!1}},{name:_,type:"line",data:y.solid,showSymbol:o,lineStyle:{width:3,color:f.uni},itemStyle:{color:f.uni},areaStyle:{color:new ne(0,0,0,1,[{offset:0,color:`${f.uni}33`},{offset:1,color:`${f.uni}00`}])},markLine:{symbol:"none",data:[{yAxis:41,lineStyle:{color:f.uni,type:"dotted",opacity:1},label:{position:"start",formatter:"41",color:f.uni,fontWeight:"bold",fontSize:13}}]}},{name:_,type:"line",data:y.gaps,showSymbol:!1,lineStyle:{width:2,color:f.uni,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:_,type:"line",data:y.projections,showSymbol:!1,lineStyle:{width:1.5,color:f.uni,type:[5,5],opacity:.5},tooltip:{show:!1}}]}},[t,r,o,d,c]),w={datazoom:p=>{p.batch&&p.batch[0]?m({start:p.batch[0].start,end:p.batch[0].end}):p.start!==void 0&&p.end!==void 0&&m({start:p.start,end:p.end})}};return s.jsxs("div",{className:"page-wrapper",children:[s.jsx(oe,{title:"Parking History",shortTitle:"Hist",icon:"ðŸ“ˆ",onRefresh:Ie,updateStatus:a?"Updating...":"Ready",currentView:"stats",setView:e,children:s.jsxs("div",{className:"palette-group",children:[s.jsx("span",{className:"palette-label",children:"Palette:"}),Object.keys(Y).map(p=>s.jsx("div",{className:`palette-btn ${r===p?"active":""}`,style:{background:`linear-gradient(135deg, ${Y[p].gd} 50%, ${Y[p].uni} 50%)`},onClick:()=>n(p),title:p.charAt(0).toUpperCase()+p.slice(1)},p)),s.jsxs("button",{className:"palette-toggle-btn",onClick:()=>u(!o),children:["Dots: ",o?"Off":"On"]})]})}),s.jsx("main",{className:"stats-container",children:a&&t.length===0?s.jsx("div",{className:"loader",children:"Loading history data..."}):C?s.jsx(Ue,{ref:g,option:C,style:{height:"100%",width:"100%",touchAction:"none"},onEvents:w,notMerge:!1,lazyUpdate:!0,opts:{renderer:"canvas"}}):s.jsx("div",{className:"loader",children:"No data available to display."})})]})};Pe.propTypes={setView:v.func.isRequired};function ht(){const[e,t]=T.useState("dashboard");return s.jsx(we,{children:s.jsx(Ee,{children:s.jsx(De,{children:e==="dashboard"?s.jsx(ke,{setView:t}):s.jsx(Pe,{setView:t})})})})}const gt=qe.createRoot(document.getElementById("root"));gt.render(s.jsx(G.StrictMode,{children:s.jsx(ht,{})}));
