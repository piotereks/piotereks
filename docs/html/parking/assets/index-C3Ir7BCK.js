import{r as d,L as B,E as Q,R as ee}from"./vendor-echarts-CH7RThay.js";import{r as te,u as se,N as K,B as ae,R as ne,a as H}from"./vendor-react-BMyLEujA.js";import{P as oe}from"./vendor-utils-C-a--0RZ.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function l(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=l(s);fetch(s.href,r)}})();var V={exports:{}},D={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var re=d,ie=Symbol.for("react.element"),le=Symbol.for("react.fragment"),ce=Object.prototype.hasOwnProperty,de=re.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ue={key:!0,ref:!0,__self:!0,__source:!0};function q(i,n,l){var o,s={},r=null,c=null;l!==void 0&&(r=""+l),n.key!==void 0&&(r=""+n.key),n.ref!==void 0&&(c=n.ref);for(o in n)ce.call(n,o)&&!ue.hasOwnProperty(o)&&(s[o]=n[o]);if(i&&i.defaultProps)for(o in n=i.defaultProps,n)s[o]===void 0&&(s[o]=n[o]);return{$$typeof:ie,type:i,key:r,ref:c,props:s,_owner:de.current}}D.Fragment=le;D.jsx=q;D.jsxs=q;V.exports=D;var e=V.exports,U={},Z=te;U.createRoot=Z.createRoot,U.hydrateRoot=Z.hydrateRoot;const J=d.createContext(),me=({children:i})=>{const[n,l]=d.useState(localStorage.getItem("parking_theme")==="light");d.useEffect(()=>{n?(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("parking_theme","light")):(document.documentElement.removeAttribute("data-theme"),localStorage.setItem("parking_theme","dark"))},[n]);const o=()=>l(!n);return e.jsx(J.Provider,{value:{isLight:n,toggleTheme:o},children:i})},X=()=>d.useContext(J),Y=({title:i,icon:n,onRefresh:l,updateStatus:o,children:s})=>{const{isLight:r,toggleTheme:c}=X(),N=se();return e.jsxs("header",{className:"header-controls",children:[e.jsxs("div",{className:"header-title-group",children:[e.jsxs("h1",{children:[e.jsx("span",{className:"title-icon",children:n})," ",i]}),e.jsx("div",{className:"status-info",children:o})]}),e.jsxs("div",{className:"header-actions",children:[s,l&&e.jsxs("button",{className:"nav-btn",onClick:l,children:[e.jsx("span",{style:{marginRight:"8px",fontSize:"1.1rem"},children:"âŸ³"}),e.jsx("span",{className:"btn-text",children:"Refresh"})]}),N.pathname==="/stats"&&e.jsxs(K,{to:"/",className:"nav-btn",children:[e.jsx("span",{style:{marginRight:"8px",fontSize:"1.1rem"},children:"ðŸ "}),e.jsx("span",{className:"btn-text",children:"Dashboard"})]}),N.pathname==="/"&&e.jsxs(K,{to:"/stats",className:"nav-btn",children:[e.jsx("span",{style:{marginRight:"8px",fontSize:"1.1rem"},children:"ðŸ“Š"}),e.jsx("span",{className:"btn-text",children:"Statistics"})]}),e.jsx("button",{className:"theme-toggle",onClick:c,"aria-label":"Toggle theme",children:r?"ðŸŒ™":"â˜€ï¸"})]})]})},pe=["https://gd.zaparkuj.pl/api/freegroupcountervalue.json","https://gd.zaparkuj.pl/api/freegroupcountervalue-green.json"],he="https://corsproxy.io/?",ge=({data:i,now:n})=>{const l=new Date(i.Timestamp.replace(" ","T")),o=Math.max(0,Math.floor((n-l)/1e3/60));let s="";o>=15?s="age-old":o>5&&(s="age-medium");let r=i.ParkingGroupName;return r==="Bank_1"&&(r="Uni Wroc"),e.jsxs("div",{className:"parking-card",children:[e.jsx("div",{className:"parking-name",children:r}),e.jsx("div",{className:`free-spots ${s}`,children:i.CurrentFreeGroupCounterValue||0}),e.jsxs("div",{className:"age-indicator-small",children:[o," min ago"]}),e.jsxs("div",{className:"timestamp-small",children:["@",l.toLocaleTimeString("pl-PL")]})]})},fe=()=>{const[i,n]=d.useState([]),[l,o]=d.useState(!0),[s,r]=d.useState(null),[c,N]=d.useState(null),[L,y]=d.useState(new Date),j=d.useCallback(async()=>{o(!0),r(null);try{const a=await Promise.all(pe.map(f=>fetch(`${he}${encodeURIComponent(f+"?time="+Date.now())}`).then(x=>x.ok?x.json():Promise.reject(`HTTP ${x.status}`))));n(a),N(new Date)}catch(a){r(a.toString())}finally{o(!1)}},[]);d.useEffect(()=>{j();const a=setInterval(()=>y(new Date),1e3),f=setInterval(j,5*60*1e3);return()=>{clearInterval(a),clearInterval(f)}},[j]);const T=i.reduce((a,f)=>a+(f.CurrentFreeGroupCounterValue||0),0),O=c?`Last update: ${c.toLocaleTimeString("pl-PL")}`:"Loading...";return e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"Parking Monitor",icon:"ðŸ…¿ï¸",onRefresh:j,updateStatus:O}),e.jsxs("main",{className:"container",children:[e.jsx("div",{className:"subtitle",children:"Real-time parking availability â€¢ UBS WrocÅ‚aw"}),s&&e.jsxs("div",{className:"error",children:[e.jsx("strong",{children:"ERROR:"})," ",s]}),e.jsx("div",{className:"grid-container",children:l&&i.length===0?e.jsx("div",{className:"loader",children:"Loading parking data..."}):i.map((a,f)=>e.jsx(ge,{data:a,now:L},f))}),e.jsxs("div",{className:"status-panel",children:[e.jsxs("div",{className:"panel-section",children:[e.jsx("div",{className:"status-label",children:"Total Spaces"}),e.jsx("div",{className:"status-value big-value",children:l?"---":T})]}),e.jsxs("div",{className:"panel-section",children:[e.jsx("div",{className:"status-label",children:"Data Status"}),e.jsx("div",{className:"status-value",style:{color:s?"var(--warning)":"var(--success)"},children:l?"LOADING":s?"OFFLINE":"ONLINE"})]}),e.jsxs("div",{className:"panel-section",children:[e.jsx("div",{className:"status-label",children:"Last Update / Current Time"}),e.jsxs("div",{className:"time-group",children:[e.jsx("span",{children:c?c.toLocaleTimeString("pl-PL"):"--:--:--"}),e.jsx("span",{className:"status-current-inline",children:L.toLocaleTimeString("pl-PL")})]})]})]})]})]})},ye="https://docs.google.com/spreadsheets/d/e/2PACX-1vTwLNDbg8KjlVHsZWj9JUnO_OBIyZaRgZ4gZ8_Gbyly2J3f6rlCW6lDHAihwbuLhxWbBkNMI1wdWRAq/pub?gid=411529798&single=true&output=csv",E={neon:{gd:"#05ffa1",uni:"#01beff"},classic:{gd:"#3b82f6",uni:"#f59e0b"},cyberpunk:{gd:"#00d9ff",uni:"#ff00cc"},modern:{gd:"#10b981",uni:"#6366f1"}},xe=()=>{const[i,n]=d.useState([]),[l,o]=d.useState(!0),[s,r]=d.useState("neon"),[c,N]=d.useState(!1),{isLight:L}=X(),y=d.useRef({start:80,end:100}),j=async()=>{o(!0);try{const f=await(await fetch(`${ye}&time=${Date.now()}`)).text();oe.parse(f,{header:!0,skipEmptyLines:!0,complete:x=>{n(x.data),o(!1)}})}catch(a){console.error(a),o(!1)}};d.useEffect(()=>{j()},[]);const T=d.useMemo(()=>{var z;if(!i||i.length===0)return null;const a=L?"#1e293b":"#8b95c9",f=L?"#cbd5e1":"#2d3b6b",x=new Map,$=new Map;i.forEach(t=>{const m=S=>Object.keys(t).find(h=>h.trim().toLowerCase()===S),p=m("gd_time"),v=m("greenday free"),R=m("uni_time"),b=m("uni free");if(p&&v&&t[p]&&t[v]){const S=t[p].trim(),h=parseFloat(t[v]);isNaN(h)||x.set(S,h)}if(R&&b&&t[R]&&t[b]){const S=t[R].trim(),h=parseFloat(t[b]);isNaN(h)||$.set(S,h)}});const F=t=>Array.from(t.entries()).map(([m,p])=>({t:new Date(m),v:p,raw:m})).filter(m=>!isNaN(m.t.getTime())).sort((m,p)=>m.t-p.t),P=F(x),k=F($),W=[...P.map(t=>t.t.getTime()),...k.map(t=>t.t.getTime())],w=W.length>0?Math.max(...W):null;let I=null;if(w){const t=P.find(p=>p.t.getTime()===w),m=k.find(p=>p.t.getTime()===w);I=(z=t||m)==null?void 0:z.raw}const G=(t,m,p)=>{if(t.length===0)return{solid:[],gaps:[],projections:[]};const v=[],R=[],b=[],S=40*60*1e3;for(let g=0;g<t.length;g++)v.push([t[g].raw,t[g].v]),g<t.length-1&&t[g+1].t-t[g].t>S&&(v.push([t[g+1].raw,null]),R.push([t[g].raw,t[g].v],[t[g+1].raw,t[g+1].v],[t[g+1].raw,null]));const h=t[t.length-1];return h&&m&&m-h.t.getTime()>1e3&&(b.push([h.raw,h.v]),b.push([p,h.v])),{solid:v,gaps:R,projections:b}},A=G(P,w,I),M=G(k,w,I),u=E[s],_=P.length>0?"GreenDay":"GreenDay - not found",C=k.length>0?"Uni Wroc":"Uni Wroc - not found";return{backgroundColor:"transparent",animation:!0,tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"cross"}},legend:{data:[_,C],top:5,textStyle:{color:a}},grid:{left:40,right:20,bottom:65,top:40,containLabel:!0},xAxis:{type:"time",axisLabel:{color:a,margin:10},axisLine:{lineStyle:{color:f}},splitLine:{show:!1}},yAxis:{type:"value",min:-5,max:200,splitLine:{lineStyle:{color:f,opacity:.3}},axisLabel:{color:a,formatter:t=>t<0?"":t}},dataZoom:[{type:"inside",start:y.current.start,end:y.current.end,filterMode:"none"},{type:"slider",start:y.current.start,end:y.current.end,bottom:10,height:25,textStyle:{color:a},filterMode:"none"}],series:[{name:_,type:"line",data:A.solid,showSymbol:c,lineStyle:{width:3,color:u.gd},itemStyle:{color:u.gd},areaStyle:{color:new B(0,0,0,1,[{offset:0,color:`${u.gd}33`},{offset:1,color:`${u.gd}00`}])},markLine:{symbol:"none",data:[{yAxis:187,lineStyle:{color:u.gd,type:"dotted",opacity:1},label:{position:"start",formatter:"187",color:u.gd,fontWeight:"bold",fontSize:13}}]}},{name:_,type:"line",data:A.gaps,showSymbol:!1,lineStyle:{width:2,color:u.gd,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:_,type:"line",data:A.projections,showSymbol:!1,lineStyle:{width:1.5,color:u.gd,type:[5,5],opacity:.5},tooltip:{show:!1}},{name:C,type:"line",data:M.solid,showSymbol:c,lineStyle:{width:3,color:u.uni},itemStyle:{color:u.uni},areaStyle:{color:new B(0,0,0,1,[{offset:0,color:`${u.uni}33`},{offset:1,color:`${u.uni}00`}])},markLine:{symbol:"none",data:[{yAxis:41,lineStyle:{color:u.uni,type:"dotted",opacity:1},label:{position:"start",formatter:"41",color:u.uni,fontWeight:"bold",fontSize:13}}]}},{name:C,type:"line",data:M.gaps,showSymbol:!1,lineStyle:{width:2,color:u.uni,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:C,type:"line",data:M.projections,showSymbol:!1,lineStyle:{width:1.5,color:u.uni,type:[5,5],opacity:.5},tooltip:{show:!1}}]}},[i,s,c,L]),O={datazoom:a=>{a.batch&&a.batch[0]?y.current={start:a.batch[0].start,end:a.batch[0].end}:a.start!==void 0&&a.end!==void 0&&(y.current={start:a.start,end:a.end})}};return e.jsxs("div",{className:"page-wrapper",children:[e.jsx(Y,{title:"Parking History",icon:"ðŸ“ˆ",onRefresh:j,updateStatus:l?"Updating...":"Ready",children:e.jsxs("div",{className:"palette-group",children:[e.jsx("span",{className:"palette-label",children:"Palette:"}),Object.keys(E).map(a=>e.jsx("div",{className:`palette-btn ${s===a?"active":""}`,style:{background:`linear-gradient(135deg, ${E[a].gd} 50%, ${E[a].uni} 50%)`},onClick:()=>r(a),title:a.charAt(0).toUpperCase()+a.slice(1)},a)),e.jsxs("button",{className:"palette-toggle-btn",onClick:()=>N(!c),children:["Dots: ",c?"Off":"On"]})]})}),e.jsx("main",{className:"stats-container",children:l&&i.length===0?e.jsx("div",{className:"loader",children:"Loading history data..."}):T?e.jsx(Q,{option:T,style:{height:"100%",width:"100%"},onEvents:O,notMerge:!1,lazyUpdate:!0}):e.jsx("div",{className:"loader",children:"No data available to display."})})]})};function je(){return e.jsx(me,{children:e.jsx(ae,{children:e.jsxs(ne,{children:[e.jsx(H,{path:"/",element:e.jsx(fe,{})}),e.jsx(H,{path:"/stats",element:e.jsx(xe,{})})]})})})}U.createRoot(document.getElementById("root")).render(e.jsx(ee.StrictMode,{children:e.jsx(je,{})}));
