import{r as te,g as X,a as l,L as J,E as se,R as ae}from"./vendor-echarts-nZu8rBDa.js";import{r as ne}from"./vendor-react-BVyvVbwp.js";import{r as oe}from"./vendor-utils-F0zOxUcV.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const f of n.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function h(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(a){if(a.ep)return;a.ep=!0;const n=h(a);fetch(a.href,n)}})();var W={exports:{}},P={};var K;function re(){if(K)return P;K=1;var r=te(),o=Symbol.for("react.element"),h=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function f(d,u,b){var c,v={},N=null,R=null;b!==void 0&&(N=""+b),u.key!==void 0&&(N=""+u.key),u.ref!==void 0&&(R=u.ref);for(c in u)i.call(u,c)&&!n.hasOwnProperty(c)&&(v[c]=u[c]);if(d&&d.defaultProps)for(c in u=d.defaultProps,u)v[c]===void 0&&(v[c]=u[c]);return{$$typeof:o,type:d,key:N,ref:R,props:v,_owner:a.current}}return P.Fragment=h,P.jsx=f,P.jsxs=f,P}var V;function ie(){return V||(V=1,W.exports=re()),W.exports}var e=ie(),M={},Z;function le(){if(Z)return M;Z=1;var r=ne();return M.createRoot=r.createRoot,M.hydrateRoot=r.hydrateRoot,M}var ce=le();const de=X(ce),Y=l.createContext(),ue=({children:r})=>{const[o,h]=l.useState(localStorage.getItem("parking_theme")==="light");l.useEffect(()=>{o?(document.body.classList.remove("dark"),localStorage.setItem("parking_theme","light")):(document.body.classList.add("dark"),localStorage.setItem("parking_theme","dark"))},[o]);const i=()=>h(!o);return e.jsx(Y.Provider,{value:{isLight:o,toggleTheme:i},children:r})},Q=()=>l.useContext(Y),ee=({title:r,shortTitle:o,icon:h,onRefresh:i,updateStatus:a,currentView:n,setView:f,children:d})=>{const{isLight:u,toggleTheme:b}=Q();return e.jsxs("header",{className:"header-controls",children:[e.jsxs("div",{className:"header-title-group",children:[e.jsxs("h1",{children:[e.jsx("span",{className:"title-icon",children:h}),e.jsxs("span",{className:"title-text-full",children:[" ",r]}),e.jsxs("span",{className:"title-text-short",children:[" ",o||r]})]}),e.jsx("div",{className:"status-info",children:a})]}),e.jsxs("div",{className:"header-actions",children:[d,i&&e.jsxs("button",{className:"nav-btn",onClick:i,children:[e.jsx("span",{className:"btn-icon",children:"âŸ³"}),e.jsx("span",{className:"btn-text",children:"Refresh"})]}),n==="stats"&&e.jsxs("button",{className:"nav-btn",onClick:()=>f("dashboard"),children:[e.jsx("span",{className:"btn-icon",children:"ðŸ "}),e.jsx("span",{className:"btn-text",children:"Dashboard"})]}),n==="dashboard"&&e.jsxs("button",{className:"nav-btn",onClick:()=>f("stats"),children:[e.jsx("span",{className:"btn-icon",children:"ðŸ“Š"}),e.jsx("span",{className:"btn-text",children:"Statistics"})]}),e.jsx("button",{className:"theme-toggle",onClick:b,"aria-label":"Toggle theme",children:u?"ðŸŒ™":"â˜€ï¸"})]})]})},me=["https://gd.zaparkuj.pl/api/freegroupcountervalue.json","https://gd.zaparkuj.pl/api/freegroupcountervalue-green.json"],pe="https://corsproxy.io/?",he=({data:r,now:o})=>{const h=new Date(r.Timestamp.replace(" ","T")),i=Math.max(0,Math.floor((o-h)/1e3/60));let a="";i>=15?a="age-old":i>5&&(a="age-medium");let n=r.ParkingGroupName;return n==="Bank_1"&&(n="Uni Wroc"),e.jsxs("div",{className:"parking-card",children:[e.jsx("div",{className:"parking-name",children:n}),e.jsx("div",{className:`free-spots ${a}`,children:r.CurrentFreeGroupCounterValue||0}),e.jsxs("div",{className:"age-indicator-small",children:[i," min ago"]}),e.jsxs("div",{className:"timestamp-small",children:["@",h.toLocaleTimeString("pl-PL")]})]})},fe=({setView:r})=>{const[o,h]=l.useState([]),[i,a]=l.useState(!0),[n,f]=l.useState(null),[d,u]=l.useState(null),[b,c]=l.useState(new Date),v=l.useCallback(async()=>{a(!0),f(null);try{const j=await Promise.all(me.map(s=>fetch(`${pe}${encodeURIComponent(s+"?time="+Date.now())}`).then(L=>L.ok?L.json():Promise.reject(`HTTP ${L.status}`))));h(j),u(new Date)}catch(j){f(j.toString())}finally{a(!1)}},[]);l.useEffect(()=>{v();const j=setInterval(()=>c(new Date),1e3),s=setInterval(v,300*1e3);return()=>{clearInterval(j),clearInterval(s)}},[v]);const N=o.reduce((j,s)=>j+(s.CurrentFreeGroupCounterValue||0),0),R=d?`Last update: ${d.toLocaleTimeString("pl-PL")}`:"Loading...";return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:"Parking Monitor",icon:"ðŸ…¿ï¸",onRefresh:v,updateStatus:R,currentView:"dashboard",setView:r}),e.jsxs("main",{className:"container-main",children:[e.jsx("div",{className:"subtitle",children:"Real-time parking availability â€¢ UBS WrocÅ‚aw"}),n&&e.jsxs("div",{className:"error",children:[e.jsx("strong",{children:"ERROR:"})," ",n]}),e.jsx("div",{className:"grid-container",children:i&&o.length===0?e.jsx("div",{className:"loader",children:"Loading parking data..."}):o.map((j,s)=>e.jsx(he,{data:j,now:b},s))}),e.jsxs("div",{className:"status-panel",children:[e.jsxs("div",{className:"panel-section",children:[e.jsx("div",{className:"status-label",children:"Total Spaces"}),e.jsx("div",{className:"status-value big-value",children:i?"---":N})]}),e.jsxs("div",{className:"panel-section",children:[e.jsx("div",{className:"status-label",children:"Data Status"}),e.jsx("div",{className:"status-value",style:{color:n?"var(--warning)":"var(--success)"},children:i?"LOADING":n?"OFFLINE":"ONLINE"})]}),e.jsxs("div",{className:"panel-section",children:[e.jsx("div",{className:"status-label",children:"Last Update / Current Time"}),e.jsxs("div",{className:"time-group",children:[e.jsx("span",{children:d?d.toLocaleTimeString("pl-PL"):"--:--:--"}),e.jsx("span",{className:"status-current-inline",children:b.toLocaleTimeString("pl-PL")})]})]})]})]})]})};var ge=oe();const ye=X(ge),xe="https://docs.google.com/spreadsheets/d/e/2PACX-1vTwLNDbg8KjlVHsZWj9JUnO_OBIyZaRgZ4gZ8_Gbyly2J3f6rlCW6lDHAihwbuLhxWbBkNMI1wdWRAq/pub?gid=411529798&single=true&output=csv",U={neon:{gd:"#05ffa1",uni:"#01beff"},classic:{gd:"#3b82f6",uni:"#f59e0b"},cyberpunk:{gd:"#00d9ff",uni:"#ff00cc"},modern:{gd:"#10b981",uni:"#6366f1"}},be=({setView:r})=>{const[o,h]=l.useState([]),[i,a]=l.useState(!0),[n,f]=l.useState("neon"),[d,u]=l.useState(!1),{isLight:b}=Q(),c=l.useRef({start:80,end:100}),v=l.useRef(null),N=async()=>{a(!0);try{const L=await(await fetch(`${xe}&time=${Date.now()}`)).text();ye.parse(L,{header:!0,skipEmptyLines:!0,complete:S=>{h(S.data),a(!1)}})}catch(s){console.error(s),a(!1)}};l.useEffect(()=>{N()},[]);const R=l.useMemo(()=>{if(!o||o.length===0)return null;const s=b?"#1e293b":"#8b95c9",L=b?"#cbd5e1":"#2d3b6b",S=window.innerWidth<=600,q=new Map,G=new Map;o.forEach(t=>{const p=_=>Object.keys(t).find(y=>y.trim().toLowerCase()===_),g=p("gd_time"),w=p("greenday free"),k=p("uni_time"),C=p("uni free");if(g&&w&&t[g]&&t[w]){const _=t[g].trim(),y=parseFloat(t[w]);isNaN(y)||q.set(_,y)}if(k&&C&&t[k]&&t[C]){const _=t[k].trim(),y=parseFloat(t[C]);isNaN(y)||G.set(_,y)}});const z=t=>Array.from(t.entries()).map(([p,g])=>({t:new Date(p),v:g,raw:p})).filter(p=>!isNaN(p.t.getTime())).sort((p,g)=>p.t-g.t),D=z(q),E=z(G),B=[...D.map(t=>t.t.getTime()),...E.map(t=>t.t.getTime())],T=B.length>0?Math.max(...B):null;let A=null;if(T){const t=D.find(g=>g.t.getTime()===T),p=E.find(g=>g.t.getTime()===T);A=(t||p)?.raw}const H=(t,p,g)=>{if(t.length===0)return{solid:[],gaps:[],projections:[]};const w=[],k=[],C=[],_=2400*1e3;for(let x=0;x<t.length;x++)w.push([t[x].raw,t[x].v]),x<t.length-1&&t[x+1].t-t[x].t>_&&(w.push([t[x+1].raw,null]),k.push([t[x].raw,t[x].v],[t[x+1].raw,t[x+1].v],[t[x+1].raw,null]));const y=t[t.length-1];return y&&p&&p-y.t.getTime()>1e3&&(C.push([y.raw,y.v]),C.push([g,y.v])),{solid:w,gaps:k,projections:C}},$=H(D,T,A),F=H(E,T,A),m=U[n],O=D.length>0?"GreenDay":"GreenDay - not found",I=E.length>0?"Uni Wroc":"Uni Wroc - not found";return{backgroundColor:"transparent",animation:!0,tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"cross"}},legend:{data:[O,I],top:5,textStyle:{color:s}},grid:{left:S?10:15,right:S?10:15,bottom:S?80:50,top:40,containLabel:!0},xAxis:{type:"time",axisLabel:{color:s,margin:10},axisLine:{lineStyle:{color:L}},splitLine:{show:!1}},yAxis:{type:"value",min:-5,max:200,splitLine:{lineStyle:{color:L,opacity:.3}},axisLabel:{color:s,formatter:t=>t<0?"":t}},dataZoom:[{type:"inside",start:c.current.start,end:c.current.end,filterMode:"none"},{type:"slider",start:c.current.start,end:c.current.end,bottom:S?40:10,height:S?30:25,textStyle:{color:s,fontSize:S?11:12},filterMode:"none",handleSize:S?"180%":"100%",borderColor:s,fillerColor:"rgba(100, 149, 237, 0.3)",dataBackground:{lineStyle:{color:s,opacity:.5},areaStyle:{color:s,opacity:.2}},moveHandleSize:S?10:7,emphasis:{handleStyle:{borderWidth:2}}}],series:[{name:O,type:"line",data:$.solid,showSymbol:d,lineStyle:{width:3,color:m.gd},itemStyle:{color:m.gd},areaStyle:{color:new J(0,0,0,1,[{offset:0,color:`${m.gd}33`},{offset:1,color:`${m.gd}00`}])},markLine:{symbol:"none",data:[{yAxis:187,lineStyle:{color:m.gd,type:"dotted",opacity:1},label:{position:"start",formatter:"187",color:m.gd,fontWeight:"bold",fontSize:13}}]}},{name:O,type:"line",data:$.gaps,showSymbol:!1,lineStyle:{width:2,color:m.gd,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:O,type:"line",data:$.projections,showSymbol:!1,lineStyle:{width:1.5,color:m.gd,type:[5,5],opacity:.5},tooltip:{show:!1}},{name:I,type:"line",data:F.solid,showSymbol:d,lineStyle:{width:3,color:m.uni},itemStyle:{color:m.uni},areaStyle:{color:new J(0,0,0,1,[{offset:0,color:`${m.uni}33`},{offset:1,color:`${m.uni}00`}])},markLine:{symbol:"none",data:[{yAxis:41,lineStyle:{color:m.uni,type:"dotted",opacity:1},label:{position:"start",formatter:"41",color:m.uni,fontWeight:"bold",fontSize:13}}]}},{name:I,type:"line",data:F.gaps,showSymbol:!1,lineStyle:{width:2,color:m.uni,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:I,type:"line",data:F.projections,showSymbol:!1,lineStyle:{width:1.5,color:m.uni,type:[5,5],opacity:.5},tooltip:{show:!1}}]}},[o,n,d,b]),j={datazoom:s=>{s.batch&&s.batch[0]?c.current={start:s.batch[0].start,end:s.batch[0].end}:s.start!==void 0&&s.end!==void 0&&(c.current={start:s.start,end:s.end})}};return e.jsxs("div",{className:"page-wrapper",children:[e.jsx(ee,{title:"Parking History",shortTitle:"Hist",icon:"ðŸ“ˆ",onRefresh:N,updateStatus:i?"Updating...":"Ready",currentView:"stats",setView:r,children:e.jsxs("div",{className:"palette-group",children:[e.jsx("span",{className:"palette-label",children:"Palette:"}),Object.keys(U).map(s=>e.jsx("div",{className:`palette-btn ${n===s?"active":""}`,style:{background:`linear-gradient(135deg, ${U[s].gd} 50%, ${U[s].uni} 50%)`},onClick:()=>f(s),title:s.charAt(0).toUpperCase()+s.slice(1)},s)),e.jsxs("button",{className:"palette-toggle-btn",onClick:()=>u(!d),children:["Dots: ",d?"Off":"On"]})]})}),e.jsx("main",{className:"stats-container",children:i&&o.length===0?e.jsx("div",{className:"loader",children:"Loading history data..."}):R?e.jsx(se,{ref:v,option:R,style:{height:"100%",width:"100%",touchAction:"none"},onEvents:j,notMerge:!1,lazyUpdate:!0,opts:{renderer:"canvas"}}):e.jsx("div",{className:"loader",children:"No data available to display."})})]})};function ve(){const[r,o]=l.useState("dashboard");return e.jsx(ue,{children:r==="dashboard"?e.jsx(fe,{setView:o}):e.jsx(be,{setView:o})})}de.createRoot(document.getElementById("root")).render(e.jsx(ae.StrictMode,{children:e.jsx(ve,{})}));
