import{r as i,L as V,E as ee,R as te}from"./vendor-echarts-CH7RThay.js";import{r as se}from"./vendor-react-bthqeG5T.js";import{P as ae}from"./vendor-utils-C-a--0RZ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function u(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=u(a);fetch(a.href,o)}})();var q={exports:{}},A={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ne=i,oe=Symbol.for("react.element"),re=Symbol.for("react.fragment"),ie=Object.prototype.hasOwnProperty,le=ne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ce={key:!0,ref:!0,__self:!0,__source:!0};function J(l,t,u){var r,a={},o=null,m=null;u!==void 0&&(o=""+u),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(m=t.ref);for(r in t)ie.call(t,r)&&!ce.hasOwnProperty(r)&&(a[r]=t[r]);if(l&&l.defaultProps)for(r in t=l.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:oe,type:l,key:o,ref:m,props:a,_owner:le.current}}A.Fragment=re;A.jsx=J;A.jsxs=J;q.exports=A;var e=q.exports,F={},Z=se;F.createRoot=Z.createRoot,F.hydrateRoot=Z.hydrateRoot;const X=i.createContext(),de=({children:l})=>{const[t,u]=i.useState(localStorage.getItem("parking_theme")==="light");i.useEffect(()=>{t?(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("parking_theme","light")):(document.documentElement.removeAttribute("data-theme"),localStorage.setItem("parking_theme","dark"))},[t]);const r=()=>u(!t);return e.jsx(X.Provider,{value:{isLight:t,toggleTheme:r},children:l})},Y=()=>i.useContext(X),Q=({title:l,shortTitle:t,icon:u,onRefresh:r,updateStatus:a,currentView:o,setView:m,children:g})=>{const{isLight:T,toggleTheme:x}=Y();return e.jsxs("header",{className:"header-controls",children:[e.jsxs("div",{className:"header-title-group",children:[e.jsxs("h1",{children:[e.jsx("span",{className:"title-icon",children:u}),e.jsxs("span",{className:"title-text-full",children:[" ",l]}),e.jsxs("span",{className:"title-text-short",children:[" ",t||l]})]}),e.jsx("div",{className:"status-info",children:a})]}),e.jsxs("div",{className:"header-actions",children:[g,r&&e.jsxs("button",{className:"nav-btn",onClick:r,children:[e.jsx("span",{className:"btn-icon",children:"âŸ³"}),e.jsx("span",{className:"btn-text",children:"Refresh"})]}),o==="stats"&&e.jsxs("button",{className:"nav-btn",onClick:()=>m("dashboard"),children:[e.jsx("span",{className:"btn-icon",children:"ðŸ "}),e.jsx("span",{className:"btn-text",children:"Dashboard"})]}),o==="dashboard"&&e.jsxs("button",{className:"nav-btn",onClick:()=>m("stats"),children:[e.jsx("span",{className:"btn-icon",children:"ðŸ“Š"}),e.jsx("span",{className:"btn-text",children:"Statistics"})]}),e.jsx("button",{className:"theme-toggle",onClick:x,"aria-label":"Toggle theme",children:T?"ðŸŒ™":"â˜€ï¸"})]})]})},ue=["https://gd.zaparkuj.pl/api/freegroupcountervalue.json","https://gd.zaparkuj.pl/api/freegroupcountervalue-green.json"],me="https://corsproxy.io/?",he=({data:l,now:t})=>{const u=new Date(l.Timestamp.replace(" ","T")),r=Math.max(0,Math.floor((t-u)/1e3/60));let a="";r>=15?a="age-old":r>5&&(a="age-medium");let o=l.ParkingGroupName;return o==="Bank_1"&&(o="Uni Wroc"),e.jsxs("div",{className:"parking-card",children:[e.jsx("div",{className:"parking-name",children:o}),e.jsx("div",{className:`free-spots ${a}`,children:l.CurrentFreeGroupCounterValue||0}),e.jsxs("div",{className:"age-indicator-small",children:[r," min ago"]}),e.jsxs("div",{className:"timestamp-small",children:["@",u.toLocaleTimeString("pl-PL")]})]})},pe=({setView:l})=>{const[t,u]=i.useState([]),[r,a]=i.useState(!0),[o,m]=i.useState(null),[g,T]=i.useState(null),[x,b]=i.useState(new Date),w=i.useCallback(async()=>{a(!0),m(null);try{const y=await Promise.all(ue.map(n=>fetch(`${me}${encodeURIComponent(n+"?time="+Date.now())}`).then(j=>j.ok?j.json():Promise.reject(`HTTP ${j.status}`))));u(y),T(new Date)}catch(y){m(y.toString())}finally{a(!1)}},[]);i.useEffect(()=>{w();const y=setInterval(()=>b(new Date),1e3),n=setInterval(w,5*60*1e3);return()=>{clearInterval(y),clearInterval(n)}},[w]);const k=t.reduce((y,n)=>y+(n.CurrentFreeGroupCounterValue||0),0),C=g?`Last update: ${g.toLocaleTimeString("pl-PL")}`:"Loading...";return e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Parking Monitor",icon:"ðŸ…¿ï¸",onRefresh:w,updateStatus:C,currentView:"dashboard",setView:l}),e.jsxs("main",{className:"container",children:[e.jsx("div",{className:"subtitle",children:"Real-time parking availability â€¢ UBS WrocÅ‚aw"}),o&&e.jsxs("div",{className:"error",children:[e.jsx("strong",{children:"ERROR:"})," ",o]}),e.jsx("div",{className:"grid-container",children:r&&t.length===0?e.jsx("div",{className:"loader",children:"Loading parking data..."}):t.map((y,n)=>e.jsx(he,{data:y,now:x},n))}),e.jsxs("div",{className:"status-panel",children:[e.jsxs("div",{className:"panel-section",children:[e.jsx("div",{className:"status-label",children:"Total Spaces"}),e.jsx("div",{className:"status-value big-value",children:r?"---":k})]}),e.jsxs("div",{className:"panel-section",children:[e.jsx("div",{className:"status-label",children:"Data Status"}),e.jsx("div",{className:"status-value",style:{color:o?"var(--warning)":"var(--success)"},children:r?"LOADING":o?"OFFLINE":"ONLINE"})]}),e.jsxs("div",{className:"panel-section",children:[e.jsx("div",{className:"status-label",children:"Last Update / Current Time"}),e.jsxs("div",{className:"time-group",children:[e.jsx("span",{children:g?g.toLocaleTimeString("pl-PL"):"--:--:--"}),e.jsx("span",{className:"status-current-inline",children:x.toLocaleTimeString("pl-PL")})]})]})]})]})]})},fe="https://docs.google.com/spreadsheets/d/e/2PACX-1vTwLNDbg8KjlVHsZWj9JUnO_OBIyZaRgZ4gZ8_Gbyly2J3f6rlCW6lDHAihwbuLhxWbBkNMI1wdWRAq/pub?gid=411529798&single=true&output=csv",I={neon:{gd:"#05ffa1",uni:"#01beff"},classic:{gd:"#3b82f6",uni:"#f59e0b"},cyberpunk:{gd:"#00d9ff",uni:"#ff00cc"},modern:{gd:"#10b981",uni:"#6366f1"}},ge=({setView:l})=>{const[t,u]=i.useState([]),[r,a]=i.useState(!0),[o,m]=i.useState("neon"),[g,T]=i.useState(!1),{isLight:x}=Y(),b=i.useRef({start:80,end:100}),w=i.useRef(null),k=async()=>{a(!0);try{const j=await(await fetch(`${fe}&time=${Date.now()}`)).text();ae.parse(j,{header:!0,skipEmptyLines:!0,complete:v=>{u(v.data),a(!1)}})}catch(n){console.error(n),a(!1)}};i.useEffect(()=>{k()},[]);const C=i.useMemo(()=>{var H;if(!t||t.length===0)return null;const n=x?"#1e293b":"#8b95c9",j=x?"#cbd5e1":"#2d3b6b",v=window.innerWidth<=600,W=new Map,G=new Map;t.forEach(s=>{const d=L=>Object.keys(s).find(p=>p.trim().toLowerCase()===L),h=d("gd_time"),N=d("greenday free"),R=d("uni_time"),S=d("uni free");if(h&&N&&s[h]&&s[N]){const L=s[h].trim(),p=parseFloat(s[N]);isNaN(p)||W.set(L,p)}if(R&&S&&s[R]&&s[S]){const L=s[R].trim(),p=parseFloat(s[S]);isNaN(p)||G.set(L,p)}});const z=s=>Array.from(s.entries()).map(([d,h])=>({t:new Date(d),v:h,raw:d})).filter(d=>!isNaN(d.t.getTime())).sort((d,h)=>d.t-h.t),_=z(W),E=z(G),K=[..._.map(s=>s.t.getTime()),...E.map(s=>s.t.getTime())],P=K.length>0?Math.max(...K):null;let M=null;if(P){const s=_.find(h=>h.t.getTime()===P),d=E.find(h=>h.t.getTime()===P);M=(H=s||d)==null?void 0:H.raw}const B=(s,d,h)=>{if(s.length===0)return{solid:[],gaps:[],projections:[]};const N=[],R=[],S=[],L=40*60*1e3;for(let f=0;f<s.length;f++)N.push([s[f].raw,s[f].v]),f<s.length-1&&s[f+1].t-s[f].t>L&&(N.push([s[f+1].raw,null]),R.push([s[f].raw,s[f].v],[s[f+1].raw,s[f+1].v],[s[f+1].raw,null]));const p=s[s.length-1];return p&&d&&d-p.t.getTime()>1e3&&(S.push([p.raw,p.v]),S.push([h,p.v])),{solid:N,gaps:R,projections:S}},U=B(_,P,M),$=B(E,P,M),c=I[o],D=_.length>0?"GreenDay":"GreenDay - not found",O=E.length>0?"Uni Wroc":"Uni Wroc - not found";return{backgroundColor:"transparent",animation:!0,tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"cross"}},legend:{data:[D,O],top:5,textStyle:{color:n}},grid:{left:v?10:15,right:v?10:15,bottom:50,top:40,containLabel:!0},xAxis:{type:"time",axisLabel:{color:n,margin:10},axisLine:{lineStyle:{color:j}},splitLine:{show:!1}},yAxis:{type:"value",min:-5,max:200,splitLine:{lineStyle:{color:j,opacity:.3}},axisLabel:{color:n,formatter:s=>s<0?"":s}},dataZoom:[{type:"inside",start:b.current.start,end:b.current.end,filterMode:"none"},{type:"slider",start:b.current.start,end:b.current.end,bottom:v?5:10,height:v?30:25,textStyle:{color:n},filterMode:"none",handleSize:v?"120%":"100%"}],series:[{name:D,type:"line",data:U.solid,showSymbol:g,lineStyle:{width:3,color:c.gd},itemStyle:{color:c.gd},areaStyle:{color:new V(0,0,0,1,[{offset:0,color:`${c.gd}33`},{offset:1,color:`${c.gd}00`}])},markLine:{symbol:"none",data:[{yAxis:187,lineStyle:{color:c.gd,type:"dotted",opacity:1},label:{position:"start",formatter:"187",color:c.gd,fontWeight:"bold",fontSize:13}}]}},{name:D,type:"line",data:U.gaps,showSymbol:!1,lineStyle:{width:2,color:c.gd,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:D,type:"line",data:U.projections,showSymbol:!1,lineStyle:{width:1.5,color:c.gd,type:[5,5],opacity:.5},tooltip:{show:!1}},{name:O,type:"line",data:$.solid,showSymbol:g,lineStyle:{width:3,color:c.uni},itemStyle:{color:c.uni},areaStyle:{color:new V(0,0,0,1,[{offset:0,color:`${c.uni}33`},{offset:1,color:`${c.uni}00`}])},markLine:{symbol:"none",data:[{yAxis:41,lineStyle:{color:c.uni,type:"dotted",opacity:1},label:{position:"start",formatter:"41",color:c.uni,fontWeight:"bold",fontSize:13}}]}},{name:O,type:"line",data:$.gaps,showSymbol:!1,lineStyle:{width:2,color:c.uni,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:O,type:"line",data:$.projections,showSymbol:!1,lineStyle:{width:1.5,color:c.uni,type:[5,5],opacity:.5},tooltip:{show:!1}}]}},[t,o,g,x]),y={datazoom:n=>{n.batch&&n.batch[0]?b.current={start:n.batch[0].start,end:n.batch[0].end}:n.start!==void 0&&n.end!==void 0&&(b.current={start:n.start,end:n.end})}};return e.jsxs("div",{className:"page-wrapper",children:[e.jsx(Q,{title:"Parking History",shortTitle:"Hist",icon:"ðŸ“ˆ",onRefresh:k,updateStatus:r?"Updating...":"Ready",currentView:"stats",setView:l,children:e.jsxs("div",{className:"palette-group",children:[e.jsx("span",{className:"palette-label",children:"Palette:"}),Object.keys(I).map(n=>e.jsx("div",{className:`palette-btn ${o===n?"active":""}`,style:{background:`linear-gradient(135deg, ${I[n].gd} 50%, ${I[n].uni} 50%)`},onClick:()=>m(n),title:n.charAt(0).toUpperCase()+n.slice(1)},n)),e.jsxs("button",{className:"palette-toggle-btn",onClick:()=>T(!g),children:["Dots: ",g?"Off":"On"]})]})}),e.jsx("main",{className:"stats-container",children:r&&t.length===0?e.jsx("div",{className:"loader",children:"Loading history data..."}):C?e.jsx(ee,{ref:w,option:C,style:{height:"100%",width:"100%",touchAction:"none"},onEvents:y,notMerge:!1,lazyUpdate:!0,opts:{renderer:"canvas"}}):e.jsx("div",{className:"loader",children:"No data available to display."})})]})};function ye(){const[l,t]=i.useState("dashboard");return e.jsx(de,{children:l==="dashboard"?e.jsx(pe,{setView:t}):e.jsx(ge,{setView:t})})}F.createRoot(document.getElementById("root")).render(e.jsx(te.StrictMode,{children:e.jsx(ye,{})}));
