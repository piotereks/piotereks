import{r as Fe,g as oe,R as O,a as N,L as ne,E as Ue}from"./vendor-echarts-nZu8rBDa.js";import{r as Oe}from"./vendor-react-BVyvVbwp.js";import{r as Ge}from"./vendor-utils-F0zOxUcV.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function a(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=a(s);fetch(s.href,n)}})();var X={exports:{}},$={};var ie;function Me(){if(ie)return $;ie=1;var e=Fe(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function d(p,u,x){var y,R={},v=null,c=null;x!==void 0&&(v=""+x),u.key!==void 0&&(v=""+u.key),u.ref!==void 0&&(c=u.ref);for(y in u)o.call(u,y)&&!n.hasOwnProperty(y)&&(R[y]=u[y]);if(p&&p.defaultProps)for(y in u=p.defaultProps,u)R[y]===void 0&&(R[y]=u[y]);return{$$typeof:t,type:p,key:v,ref:c,props:R,_owner:s.current}}return $.Fragment=a,$.jsx=d,$.jsxs=d,$}var le;function Ve(){return le||(le=1,X.exports=Me()),X.exports}var r=Ve(),z={},ce;function He(){if(ce)return z;ce=1;var e=Oe();return z.createRoot=e.createRoot,z.hydrateRoot=e.hydrateRoot,z}var $e=He();const qe=oe($e);var Q={exports:{}},ee,ue;function We(){if(ue)return ee;ue=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return ee=e,ee}var te,de;function Ke(){if(de)return te;de=1;var e=We();function t(){}function a(){}return a.resetWarningCache=t,te=function(){function o(d,p,u,x,y,R){if(R!==e){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}o.isRequired=o;function s(){return o}var n={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:s,element:o,elementType:o,instanceOf:s,node:o,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:a,resetWarningCache:t};return n.PropTypes=n,n},te}var pe;function Be(){return pe||(pe=1,Q.exports=Ke()()),Q.exports}var ze=Be();const T=oe(ze);class we extends O.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Error caught by boundary:",t,a),this.setState({errorInfo:a})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()};render(){return this.state.hasError?r.jsx("div",{className:"error-boundary",children:r.jsxs("div",{className:"error-content",children:[r.jsx("h1",{children:"ðŸš¨ Oops! Something went wrong"}),r.jsx("p",{className:"error-message",children:"The application encountered an unexpected error."}),this.state.error&&r.jsxs("details",{className:"error-details",children:[r.jsx("summary",{children:"Error Details"}),r.jsx("pre",{children:this.state.error.toString()}),this.state.errorInfo&&r.jsx("pre",{children:this.state.errorInfo.componentStack})]}),r.jsx("button",{onClick:this.handleReset,className:"error-reset-btn",children:"ðŸ”„ Reload Application"})]})}):this.props.children}}we.propTypes={children:T.node.isRequired};const je=N.createContext(),Ee=({children:e})=>{const[t,a]=N.useState(localStorage.getItem("parking_theme")==="light");N.useEffect(()=>{t?(document.body.classList.remove("dark"),localStorage.setItem("parking_theme","light")):(document.body.classList.add("dark"),localStorage.setItem("parking_theme","dark"))},[t]);const o=()=>a(!t);return r.jsx(je.Provider,{value:{isLight:t,toggleTheme:o},children:e})};Ee.propTypes={children:T.node.isRequired};const Le=()=>N.useContext(je);var Je=Ge();const Ye=oe(Je),me=e=>{let t;const a=new Set,o=(x,y)=>{const R=typeof x=="function"?x(t):x;if(!Object.is(R,t)){const v=t;t=y??(typeof R!="object"||R===null)?R:Object.assign({},t,R),a.forEach(c=>c(t,v))}},s=()=>t,p={setState:o,getState:s,getInitialState:()=>u,subscribe:x=>(a.add(x),()=>a.delete(x))},u=t=e(o,s,p);return p},Ze=(e=>e?me(e):me),Xe=e=>e;function Qe(e,t=Xe){const a=O.useSyncExternalStore(e.subscribe,O.useCallback(()=>t(e.getState()),[e,t]),O.useCallback(()=>t(e.getInitialState()),[e,t]));return O.useDebugValue(a),a}const he=e=>{const t=Ze(e),a=o=>Qe(t,o);return Object.assign(a,t),a},et=(e=>e?he(e):he),S=et(e=>({realtimeData:[],realtimeLoading:!0,realtimeError:null,lastRealtimeUpdate:null,historyData:[],historyLoading:!1,lastHistoryUpdate:null,fetchInProgress:!1,refreshCallback:null,stopAutoRefresh:null,cacheCleared:!1,setRealtimeData:a=>e({realtimeData:a}),setRealtimeLoading:a=>e({realtimeLoading:a}),setRealtimeError:a=>e({realtimeError:a}),setLastRealtimeUpdate:a=>e({lastRealtimeUpdate:a}),setHistoryData:a=>e({historyData:a}),setHistoryLoading:a=>e({historyLoading:a}),setLastHistoryUpdate:a=>e({lastHistoryUpdate:a}),setFetchInProgress:a=>e({fetchInProgress:a}),setRefreshCallback:a=>e({refreshCallback:a}),setStopAutoRefresh:a=>e({stopAutoRefresh:a}),setCacheCleared:a=>e({cacheCleared:a}),updateRealtimeState:a=>e(a),updateHistoryState:a=>e(a),resetStore:()=>e({realtimeData:[],realtimeLoading:!0,realtimeError:null,lastRealtimeUpdate:null,historyData:[],historyLoading:!1,lastHistoryUpdate:null,fetchInProgress:!1,refreshCallback:null})})),Ie=async()=>{const e=S.getState().refreshCallback;e?await e():console.warn("Refresh callback not set yet")},Ae=()=>{try{typeof localStorage<"u"&&(localStorage.removeItem("parking_realtime_cache"),localStorage.removeItem("parking_history_cache")),S.setState({fetchInProgress:!1,cacheCleared:!0});const e=S.getState().stopAutoRefresh;if(typeof e=="function")try{e()}catch(t){console.warn("stopAutoRefresh failed",t)}console.log("Cache cleared and auto-refresh stopped")}catch(e){console.error("clearCache failed",e)}};typeof window<"u"&&(window.clearCache=Ae);const tt=N.createContext(),at=["https://gd.zaparkuj.pl/api/freegroupcountervalue.json","https://gd.zaparkuj.pl/api/freegroupcountervalue-green.json"],rt="https://corsproxy.io/?",ot="https://docs.google.com/spreadsheets/d/e/2PACX-1vTwLNDbg8KjlVHsZWj9JUnO_OBIyZaRgZ4gZ8_Gbyly2J3f6rlCW6lDHAihwbuLhxWbBkNMI1wdWRAq/pub?gid=411529798&single=true&output=csv",st="https://docs.google.com/forms/d/e/1FAIpQLSdeQ-rmw_VfOidGmtSNb9DLkt1RfPdduu-jH898sf3lhj17LA/formResponse",J={GREENDAY_VALUE:"entry.2026993163",GREENDAY_TIME:"entry.51469670",UNI_VALUE:"entry.1412144904",UNI_TIME:"entry.364658642"},ge="parking_realtime_cache",re="parking_history_cache",D={GD_TIME:"gd_time",GD_VALUE:"greenday free",UNI_TIME:"uni_time",UNI_VALUE:"uni free"},fe=e=>e?e.trim().toLowerCase():"",nt=(e,t)=>{if(!e)return null;const a=fe(t);return Object.keys(e).find(o=>fe(o)===a)||null},Z=(e,t)=>{const a=nt(e,t);if(!a)return;const o=e[a];return typeof o=="string"?o.trim():o},it=e=>{if(!e)return null;const t=e.includes("T")?e:e.replace(" ","T"),a=new Date(t);return Number.isNaN(a.getTime())?null:a},ye=(e,t,a)=>{if(!e)return null;const o=Z(e,t),s=it(o);if(!s)return null;const n=Z(e,a),d=n==null||n===""?null:Number(n);return{raw:o,date:s,value:Number.isNaN(d)?null:d}},lt=e=>{if(!e||e.length===0)return{gd:null,uni:null};const t=e[e.length-1];return{gd:ye(t,D.GD_TIME,D.GD_VALUE),uni:ye(t,D.UNI_TIME,D.UNI_VALUE)}},xe=(e=[])=>{const t=new Set,a=[];return e.forEach(o=>{const s=Z(o,D.GD_TIME)||"",n=Z(o,D.UNI_TIME)||"",d=`${s}|||${n}`;t.has(d)||(t.add(d),a.push(o))}),a},be=e=>{if(!e||!e.Timestamp)return null;const t=e.Timestamp.trim();if(!t)return null;const a=t.includes("T")?t:t.replace(" ","T"),o=new Date(a);if(Number.isNaN(o.getTime()))return null;const s=Number(e.CurrentFreeGroupCounterValue);return{raw:t,date:o,value:Number.isNaN(s)?null:s}},ct=(e=[])=>Array.isArray(e)?e.map(t=>({...t||{}})):[],ut=(e,t)=>({[D.GD_TIME]:e?.Timestamp||"",[D.GD_VALUE]:e?.CurrentFreeGroupCounterValue??"",[D.UNI_TIME]:t?.Timestamp||"",[D.UNI_VALUE]:t?.CurrentFreeGroupCounterValue??""}),Se=()=>{if(typeof localStorage>"u")return{rows:[],timestamp:null,last:{gd:null,uni:null}};const e=localStorage.getItem(re);if(!e)return{rows:[],timestamp:null,last:{gd:null,uni:null}};try{const t=JSON.parse(e),a=Array.isArray(t.data)?t.data:[];return{rows:a,timestamp:t.timestamp||null,last:lt(a)}}catch(t){return console.error("Failed to parse history cache snapshot:",t),{rows:[],timestamp:null,last:{gd:null,uni:null}}}},_e=({children:e})=>{const t=S(i=>i.setRealtimeData),a=S(i=>i.setRealtimeLoading),o=S(i=>i.setRealtimeError),s=S(i=>i.setLastRealtimeUpdate),n=S(i=>i.setHistoryData),d=S(i=>i.setHistoryLoading),p=S(i=>i.setLastHistoryUpdate),u=S(i=>i.setRefreshCallback),x=S(i=>i.setStopAutoRefresh),y=S(i=>i.historyData),R=N.useRef(!1),v=S(i=>i.cacheCleared),c=N.useCallback(i=>{const f=Array.isArray(i)?i:[],h=new Date;n(f),p(h);try{localStorage.setItem(re,JSON.stringify({data:f,timestamp:h.toISOString()})),console.log("History cache updated")}catch(l){console.error("Failed to cache history data:",l)}},[n,p]),G=N.useCallback(async i=>{try{const f=i[0],h=i[1];if(!f||!h){console.log("Missing data for form submission");return}const l=f.CurrentFreeGroupCounterValue||0,_=f.Timestamp||"",m=h.CurrentFreeGroupCounterValue||0,b=h.Timestamp||"",C=new URLSearchParams;C.append(J.GREENDAY_VALUE,l.toString()),C.append(J.GREENDAY_TIME,_),C.append(J.UNI_VALUE,m.toString()),C.append(J.UNI_TIME,b),console.log("Submitting to Google Form:",{greenDay:{value:l,time:_},uni:{value:m,time:b}}),await fetch(st,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:C.toString(),mode:"no-cors"}),console.log("Form submission completed")}catch(f){console.error("Failed to submit to Google Form:",f)}},[]),g=N.useCallback(async()=>{if(v){console.log("Cache cleared â€” skipping history fetch");return}d(!0);try{const f=await(await fetch(`${ot}&time=${Date.now()}`,{cache:"no-store"})).text();Ye.parse(f,{header:!0,skipEmptyLines:!0,complete:h=>{const l=xe(h.data||[]);console.log("CSV fetched, parsed, and deduplicated"),c(l),d(!1)}})}catch(i){console.error("Failed to fetch history data:",i),d(!1)}},[c,d,v]),E=N.useCallback(async i=>{try{const f=be(i[0]),h=be(i[1]);console.log("API timestamps:",{gd:f?.date?.toISOString(),uni:h?.date?.toISOString()});let l=Se();l.rows.length&&y.length===0&&(n(l.rows),l.timestamp&&p(new Date(l.timestamp)));const _=!f?.date||l.last.gd?.date&&f.date.getTime()<=l.last.gd.date.getTime(),m=!h?.date||l.last.uni?.date&&h.date.getTime()<=l.last.uni.date.getTime();if(l.rows.length>0&&_&&m){console.log("Fast path hit â€” cache already covers API timestamps");return}console.log("Slow path triggered â€” fetching CSV for reconciliation"),await g(),l=Se(),l.rows.length&&(n(l.rows),l.timestamp&&p(new Date(l.timestamp)));const C=f?.date?!l.last.gd?.date||f.date.getTime()>l.last.gd.date.getTime():!1,P=h?.date?!l.last.uni?.date||h.date.getTime()>l.last.uni.date.getTime():!1;if(!C&&!P){console.log("After reconciliation, no newer timestamps detected");return}const w=ct(i);for(;w.length<2;)w.push({});if(l.last.gd?.date){const j=f?.date;(!j||j.getTime()<l.last.gd.date.getTime())&&(w[0]={...w[0],Timestamp:l.last.gd.raw,CurrentFreeGroupCounterValue:l.last.gd.value??w[0].CurrentFreeGroupCounterValue??0})}if(l.last.uni?.date){const j=h?.date;(!j||j.getTime()<l.last.uni.date.getTime())&&(w[1]={...w[1],Timestamp:l.last.uni.raw,CurrentFreeGroupCounterValue:l.last.uni.value??w[1].CurrentFreeGroupCounterValue??0})}await G(w);const F=xe([...l.rows,ut(w[0],w[1])]);c(F)}catch(f){console.error("Error checking history update:",f)}},[g,y.length,c,G,n,p]),L=N.useCallback(async()=>{if(v){console.log("Cache cleared â€” skipping realtime fetch");return}if(R.current){console.log("Fetch already in progress, skipping...");return}R.current=!0,a(!0),o(null);try{const i=localStorage.getItem(ge);if(i)try{const l=JSON.parse(i);t(l.data),s(new Date(l.timestamp)),console.log("Real-time cache loaded")}catch(l){console.error("Failed to parse real-time cache:",l)}const f=await Promise.all(at.map(l=>fetch(`${rt}${encodeURIComponent(l+"?time="+Date.now())}`).then(_=>_.ok?_.json():Promise.reject(`HTTP ${_.status}`))));t(f);const h=new Date;s(h);try{localStorage.setItem(ge,JSON.stringify({data:f,timestamp:h.toISOString()}))}catch(l){console.error("Failed to cache real-time data:",l)}await E(f)}catch(i){console.error("Failed to fetch real-time data:",i),o(i.toString())}finally{a(!1),R.current=!1}},[t,a,o,s,E,v]);N.useEffect(()=>{const i=localStorage.getItem(re);if(i)try{const f=JSON.parse(i);n(f.data),p(new Date(f.timestamp)),console.log("History cache loaded on mount")}catch(f){console.error("Failed to load history cache on mount:",f)}},[n,p]),N.useEffect(()=>{if(v){console.log("Cache cleared â€” skipping initial realtime fetch and auto-refresh");return}L();const i=setInterval(L,300*1e3);try{x(()=>()=>clearInterval(i))}catch(f){console.warn("Failed to register stopAutoRefresh",f)}return()=>clearInterval(i)},[L,x,v]);const U=N.useCallback(async()=>{console.log("Manual refresh triggered"),await L()},[L]);N.useEffect(()=>{u(U)},[U,u]);const I=S(i=>i.realtimeData),A=S(i=>i.realtimeLoading),W=S(i=>i.realtimeError),K=S(i=>i.lastRealtimeUpdate),M=S(i=>i.historyLoading),H=S(i=>i.lastHistoryUpdate),B={realtimeData:I,realtimeLoading:A,realtimeError:W,lastRealtimeUpdate:K,historyData:y,historyLoading:M,lastHistoryUpdate:H,refresh:U};return r.jsx(tt.Provider,{value:B,children:e})};_e.propTypes={children:T.node.isRequired};const se=({title:e,shortTitle:t,icon:a,onRefresh:o,updateStatus:s,currentView:n,setView:d,children:p})=>{const{isLight:u,toggleTheme:x}=Le();return r.jsxs("header",{className:"header-controls",role:"banner",children:[r.jsxs("div",{className:"header-title-group",children:[r.jsxs("h1",{children:[r.jsx("span",{className:"title-icon",role:"img","aria-label":`${e} icon`,children:a}),r.jsxs("span",{className:"title-text-full",children:[" ",e]}),r.jsxs("span",{className:"title-text-short",children:[" ",t||e]})]}),r.jsx("div",{className:"status-info",role:"status","aria-live":"polite",children:s})]}),r.jsxs("div",{className:"header-actions",role:"navigation","aria-label":"Main navigation",children:[p,(typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams).has("clear_cache")?r.jsxs("button",{className:"nav-btn",onClick:()=>Ae(),"aria-label":"Clear cache",children:[r.jsx("span",{className:"btn-icon",role:"img","aria-label":"Broom icon",children:"ðŸ§¹"}),r.jsx("span",{className:"btn-text",children:"Clear Cache"})]}):o?r.jsxs("button",{className:"nav-btn",onClick:o,"aria-label":"Refresh data",children:[r.jsx("span",{className:"btn-icon",role:"img","aria-label":"Refresh icon",children:"âŸ³"}),r.jsx("span",{className:"btn-text",children:"Refresh"})]}):null,n==="stats"&&r.jsxs("button",{className:"nav-btn",onClick:()=>d("dashboard"),"aria-label":"Go to dashboard",children:[r.jsx("span",{className:"btn-icon",role:"img","aria-label":"Home icon",children:"ðŸ "}),r.jsx("span",{className:"btn-text",children:"Dashboard"})]}),n==="dashboard"&&r.jsxs("button",{className:"nav-btn",onClick:()=>d("stats"),"aria-label":"Go to statistics",children:[r.jsx("span",{className:"btn-icon",role:"img","aria-label":"Chart icon",children:"ðŸ“Š"}),r.jsx("span",{className:"btn-text",children:"Statistics"})]}),r.jsx("button",{className:"theme-toggle",onClick:x,"aria-label":u?"Switch to dark theme":"Switch to light theme",children:u?"ðŸŒ™":"â˜€ï¸"})]})]})};se.propTypes={title:T.string.isRequired,shortTitle:T.string,icon:T.string.isRequired,onRefresh:T.func,updateStatus:T.string.isRequired,currentView:T.oneOf(["dashboard","stats"]).isRequired,setView:T.func.isRequired,children:T.node};const Ce={"Green Day":187,Bank_1:41,"Uni Wroc":41},q=3e3,dt=e=>e?e==="Bank_1"?"Uni Wroc":e:"Unknown",V=(e,t=new Date)=>{if(!e)return 1/0;const a=new Date(e.replace(" ","T"));return Math.max(0,Math.floor((t-a)/1e3/60))},Re=e=>Ce[e]||Ce[dt(e)],Ne=(e,t,a=new Date)=>{if(!e||!t)return{approximated:null,original:null,isApproximated:!1,reason:"Missing data"};const o=V(e.Timestamp,a);if(o<q)return{approximated:e.CurrentFreeGroupCounterValue||0,original:e.CurrentFreeGroupCounterValue||0,isApproximated:!1,ageMinutes:o};const s=Re(e.ParkingGroupName),n=Re(t.ParkingGroupName);if(console.log("[Approximation] Stale parking:",e.ParkingGroupName,"max:",s),console.log("[Approximation] Fresh parking:",t.ParkingGroupName,"max:",n),!s||!n)return console.log("[Approximation] Skipping - unknown capacity"),{approximated:e.CurrentFreeGroupCounterValue||0,original:e.CurrentFreeGroupCounterValue||0,isApproximated:!1,ageMinutes:o,reason:"Unknown capacity"};const d=t.CurrentFreeGroupCounterValue||0,p=d/n;console.log("[Approximation] Fresh free spaces:",d,"ratio:",p.toFixed(3));const u=Math.round(p*s);return console.log("[Approximation] Calculated approximation:",u),{approximated:u,original:e.CurrentFreeGroupCounterValue||0,isApproximated:!0,ageMinutes:o,freshRatio:p,calculation:`(${d} / ${n}) * ${s} = ${u}`}};let ae=null,Te=null,ve=null;const pt=(e,t=new Date)=>{if(!Array.isArray(e)||e.length===0)return[];if(e.length!==2)return e.map(y=>({...y,approximationInfo:{isApproximated:!1,original:y.CurrentFreeGroupCounterValue||0,approximated:y.CurrentFreeGroupCounterValue||0,ageMinutes:V(y?.Timestamp,t)}}));const a=e[0],o=e[1],s=V(a?.Timestamp,t),n=V(o?.Timestamp,t),d=s>=q&&n<q,p=n>=q&&s<q,u=JSON.stringify({area1Name:a?.ParkingGroupName,area1Value:a?.CurrentFreeGroupCounterValue,area1Timestamp:a?.Timestamp,area1NeedsApprox:d,area2Name:o?.ParkingGroupName,area2Value:o?.CurrentFreeGroupCounterValue,area2Timestamp:o?.Timestamp,area2NeedsApprox:p});if(Te===e&&ve===u&&ae)return ae;const x=[];if(d){const y=Ne(a,o,t);x.push({...a,approximationInfo:y})}else x.push({...a,approximationInfo:{isApproximated:!1,original:a?.CurrentFreeGroupCounterValue||0,approximated:a?.CurrentFreeGroupCounterValue||0,ageMinutes:s}});if(p){const y=Ne(o,a,t);x.push({...o,approximationInfo:y})}else x.push({...o,approximationInfo:{isApproximated:!1,original:o?.CurrentFreeGroupCounterValue||0,approximated:o?.CurrentFreeGroupCounterValue||0,ageMinutes:n}});return Te=e,ve=u,ae=x,x},ke=({data:e,now:t})=>{const a=V(e.Timestamp,t);let o="";a>=15?o="age-old":a>5&&(o="age-medium");let s=e.ParkingGroupName;s==="Bank_1"&&(s="Uni Wroc");const n=e.approximationInfo||{},d=n.isApproximated,p=d?n.approximated:e.CurrentFreeGroupCounterValue||0,u=n.original||e.CurrentFreeGroupCounterValue||0,x=new Date(e.Timestamp.replace(" ","T"));return r.jsxs("div",{className:"parking-card",role:"article","aria-label":`${s} parking information`,children:[r.jsx("div",{className:"parking-name",children:s}),r.jsxs("div",{className:`free-spots ${o}`,"aria-label":`${p} free parking spaces${d?" (approximated)":""}`,children:[d&&r.jsx("span",{className:"approx-indicator",title:"Approximated value",children:"â‰ˆ"}),p]}),d&&r.jsxs("div",{className:"original-value","aria-label":`Original value: ${u}`,children:["(orig: ",u,")"]}),r.jsxs("div",{className:"age-indicator-small","aria-label":`Data from ${a} minutes ago`,children:[a," min ago"]}),r.jsxs("div",{className:"timestamp-small","aria-label":`Timestamp at ${x.toLocaleTimeString("pl-PL")}`,children:["@",x.toLocaleTimeString("pl-PL")]})]})};ke.propTypes={data:T.shape({ParkingGroupName:T.string.isRequired,CurrentFreeGroupCounterValue:T.number,Timestamp:T.string.isRequired,approximationInfo:T.shape({isApproximated:T.bool,approximated:T.number,original:T.number})}).isRequired,now:T.instanceOf(Date).isRequired};const Pe=({setView:e})=>{const t=S(g=>g.realtimeData),a=S(g=>g.realtimeLoading),o=S(g=>g.realtimeError),s=S(g=>g.lastRealtimeUpdate),[n,d]=N.useState(new Date);N.useEffect(()=>{const g=setInterval(()=>d(new Date),1e3);return()=>clearInterval(g)},[]);const p=N.useMemo(()=>pt(t,n),[t,n]),u=p.some(g=>g.approximationInfo?.isApproximated),x=p.reduce((g,E)=>{const L=E.approximationInfo||{},U=L.isApproximated?L.approximated:E.CurrentFreeGroupCounterValue||0;return g+U},0),y=t.reduce((g,E)=>g+(E.CurrentFreeGroupCounterValue||0),0),R=s?`Last update: ${s.toLocaleTimeString("pl-PL")}`:"Loading...",v=()=>{if(p.length===0)return{colorClass:"",statusMessage:"No data available"};let g=0;return p.forEach(E=>{const L=V(E.Timestamp,n);g=Math.max(g,L)}),g>=15?{colorClass:"age-old",statusMessage:"Data outdated - figures may not reflect actual free spaces"}:g>5?{colorClass:"age-medium",statusMessage:"Data slightly outdated - refresh recommended"}:{colorClass:"",statusMessage:"Data is current and reliable"}},{colorClass:c,statusMessage:G}=v();return r.jsxs(r.Fragment,{children:[r.jsx(se,{title:"Parking Monitor",icon:"ðŸ…¿ï¸",onRefresh:Ie,updateStatus:R,currentView:"dashboard",setView:e}),r.jsxs("main",{className:"container-main",role:"main","aria-label":"Parking dashboard",children:[r.jsx("div",{className:"subtitle",children:"Real-time parking availability â€¢ UBS WrocÅ‚aw"}),o&&r.jsxs("div",{className:"error",role:"alert","aria-live":"polite",children:[r.jsx("strong",{children:"ERROR:"})," ",o]}),r.jsx("div",{className:"grid-container",role:"list","aria-label":"Parking facilities",children:a&&t.length===0?r.jsx("div",{className:"loader",role:"status","aria-live":"polite",children:"Loading parking data..."}):p.map((g,E)=>r.jsx(ke,{data:g,now:n},E))}),r.jsx("div",{className:`status-description ${c}`,"aria-label":"Status description",children:G}),r.jsx("div",{className:"status-panel",role:"complementary","aria-label":"Status information",children:r.jsxs("div",{className:"panel-sections-wrapper",children:[r.jsxs("div",{className:"panel-section",children:[r.jsx("div",{className:"status-label",children:"Total Spaces"}),r.jsxs("div",{className:`status-value big-value ${c}`,"aria-label":`Total free spaces: ${a?"loading":x}`,children:[u&&!a&&r.jsx("span",{className:"approx-indicator-small",title:"Includes approximated values",children:"â‰ˆ"}),a?"---":x]}),u&&!a&&r.jsxs("div",{className:"original-total","aria-label":`Original total: ${y}`,children:["(orig: ",y,")"]})]}),r.jsxs("div",{className:"panel-section",children:[r.jsx("div",{className:"status-label",children:"Last Update / Current Time"}),r.jsxs("div",{className:"time-group",children:[r.jsx("span",{"aria-label":`Last updated at ${s?s.toLocaleTimeString("pl-PL"):"unknown"}`,children:s?s.toLocaleTimeString("pl-PL"):"--:--:--"}),r.jsx("span",{className:"status-current-inline","aria-label":`Current time ${n.toLocaleTimeString("pl-PL")}`,children:n.toLocaleTimeString("pl-PL")})]})]}),r.jsxs("div",{className:"panel-section",children:[r.jsx("div",{className:"status-label",children:"Data Status"}),r.jsx("div",{className:"status-value",style:{color:o?"var(--warning)":u?"var(--age-medium)":"var(--success)"},role:"status","aria-live":"polite",children:a?"LOADING":o?"OFFLINE":u?"APPROXIMATE":"ONLINE"})]})]})})]})]})};Pe.propTypes={setView:T.func.isRequired};const Y={neon:{gd:"#05ffa1",uni:"#01beff"},classic:{gd:"#3b82f6",uni:"#f59e0b"},cyberpunk:{gd:"#00d9ff",uni:"#ff00cc"},modern:{gd:"#10b981",uni:"#6366f1"}},De=({setView:e})=>{const t=S(c=>c.historyData),a=S(c=>c.historyLoading),[o,s]=O.useState("neon"),[n,d]=O.useState(!1),{isLight:p}=Le(),[u,x]=N.useState({start:0,end:100}),y=N.useRef(null),R=N.useMemo(()=>{if(!t||t.length===0)return null;const c=p?"#1e293b":"#8b95c9",G=p?"#cbd5e1":"#2d3b6b",g=window.innerWidth<=600,E=new Map,L=new Map;t.forEach(m=>{const b=j=>Object.keys(m).find(k=>k.trim().toLowerCase()===j),C=b("gd_time"),P=b("greenday free"),w=b("uni_time"),F=b("uni free");if(C&&P&&m[C]&&m[P]){const j=m[C].trim(),k=parseFloat(m[P]);isNaN(k)||E.set(j,k)}if(w&&F&&m[w]&&m[F]){const j=m[w].trim(),k=parseFloat(m[F]);isNaN(k)||L.set(j,k)}});const U=m=>Array.from(m.entries()).map(([b,C])=>({t:new Date(b),v:C,raw:b})).filter(b=>!isNaN(b.t.getTime())).sort((b,C)=>b.t-C.t);let I=U(E),A=U(L);const W=m=>{const b=new Set;return m.filter(C=>{const P=`${C.raw}|${C.v}`;return b.has(P)?!1:(b.add(P),!0)})};if(I=W(I),A=W(A),I.length>0&&A.length>0){const m=I[0].t.getTime(),b=A[0].t.getTime();b<m&&(A[0].t=new Date(m),A[0].raw=I[0].raw),m<b&&(I[0].t=new Date(b),I[0].raw=A[0].raw)}const K=[...I.map(m=>m.t.getTime()),...A.map(m=>m.t.getTime())],M=K.length>0?Math.max(...K):null;let H=null;if(M){const m=I.find(C=>C.t.getTime()===M),b=A.find(C=>C.t.getTime()===M);H=(m||b)?.raw}const B=(m,b,C)=>{if(m.length===0)return{solid:[],gaps:[],projections:[]};const P=[],w=[],F=[];for(let k=0;k<m.length;k++)P.push([m[k].raw,m[k].v]);const j=m[m.length-1];return j&&b&&b-j.t.getTime()>1e3&&(F.push([j.raw,j.v]),F.push([C,j.v])),{solid:P,gaps:w,projections:F}},i=B(I,M,H),f=B(A,M,H),h=Y[o],l=I.length>0?"GreenDay":"GreenDay - not found",_=A.length>0?"Uni Wroc":"Uni Wroc - not found";return{backgroundColor:"transparent",animation:!0,animationDuration:300,tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"cross"}},legend:{data:[l,_],top:5,textStyle:{color:c}},grid:{left:g?10:15,right:g?10:15,bottom:g?80:50,top:40,containLabel:!0},xAxis:{type:"time",axisLabel:{color:c,margin:10},axisLine:{lineStyle:{color:G}},splitLine:{show:!1}},yAxis:{type:"value",min:-5,max:200,splitLine:{lineStyle:{color:G,opacity:.3}},axisLabel:{color:c,formatter:m=>m<0?"":m}},dataZoom:[{type:"inside",start:u.start,end:u.end,filterMode:"none"},{type:"slider",start:u.start,end:u.end,bottom:g?40:10,height:g?30:25,textStyle:{color:c,fontSize:g?11:12},filterMode:"none",handleSize:g?"180%":"100%",borderColor:c,fillerColor:"rgba(100, 149, 237, 0.3)",dataBackground:{lineStyle:{color:c,opacity:.5},areaStyle:{color:c,opacity:.2}},moveHandleSize:g?10:7,emphasis:{handleStyle:{borderWidth:2}}}],series:[{name:l,type:"line",data:i.solid,showSymbol:n,lineStyle:{width:3,color:h.gd},itemStyle:{color:h.gd},areaStyle:{color:new ne(0,0,0,1,[{offset:0,color:`${h.gd}33`},{offset:1,color:`${h.gd}00`}])},markLine:{symbol:"none",data:[{yAxis:187,lineStyle:{color:h.gd,type:"dotted",opacity:1},label:{position:"start",formatter:"187",color:h.gd,fontWeight:"bold",fontSize:13}}]}},{name:l,type:"line",data:i.gaps,showSymbol:!1,lineStyle:{width:2,color:h.gd,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:l,type:"line",data:i.projections,showSymbol:!1,lineStyle:{width:1.5,color:h.gd,type:[5,5],opacity:.5},tooltip:{show:!1}},{name:_,type:"line",data:f.solid,showSymbol:n,lineStyle:{width:3,color:h.uni},itemStyle:{color:h.uni},areaStyle:{color:new ne(0,0,0,1,[{offset:0,color:`${h.uni}33`},{offset:1,color:`${h.uni}00`}])},markLine:{symbol:"none",data:[{yAxis:41,lineStyle:{color:h.uni,type:"dotted",opacity:1},label:{position:"start",formatter:"41",color:h.uni,fontWeight:"bold",fontSize:13}}]}},{name:_,type:"line",data:f.gaps,showSymbol:!1,lineStyle:{width:2,color:h.uni,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:_,type:"line",data:f.projections,showSymbol:!1,lineStyle:{width:1.5,color:h.uni,type:[5,5],opacity:.5},tooltip:{show:!1}}]}},[t,o,n,p,u]),v={datazoom:c=>{c.batch&&c.batch[0]?x({start:c.batch[0].start,end:c.batch[0].end}):c.start!==void 0&&c.end!==void 0&&x({start:c.start,end:c.end})}};return r.jsxs("div",{className:"page-wrapper",children:[r.jsx(se,{title:"Parking History",shortTitle:"Hist",icon:"ðŸ“ˆ",onRefresh:Ie,updateStatus:a?"Updating...":"Ready",currentView:"stats",setView:e,children:r.jsxs("div",{className:"palette-group",children:[r.jsx("span",{className:"palette-label",children:"Palette:"}),Object.keys(Y).map(c=>r.jsx("div",{className:`palette-btn ${o===c?"active":""}`,style:{background:`linear-gradient(135deg, ${Y[c].gd} 50%, ${Y[c].uni} 50%)`},onClick:()=>s(c),title:c.charAt(0).toUpperCase()+c.slice(1)},c)),r.jsxs("button",{className:"palette-toggle-btn",onClick:()=>d(!n),children:["Dots: ",n?"Off":"On"]})]})}),r.jsx("main",{className:"stats-container",children:a&&t.length===0?r.jsx("div",{className:"loader",children:"Loading history data..."}):R?r.jsx(Ue,{ref:y,option:R,style:{height:"100%",width:"100%",touchAction:"none"},onEvents:v,notMerge:!1,lazyUpdate:!0,opts:{renderer:"canvas"}}):r.jsx("div",{className:"loader",children:"No data available to display."})})]})};De.propTypes={setView:T.func.isRequired};function mt(){const[e,t]=N.useState("dashboard");return r.jsx(we,{children:r.jsx(Ee,{children:r.jsx(_e,{children:e==="dashboard"?r.jsx(Pe,{setView:t}):r.jsx(De,{setView:t})})})})}const ht=qe.createRoot(document.getElementById("root"));ht.render(r.jsx(O.StrictMode,{children:r.jsx(mt,{})}));
