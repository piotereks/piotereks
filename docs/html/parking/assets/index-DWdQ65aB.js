import{r as De,g as re,R as O,a as T,L as oe,E as Pe}from"./vendor-echarts-nZu8rBDa.js";import{r as ke}from"./vendor-react-BVyvVbwp.js";import{r as Ue}from"./vendor-utils-F0zOxUcV.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function a(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=a(o);fetch(o.href,i)}})();var X={exports:{}},$={};var ne;function Fe(){if(ne)return $;ne=1;var e=De(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function d(c,m,b){var C,R={},N=null,u=null;b!==void 0&&(N=""+b),m.key!==void 0&&(N=""+m.key),m.ref!==void 0&&(u=m.ref);for(C in m)s.call(m,C)&&!i.hasOwnProperty(C)&&(R[C]=m[C]);if(c&&c.defaultProps)for(C in m=c.defaultProps,m)R[C]===void 0&&(R[C]=m[C]);return{$$typeof:t,type:c,key:N,ref:u,props:R,_owner:o.current}}return $.Fragment=a,$.jsx=d,$.jsxs=d,$}var ie;function Oe(){return ie||(ie=1,X.exports=Fe()),X.exports}var r=Oe(),z={},le;function Ge(){if(le)return z;le=1;var e=ke();return z.createRoot=e.createRoot,z.hydrateRoot=e.hydrateRoot,z}var Me=Ge();const Ve=re(Me);var Q={exports:{}},ee,ce;function He(){if(ce)return ee;ce=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return ee=e,ee}var te,ue;function $e(){if(ue)return te;ue=1;var e=He();function t(){}function a(){}return a.resetWarningCache=t,te=function(){function s(d,c,m,b,C,R){if(R!==e){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}s.isRequired=s;function o(){return s}var i={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:o,element:s,elementType:s,instanceOf:o,node:s,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:a,resetWarningCache:t};return i.PropTypes=i,i},te}var de;function qe(){return de||(de=1,Q.exports=$e()()),Q.exports}var We=qe();const v=re(We);class Te extends O.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Error caught by boundary:",t,a),this.setState({errorInfo:a})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()};render(){return this.state.hasError?r.jsx("div",{className:"error-boundary",children:r.jsxs("div",{className:"error-content",children:[r.jsx("h1",{children:"ðŸš¨ Oops! Something went wrong"}),r.jsx("p",{className:"error-message",children:"The application encountered an unexpected error."}),this.state.error&&r.jsxs("details",{className:"error-details",children:[r.jsx("summary",{children:"Error Details"}),r.jsx("pre",{children:this.state.error.toString()}),this.state.errorInfo&&r.jsx("pre",{children:this.state.errorInfo.componentStack})]}),r.jsx("button",{onClick:this.handleReset,className:"error-reset-btn",children:"ðŸ”„ Reload Application"})]})}):this.props.children}}Te.propTypes={children:v.node.isRequired};const ve=T.createContext(),Ne=({children:e})=>{const[t,a]=T.useState(localStorage.getItem("parking_theme")==="light");T.useEffect(()=>{t?(document.body.classList.remove("dark"),localStorage.setItem("parking_theme","light")):(document.body.classList.add("dark"),localStorage.setItem("parking_theme","dark"))},[t]);const s=()=>a(!t);return r.jsx(ve.Provider,{value:{isLight:t,toggleTheme:s},children:e})};Ne.propTypes={children:v.node.isRequired};const we=()=>T.useContext(ve);var Ke=Ue();const Be=re(Ke),pe=e=>{let t;const a=new Set,s=(b,C)=>{const R=typeof b=="function"?b(t):b;if(!Object.is(R,t)){const N=t;t=C??(typeof R!="object"||R===null)?R:Object.assign({},t,R),a.forEach(u=>u(t,N))}},o=()=>t,c={setState:s,getState:o,getInitialState:()=>m,subscribe:b=>(a.add(b),()=>a.delete(b))},m=t=e(s,o,c);return c},ze=(e=>e?pe(e):pe),Je=e=>e;function Ye(e,t=Je){const a=O.useSyncExternalStore(e.subscribe,O.useCallback(()=>t(e.getState()),[e,t]),O.useCallback(()=>t(e.getInitialState()),[e,t]));return O.useDebugValue(a),a}const me=e=>{const t=ze(e),a=s=>Ye(t,s);return Object.assign(a,t),a},Ze=(e=>e?me(e):me),x=Ze(e=>({realtimeData:[],realtimeLoading:!0,realtimeError:null,lastRealtimeUpdate:null,historyData:[],historyLoading:!1,lastHistoryUpdate:null,fetchInProgress:!1,refreshCallback:null,stopAutoRefresh:null,cacheCleared:!1,setRealtimeData:a=>e({realtimeData:a}),setRealtimeLoading:a=>e({realtimeLoading:a}),setRealtimeError:a=>e({realtimeError:a}),setLastRealtimeUpdate:a=>e({lastRealtimeUpdate:a}),setHistoryData:a=>e({historyData:a}),setHistoryLoading:a=>e({historyLoading:a}),setLastHistoryUpdate:a=>e({lastHistoryUpdate:a}),setFetchInProgress:a=>e({fetchInProgress:a}),setRefreshCallback:a=>e({refreshCallback:a}),setStopAutoRefresh:a=>e({stopAutoRefresh:a}),setCacheCleared:a=>e({cacheCleared:a}),updateRealtimeState:a=>e(a),updateHistoryState:a=>e(a),resetStore:()=>e({realtimeData:[],realtimeLoading:!0,realtimeError:null,lastRealtimeUpdate:null,historyData:[],historyLoading:!1,lastHistoryUpdate:null,fetchInProgress:!1,refreshCallback:null})})),je=async()=>{const e=x.getState().refreshCallback;e?await e():console.warn("Refresh callback not set yet")},Ee=()=>{try{typeof localStorage<"u"&&(localStorage.removeItem("parking_realtime_cache"),localStorage.removeItem("parking_history_cache")),x.setState({fetchInProgress:!1,cacheCleared:!0});const e=x.getState().stopAutoRefresh;if(typeof e=="function")try{e()}catch(t){console.warn("stopAutoRefresh failed",t)}console.log("Cache cleared and auto-refresh stopped")}catch(e){console.error("clearCache failed",e)}};typeof window<"u"&&(window.clearCache=Ee);const Xe=T.createContext(),Qe=["https://gd.zaparkuj.pl/api/freegroupcountervalue.json","https://gd.zaparkuj.pl/api/freegroupcountervalue-green.json"],et="https://corsproxy.io/?",tt="https://docs.google.com/spreadsheets/d/e/2PACX-1vTwLNDbg8KjlVHsZWj9JUnO_OBIyZaRgZ4gZ8_Gbyly2J3f6rlCW6lDHAihwbuLhxWbBkNMI1wdWRAq/pub?gid=411529798&single=true&output=csv",at="https://docs.google.com/forms/d/e/1FAIpQLSdeQ-rmw_VfOidGmtSNb9DLkt1RfPdduu-jH898sf3lhj17LA/formResponse",J={GREENDAY_VALUE:"entry.2026993163",GREENDAY_TIME:"entry.51469670",UNI_VALUE:"entry.1412144904",UNI_TIME:"entry.364658642"},he="parking_realtime_cache",ae="parking_history_cache",k={GD_TIME:"gd_time",GD_VALUE:"greenday free",UNI_TIME:"uni_time",UNI_VALUE:"uni free"},ge=e=>e?e.trim().toLowerCase():"",rt=(e,t)=>{if(!e)return null;const a=ge(t);return Object.keys(e).find(s=>ge(s)===a)||null},Z=(e,t)=>{const a=rt(e,t);if(!a)return;const s=e[a];return typeof s=="string"?s.trim():s},st=e=>{if(!e)return null;const t=e.includes("T")?e:e.replace(" ","T"),a=new Date(t);return Number.isNaN(a.getTime())?null:a},fe=(e,t,a)=>{if(!e)return null;const s=Z(e,t),o=st(s);if(!o)return null;const i=Z(e,a),d=i==null||i===""?null:Number(i);return{raw:s,date:o,value:Number.isNaN(d)?null:d}},ot=e=>{if(!e||e.length===0)return{gd:null,uni:null};const t=e[e.length-1];return{gd:fe(t,k.GD_TIME,k.GD_VALUE),uni:fe(t,k.UNI_TIME,k.UNI_VALUE)}},ye=(e=[])=>{const t=new Set,a=[];return e.forEach(s=>{const o=Z(s,k.GD_TIME)||"",i=Z(s,k.UNI_TIME)||"",d=`${o}|||${i}`;t.has(d)||(t.add(d),a.push(s))}),a},xe=e=>{if(!e||!e.Timestamp)return null;const t=e.Timestamp.trim();if(!t)return null;const a=t.includes("T")?t:t.replace(" ","T"),s=new Date(a);if(Number.isNaN(s.getTime()))return null;const o=Number(e.CurrentFreeGroupCounterValue);return{raw:t,date:s,value:Number.isNaN(o)?null:o}},nt=(e=[])=>Array.isArray(e)?e.map(t=>({...t||{}})):[],it=(e,t)=>({[k.GD_TIME]:e?.Timestamp||"",[k.GD_VALUE]:e?.CurrentFreeGroupCounterValue??"",[k.UNI_TIME]:t?.Timestamp||"",[k.UNI_VALUE]:t?.CurrentFreeGroupCounterValue??""}),be=()=>{if(typeof localStorage>"u")return{rows:[],timestamp:null,last:{gd:null,uni:null}};const e=localStorage.getItem(ae);if(!e)return{rows:[],timestamp:null,last:{gd:null,uni:null}};try{const t=JSON.parse(e),a=Array.isArray(t.data)?t.data:[];return{rows:a,timestamp:t.timestamp||null,last:ot(a)}}catch(t){return console.error("Failed to parse history cache snapshot:",t),{rows:[],timestamp:null,last:{gd:null,uni:null}}}},Le=({children:e})=>{const t=x(n=>n.setRealtimeData),a=x(n=>n.setRealtimeLoading),s=x(n=>n.setRealtimeError),o=x(n=>n.setLastRealtimeUpdate),i=x(n=>n.setHistoryData),d=x(n=>n.setHistoryLoading),c=x(n=>n.setLastHistoryUpdate),m=x(n=>n.setRefreshCallback),b=x(n=>n.setStopAutoRefresh),C=x(n=>n.historyData),R=T.useRef(!1),N=x(n=>n.cacheCleared),u=T.useCallback(n=>{const f=Array.isArray(n)?n:[],h=new Date;i(f),c(h);try{localStorage.setItem(ae,JSON.stringify({data:f,timestamp:h.toISOString()})),console.log("History cache updated")}catch(l){console.error("Failed to cache history data:",l)}},[i,c]),G=T.useCallback(async n=>{try{const f=n[0],h=n[1];if(!f||!h){console.log("Missing data for form submission");return}const l=f.CurrentFreeGroupCounterValue||0,A=f.Timestamp||"",p=h.CurrentFreeGroupCounterValue||0,y=h.Timestamp||"",S=new URLSearchParams;S.append(J.GREENDAY_VALUE,l.toString()),S.append(J.GREENDAY_TIME,A),S.append(J.UNI_VALUE,p.toString()),S.append(J.UNI_TIME,y),console.log("Submitting to Google Form:",{greenDay:{value:l,time:A},uni:{value:p,time:y}}),await fetch(at,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:S.toString(),mode:"no-cors"}),console.log("Form submission completed")}catch(f){console.error("Failed to submit to Google Form:",f)}},[]),g=T.useCallback(async()=>{if(N){console.log("Cache cleared â€” skipping history fetch");return}d(!0);try{const f=await(await fetch(`${tt}&time=${Date.now()}`,{cache:"no-store"})).text();Be.parse(f,{header:!0,skipEmptyLines:!0,complete:h=>{const l=ye(h.data||[]);console.log("CSV fetched, parsed, and deduplicated"),u(l),d(!1)}})}catch(n){console.error("Failed to fetch history data:",n),d(!1)}},[u,d,N]),E=T.useCallback(async n=>{try{const f=xe(n[0]),h=xe(n[1]);console.log("API timestamps:",{gd:f?.date?.toISOString(),uni:h?.date?.toISOString()});let l=be();l.rows.length&&C.length===0&&(i(l.rows),l.timestamp&&c(new Date(l.timestamp)));const A=!f?.date||l.last.gd?.date&&f.date.getTime()<=l.last.gd.date.getTime(),p=!h?.date||l.last.uni?.date&&h.date.getTime()<=l.last.uni.date.getTime();if(l.rows.length>0&&A&&p){console.log("Fast path hit â€” cache already covers API timestamps");return}console.log("Slow path triggered â€” fetching CSV for reconciliation"),await g(),l=be(),l.rows.length&&(i(l.rows),l.timestamp&&c(new Date(l.timestamp)));const S=f?.date?!l.last.gd?.date||f.date.getTime()>l.last.gd.date.getTime():!1,P=h?.date?!l.last.uni?.date||h.date.getTime()>l.last.uni.date.getTime():!1;if(!S&&!P){console.log("After reconciliation, no newer timestamps detected");return}const w=nt(n);for(;w.length<2;)w.push({});if(l.last.gd?.date){const j=f?.date;(!j||j.getTime()<l.last.gd.date.getTime())&&(w[0]={...w[0],Timestamp:l.last.gd.raw,CurrentFreeGroupCounterValue:l.last.gd.value??w[0].CurrentFreeGroupCounterValue??0})}if(l.last.uni?.date){const j=h?.date;(!j||j.getTime()<l.last.uni.date.getTime())&&(w[1]={...w[1],Timestamp:l.last.uni.raw,CurrentFreeGroupCounterValue:l.last.uni.value??w[1].CurrentFreeGroupCounterValue??0})}await G(w);const U=ye([...l.rows,it(w[0],w[1])]);u(U)}catch(f){console.error("Error checking history update:",f)}},[g,C.length,u,G,i,c]),L=T.useCallback(async()=>{if(N){console.log("Cache cleared â€” skipping realtime fetch");return}if(R.current){console.log("Fetch already in progress, skipping...");return}R.current=!0,a(!0),s(null);try{const n=localStorage.getItem(he);if(n)try{const l=JSON.parse(n);t(l.data),o(new Date(l.timestamp)),console.log("Real-time cache loaded")}catch(l){console.error("Failed to parse real-time cache:",l)}const f=await Promise.all(Qe.map(l=>fetch(`${et}${encodeURIComponent(l+"?time="+Date.now())}`).then(A=>A.ok?A.json():Promise.reject(`HTTP ${A.status}`))));t(f);const h=new Date;o(h);try{localStorage.setItem(he,JSON.stringify({data:f,timestamp:h.toISOString()}))}catch(l){console.error("Failed to cache real-time data:",l)}await E(f)}catch(n){console.error("Failed to fetch real-time data:",n),s(n.toString())}finally{a(!1),R.current=!1}},[t,a,s,o,E,N]);T.useEffect(()=>{const n=localStorage.getItem(ae);if(n)try{const f=JSON.parse(n);i(f.data),c(new Date(f.timestamp)),console.log("History cache loaded on mount")}catch(f){console.error("Failed to load history cache on mount:",f)}},[i,c]),T.useEffect(()=>{if(N){console.log("Cache cleared â€” skipping initial realtime fetch and auto-refresh");return}L();const n=setInterval(L,300*1e3);try{b(()=>()=>clearInterval(n))}catch(f){console.warn("Failed to register stopAutoRefresh",f)}return()=>clearInterval(n)},[L,b,N]);const F=T.useCallback(async()=>{console.log("Manual refresh triggered"),await L()},[L]);T.useEffect(()=>{m(F)},[F,m]);const I=x(n=>n.realtimeData),_=x(n=>n.realtimeLoading),W=x(n=>n.realtimeError),K=x(n=>n.lastRealtimeUpdate),M=x(n=>n.historyLoading),H=x(n=>n.lastHistoryUpdate),B={realtimeData:I,realtimeLoading:_,realtimeError:W,lastRealtimeUpdate:K,historyData:C,historyLoading:M,lastHistoryUpdate:H,refresh:F};return r.jsx(Xe.Provider,{value:B,children:e})};Le.propTypes={children:v.node.isRequired};const se=({title:e,shortTitle:t,icon:a,onRefresh:s,updateStatus:o,currentView:i,setView:d,children:c})=>{const{isLight:m,toggleTheme:b}=we();return r.jsxs("header",{className:"header-controls",role:"banner",children:[r.jsxs("div",{className:"header-title-group",children:[r.jsxs("h1",{children:[r.jsx("span",{className:"title-icon",role:"img","aria-label":`${e} icon`,children:a}),r.jsxs("span",{className:"title-text-full",children:[" ",e]}),r.jsxs("span",{className:"title-text-short",children:[" ",t||e]})]}),r.jsx("div",{className:"status-info",role:"status","aria-live":"polite",children:o})]}),r.jsxs("div",{className:"header-actions",role:"navigation","aria-label":"Main navigation",children:[c,(typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams).has("clear_cache")?r.jsxs("button",{className:"nav-btn",onClick:()=>Ee(),"aria-label":"Clear cache",children:[r.jsx("span",{className:"btn-icon",role:"img","aria-label":"Broom icon",children:"ðŸ§¹"}),r.jsx("span",{className:"btn-text",children:"Clear Cache"})]}):s?r.jsxs("button",{className:"nav-btn",onClick:s,"aria-label":"Refresh data",children:[r.jsx("span",{className:"btn-icon",role:"img","aria-label":"Refresh icon",children:"âŸ³"}),r.jsx("span",{className:"btn-text",children:"Refresh"})]}):null,i==="stats"&&r.jsxs("button",{className:"nav-btn",onClick:()=>d("dashboard"),"aria-label":"Go to dashboard",children:[r.jsx("span",{className:"btn-icon",role:"img","aria-label":"Home icon",children:"ðŸ "}),r.jsx("span",{className:"btn-text",children:"Dashboard"})]}),i==="dashboard"&&r.jsxs("button",{className:"nav-btn",onClick:()=>d("stats"),"aria-label":"Go to statistics",children:[r.jsx("span",{className:"btn-icon",role:"img","aria-label":"Chart icon",children:"ðŸ“Š"}),r.jsx("span",{className:"btn-text",children:"Statistics"})]}),r.jsx("button",{className:"theme-toggle",onClick:b,"aria-label":m?"Switch to dark theme":"Switch to light theme",children:m?"ðŸŒ™":"â˜€ï¸"})]})]})};se.propTypes={title:v.string.isRequired,shortTitle:v.string,icon:v.string.isRequired,onRefresh:v.func,updateStatus:v.string.isRequired,currentView:v.oneOf(["dashboard","stats"]).isRequired,setView:v.func.isRequired,children:v.node};const Se={GreenDay:187,Bank_1:41,"Uni Wroc":41},lt=100,q=30,ct=e=>e?e==="Bank_1"?"Uni Wroc":e:"Unknown",V=(e,t=new Date)=>{if(!e)return 1/0;const a=new Date(e.replace(" ","T"));return Math.max(0,Math.floor((t-a)/1e3/60))},Ce=e=>Se[e]||Se[ct(e)]||lt,Re=(e,t,a=new Date)=>{if(!e||!t)return{approximated:null,original:null,isApproximated:!1,reason:"Missing data"};const s=V(e.Timestamp,a);if(s<q)return{approximated:e.CurrentFreeGroupCounterValue||0,original:e.CurrentFreeGroupCounterValue||0,isApproximated:!1,ageMinutes:s};const o=Ce(e.ParkingGroupName),i=Ce(t.ParkingGroupName),d=t.CurrentFreeGroupCounterValue||0,c=d/i,m=Math.round(c*o);return{approximated:m,original:e.CurrentFreeGroupCounterValue||0,isApproximated:!0,ageMinutes:s,freshRatio:c,calculation:`(${d} / ${i}) * ${o} = ${m}`}},ut=(e,t=new Date)=>{if(!Array.isArray(e)||e.length===0)return[];if(e.length!==2)return e.map(c=>({...c,approximationInfo:{isApproximated:!1,original:c.CurrentFreeGroupCounterValue||0,approximated:c.CurrentFreeGroupCounterValue||0,ageMinutes:V(c?.Timestamp,t)}}));const a=e[0],s=e[1],o=V(a?.Timestamp,t),i=V(s?.Timestamp,t),d=[];if(o>=q&&i<q){const c=Re(a,s,t);d.push({...a,approximationInfo:c})}else d.push({...a,approximationInfo:{isApproximated:!1,original:a?.CurrentFreeGroupCounterValue||0,approximated:a?.CurrentFreeGroupCounterValue||0,ageMinutes:o}});if(i>=q&&o<q){const c=Re(s,a,t);d.push({...s,approximationInfo:c})}else d.push({...s,approximationInfo:{isApproximated:!1,original:s?.CurrentFreeGroupCounterValue||0,approximated:s?.CurrentFreeGroupCounterValue||0,ageMinutes:i}});return d},Ie=({data:e,now:t})=>{const a=V(e.Timestamp,t);let s="";a>=15?s="age-old":a>5&&(s="age-medium");let o=e.ParkingGroupName;o==="Bank_1"&&(o="Uni Wroc");const i=e.approximationInfo||{},d=i.isApproximated,c=d?i.approximated:e.CurrentFreeGroupCounterValue||0,m=i.original||e.CurrentFreeGroupCounterValue||0,b=new Date(e.Timestamp.replace(" ","T"));return r.jsxs("div",{className:"parking-card",role:"article","aria-label":`${o} parking information`,children:[r.jsx("div",{className:"parking-name",children:o}),r.jsxs("div",{className:`free-spots ${s}`,"aria-label":`${c} free parking spaces${d?" (approximated)":""}`,children:[c,d&&r.jsx("span",{className:"approx-indicator",title:"Approximated value",children:"â‰ˆ"})]}),d&&r.jsxs("div",{className:"original-value","aria-label":`Original value: ${m}`,children:["(orig: ",m,")"]}),r.jsxs("div",{className:"age-indicator-small","aria-label":`Data from ${a} minutes ago`,children:[a," min ago"]}),r.jsxs("div",{className:"timestamp-small","aria-label":`Timestamp at ${b.toLocaleTimeString("pl-PL")}`,children:["@",b.toLocaleTimeString("pl-PL")]})]})};Ie.propTypes={data:v.shape({ParkingGroupName:v.string.isRequired,CurrentFreeGroupCounterValue:v.number,Timestamp:v.string.isRequired,approximationInfo:v.shape({isApproximated:v.bool,approximated:v.number,original:v.number})}).isRequired,now:v.instanceOf(Date).isRequired};const _e=({setView:e})=>{const t=x(g=>g.realtimeData),a=x(g=>g.realtimeLoading),s=x(g=>g.realtimeError),o=x(g=>g.lastRealtimeUpdate),[i,d]=T.useState(new Date);T.useEffect(()=>{const g=setInterval(()=>d(new Date),1e3);return()=>clearInterval(g)},[]);const c=T.useMemo(()=>ut(t,i),[t,i]),m=c.some(g=>g.approximationInfo?.isApproximated),b=c.reduce((g,E)=>{const L=E.approximationInfo||{},F=L.isApproximated?L.approximated:E.CurrentFreeGroupCounterValue||0;return g+F},0),C=t.reduce((g,E)=>g+(E.CurrentFreeGroupCounterValue||0),0),R=o?`Last update: ${o.toLocaleTimeString("pl-PL")}`:"Loading...",N=()=>{if(c.length===0)return{colorClass:"",statusMessage:"No data available"};let g=0;return c.forEach(E=>{const L=V(E.Timestamp,i);g=Math.max(g,L)}),g>=15?{colorClass:"age-old",statusMessage:"Data outdated - figures may not reflect actual free spaces"}:g>5?{colorClass:"age-medium",statusMessage:"Data slightly outdated - refresh recommended"}:{colorClass:"",statusMessage:"Data is current and reliable"}},{colorClass:u,statusMessage:G}=N();return r.jsxs(r.Fragment,{children:[r.jsx(se,{title:"Parking Monitor",icon:"ðŸ…¿ï¸",onRefresh:je,updateStatus:R,currentView:"dashboard",setView:e}),r.jsxs("main",{className:"container-main",role:"main","aria-label":"Parking dashboard",children:[r.jsx("div",{className:"subtitle",children:"Real-time parking availability â€¢ UBS WrocÅ‚aw"}),s&&r.jsxs("div",{className:"error",role:"alert","aria-live":"polite",children:[r.jsx("strong",{children:"ERROR:"})," ",s]}),r.jsx("div",{className:"grid-container",role:"list","aria-label":"Parking facilities",children:a&&t.length===0?r.jsx("div",{className:"loader",role:"status","aria-live":"polite",children:"Loading parking data..."}):c.map((g,E)=>r.jsx(Ie,{data:g,now:i},E))}),r.jsx("div",{className:`status-description ${u}`,"aria-label":"Status description",children:G}),r.jsxs("div",{className:"status-panel",role:"complementary","aria-label":"Status information",children:[r.jsxs("div",{className:"panel-section",children:[r.jsx("div",{className:"status-label",children:"Total Spaces"}),r.jsxs("div",{className:`status-value big-value ${u}`,"aria-label":`Total free spaces: ${a?"loading":b}`,children:[a?"---":b,m&&!a&&r.jsx("span",{className:"approx-indicator-small",title:"Includes approximated values",children:"â‰ˆ"})]}),m&&!a&&r.jsxs("div",{className:"original-total","aria-label":`Original total: ${C}`,children:["(orig: ",C,")"]})]}),r.jsxs("div",{className:"panel-section",children:[r.jsx("div",{className:"status-label",children:"Last Update / Current Time"}),r.jsxs("div",{className:"time-group",children:[r.jsx("span",{"aria-label":`Last updated at ${o?o.toLocaleTimeString("pl-PL"):"unknown"}`,children:o?o.toLocaleTimeString("pl-PL"):"--:--:--"}),r.jsx("span",{className:"status-current-inline","aria-label":`Current time ${i.toLocaleTimeString("pl-PL")}`,children:i.toLocaleTimeString("pl-PL")})]})]}),r.jsxs("div",{className:"panel-section",children:[r.jsx("div",{className:"status-label",children:"Data Status"}),r.jsx("div",{className:"status-value",style:{color:s?"var(--warning)":m?"var(--age-medium)":"var(--success)"},role:"status","aria-live":"polite",children:a?"LOADING":s?"OFFLINE":m?"APPROXIMATE":"ONLINE"})]})]})]})]})};_e.propTypes={setView:v.func.isRequired};const Y={neon:{gd:"#05ffa1",uni:"#01beff"},classic:{gd:"#3b82f6",uni:"#f59e0b"},cyberpunk:{gd:"#00d9ff",uni:"#ff00cc"},modern:{gd:"#10b981",uni:"#6366f1"}},Ae=({setView:e})=>{const t=x(u=>u.historyData),a=x(u=>u.historyLoading),[s,o]=O.useState("neon"),[i,d]=O.useState(!1),{isLight:c}=we(),[m,b]=T.useState({start:0,end:100}),C=T.useRef(null),R=T.useMemo(()=>{if(!t||t.length===0)return null;const u=c?"#1e293b":"#8b95c9",G=c?"#cbd5e1":"#2d3b6b",g=window.innerWidth<=600,E=new Map,L=new Map;t.forEach(p=>{const y=j=>Object.keys(p).find(D=>D.trim().toLowerCase()===j),S=y("gd_time"),P=y("greenday free"),w=y("uni_time"),U=y("uni free");if(S&&P&&p[S]&&p[P]){const j=p[S].trim(),D=parseFloat(p[P]);isNaN(D)||E.set(j,D)}if(w&&U&&p[w]&&p[U]){const j=p[w].trim(),D=parseFloat(p[U]);isNaN(D)||L.set(j,D)}});const F=p=>Array.from(p.entries()).map(([y,S])=>({t:new Date(y),v:S,raw:y})).filter(y=>!isNaN(y.t.getTime())).sort((y,S)=>y.t-S.t);let I=F(E),_=F(L);const W=p=>{const y=new Set;return p.filter(S=>{const P=`${S.raw}|${S.v}`;return y.has(P)?!1:(y.add(P),!0)})};if(I=W(I),_=W(_),I.length>0&&_.length>0){const p=I[0].t.getTime(),y=_[0].t.getTime();y<p&&(_[0].t=new Date(p),_[0].raw=I[0].raw),p<y&&(I[0].t=new Date(y),I[0].raw=_[0].raw)}const K=[...I.map(p=>p.t.getTime()),..._.map(p=>p.t.getTime())],M=K.length>0?Math.max(...K):null;let H=null;if(M){const p=I.find(S=>S.t.getTime()===M),y=_.find(S=>S.t.getTime()===M);H=(p||y)?.raw}const B=(p,y,S)=>{if(p.length===0)return{solid:[],gaps:[],projections:[]};const P=[],w=[],U=[];for(let D=0;D<p.length;D++)P.push([p[D].raw,p[D].v]);const j=p[p.length-1];return j&&y&&y-j.t.getTime()>1e3&&(U.push([j.raw,j.v]),U.push([S,j.v])),{solid:P,gaps:w,projections:U}},n=B(I,M,H),f=B(_,M,H),h=Y[s],l=I.length>0?"GreenDay":"GreenDay - not found",A=_.length>0?"Uni Wroc":"Uni Wroc - not found";return{backgroundColor:"transparent",animation:!0,animationDuration:300,tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"cross"}},legend:{data:[l,A],top:5,textStyle:{color:u}},grid:{left:g?10:15,right:g?10:15,bottom:g?80:50,top:40,containLabel:!0},xAxis:{type:"time",axisLabel:{color:u,margin:10},axisLine:{lineStyle:{color:G}},splitLine:{show:!1}},yAxis:{type:"value",min:-5,max:200,splitLine:{lineStyle:{color:G,opacity:.3}},axisLabel:{color:u,formatter:p=>p<0?"":p}},dataZoom:[{type:"inside",start:m.start,end:m.end,filterMode:"none"},{type:"slider",start:m.start,end:m.end,bottom:g?40:10,height:g?30:25,textStyle:{color:u,fontSize:g?11:12},filterMode:"none",handleSize:g?"180%":"100%",borderColor:u,fillerColor:"rgba(100, 149, 237, 0.3)",dataBackground:{lineStyle:{color:u,opacity:.5},areaStyle:{color:u,opacity:.2}},moveHandleSize:g?10:7,emphasis:{handleStyle:{borderWidth:2}}}],series:[{name:l,type:"line",data:n.solid,showSymbol:i,lineStyle:{width:3,color:h.gd},itemStyle:{color:h.gd},areaStyle:{color:new oe(0,0,0,1,[{offset:0,color:`${h.gd}33`},{offset:1,color:`${h.gd}00`}])},markLine:{symbol:"none",data:[{yAxis:187,lineStyle:{color:h.gd,type:"dotted",opacity:1},label:{position:"start",formatter:"187",color:h.gd,fontWeight:"bold",fontSize:13}}]}},{name:l,type:"line",data:n.gaps,showSymbol:!1,lineStyle:{width:2,color:h.gd,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:l,type:"line",data:n.projections,showSymbol:!1,lineStyle:{width:1.5,color:h.gd,type:[5,5],opacity:.5},tooltip:{show:!1}},{name:A,type:"line",data:f.solid,showSymbol:i,lineStyle:{width:3,color:h.uni},itemStyle:{color:h.uni},areaStyle:{color:new oe(0,0,0,1,[{offset:0,color:`${h.uni}33`},{offset:1,color:`${h.uni}00`}])},markLine:{symbol:"none",data:[{yAxis:41,lineStyle:{color:h.uni,type:"dotted",opacity:1},label:{position:"start",formatter:"41",color:h.uni,fontWeight:"bold",fontSize:13}}]}},{name:A,type:"line",data:f.gaps,showSymbol:!1,lineStyle:{width:2,color:h.uni,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:A,type:"line",data:f.projections,showSymbol:!1,lineStyle:{width:1.5,color:h.uni,type:[5,5],opacity:.5},tooltip:{show:!1}}]}},[t,s,i,c,m]),N={datazoom:u=>{u.batch&&u.batch[0]?b({start:u.batch[0].start,end:u.batch[0].end}):u.start!==void 0&&u.end!==void 0&&b({start:u.start,end:u.end})}};return r.jsxs("div",{className:"page-wrapper",children:[r.jsx(se,{title:"Parking History",shortTitle:"Hist",icon:"ðŸ“ˆ",onRefresh:je,updateStatus:a?"Updating...":"Ready",currentView:"stats",setView:e,children:r.jsxs("div",{className:"palette-group",children:[r.jsx("span",{className:"palette-label",children:"Palette:"}),Object.keys(Y).map(u=>r.jsx("div",{className:`palette-btn ${s===u?"active":""}`,style:{background:`linear-gradient(135deg, ${Y[u].gd} 50%, ${Y[u].uni} 50%)`},onClick:()=>o(u),title:u.charAt(0).toUpperCase()+u.slice(1)},u)),r.jsxs("button",{className:"palette-toggle-btn",onClick:()=>d(!i),children:["Dots: ",i?"Off":"On"]})]})}),r.jsx("main",{className:"stats-container",children:a&&t.length===0?r.jsx("div",{className:"loader",children:"Loading history data..."}):R?r.jsx(Pe,{ref:C,option:R,style:{height:"100%",width:"100%",touchAction:"none"},onEvents:N,notMerge:!1,lazyUpdate:!0,opts:{renderer:"canvas"}}):r.jsx("div",{className:"loader",children:"No data available to display."})})]})};Ae.propTypes={setView:v.func.isRequired};function dt(){const[e,t]=T.useState("dashboard");return r.jsx(Te,{children:r.jsx(Ne,{children:r.jsx(Le,{children:e==="dashboard"?r.jsx(_e,{setView:t}):r.jsx(Ae,{setView:t})})})})}const pt=Ve.createRoot(document.getElementById("root"));pt.render(r.jsx(O.StrictMode,{children:r.jsx(dt,{})}));
