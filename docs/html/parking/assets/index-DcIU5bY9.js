import{r as Fe,g as se,R as $,a as j,L as ne,E as Oe}from"./vendor-echarts-nZu8rBDa.js";import{r as Ue}from"./vendor-react-BVyvVbwp.js";import{r as Ge}from"./vendor-utils-F0zOxUcV.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const p of o.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&r(p)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();var X={exports:{}},K={};var ie;function Me(){if(ie)return K;ie=1;var e=Fe(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function p(d,l,g){var m,x={},v=null,u=null;g!==void 0&&(v=""+g),l.key!==void 0&&(v=""+l.key),l.ref!==void 0&&(u=l.ref);for(m in l)r.call(l,m)&&!o.hasOwnProperty(m)&&(x[m]=l[m]);if(d&&d.defaultProps)for(m in l=d.defaultProps,l)x[m]===void 0&&(x[m]=l[m]);return{$$typeof:t,type:d,key:v,ref:u,props:x,_owner:n.current}}return K.Fragment=a,K.jsx=p,K.jsxs=p,K}var le;function Ve(){return le||(le=1,X.exports=Me()),X.exports}var s=Ve(),z={},ce;function $e(){if(ce)return z;ce=1;var e=Ue();return z.createRoot=e.createRoot,z.hydrateRoot=e.hydrateRoot,z}var He=$e();const qe=se(He);var Q={exports:{}},ee,ue;function We(){if(ue)return ee;ue=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return ee=e,ee}var te,de;function Ke(){if(de)return te;de=1;var e=We();function t(){}function a(){}return a.resetWarningCache=t,te=function(){function r(p,d,l,g,m,x){if(x!==e){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}r.isRequired=r;function n(){return r}var o={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:n,element:r,elementType:r,instanceOf:n,node:r,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:a,resetWarningCache:t};return o.PropTypes=o,o},te}var pe;function Be(){return pe||(pe=1,Q.exports=Ke()()),Q.exports}var ze=Be();const T=se(ze);class we extends $.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Error caught by boundary:",t,a),this.setState({errorInfo:a})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()};render(){return this.state.hasError?s.jsx("div",{className:"error-boundary",children:s.jsxs("div",{className:"error-content",children:[s.jsx("h1",{children:"ðŸš¨ Oops! Something went wrong"}),s.jsx("p",{className:"error-message",children:"The application encountered an unexpected error."}),this.state.error&&s.jsxs("details",{className:"error-details",children:[s.jsx("summary",{children:"Error Details"}),s.jsx("pre",{children:this.state.error.toString()}),this.state.errorInfo&&s.jsx("pre",{children:this.state.errorInfo.componentStack})]}),s.jsx("button",{onClick:this.handleReset,className:"error-reset-btn",children:"ðŸ”„ Reload Application"})]})}):this.props.children}}we.propTypes={children:T.node.isRequired};const je=j.createContext(),Le=({children:e})=>{const[t,a]=j.useState(localStorage.getItem("parking_theme")==="light");j.useEffect(()=>{t?(document.body.classList.remove("dark"),localStorage.setItem("parking_theme","light")):(document.body.classList.add("dark"),localStorage.setItem("parking_theme","dark"))},[t]);const r=()=>a(!t);return s.jsx(je.Provider,{value:{isLight:t,toggleTheme:r},children:e})};Le.propTypes={children:T.node.isRequired};const Ee=()=>j.useContext(je);var Je=Ge();const Ye=se(Je),me=e=>{let t;const a=new Set,r=(g,m)=>{const x=typeof g=="function"?g(t):g;if(!Object.is(x,t)){const v=t;t=m??(typeof x!="object"||x===null)?x:Object.assign({},t,x),a.forEach(u=>u(t,v))}},n=()=>t,d={setState:r,getState:n,getInitialState:()=>l,subscribe:g=>(a.add(g),()=>a.delete(g))},l=t=e(r,n,d);return d},Ze=(e=>e?me(e):me),Xe=e=>e;function Qe(e,t=Xe){const a=$.useSyncExternalStore(e.subscribe,$.useCallback(()=>t(e.getState()),[e,t]),$.useCallback(()=>t(e.getInitialState()),[e,t]));return $.useDebugValue(a),a}const he=e=>{const t=Ze(e),a=r=>Qe(t,r);return Object.assign(a,t),a},et=(e=>e?he(e):he),R=et(e=>({realtimeData:[],realtimeLoading:!0,realtimeError:null,lastRealtimeUpdate:null,historyData:[],historyLoading:!1,lastHistoryUpdate:null,fetchInProgress:!1,refreshCallback:null,stopAutoRefresh:null,cacheCleared:!1,setRealtimeData:a=>e({realtimeData:a}),setRealtimeLoading:a=>e({realtimeLoading:a}),setRealtimeError:a=>e({realtimeError:a}),setLastRealtimeUpdate:a=>e({lastRealtimeUpdate:a}),setHistoryData:a=>e({historyData:a}),setHistoryLoading:a=>e({historyLoading:a}),setLastHistoryUpdate:a=>e({lastHistoryUpdate:a}),setFetchInProgress:a=>e({fetchInProgress:a}),setRefreshCallback:a=>e({refreshCallback:a}),setStopAutoRefresh:a=>e({stopAutoRefresh:a}),setCacheCleared:a=>e({cacheCleared:a}),updateRealtimeState:a=>e(a),updateHistoryState:a=>e(a),resetStore:()=>e({realtimeData:[],realtimeLoading:!0,realtimeError:null,lastRealtimeUpdate:null,historyData:[],historyLoading:!1,lastHistoryUpdate:null,fetchInProgress:!1,refreshCallback:null})})),Ie=async()=>{const e=R.getState().refreshCallback;e?await e():console.warn("Refresh callback not set yet")},Ae=()=>{try{typeof localStorage<"u"&&(localStorage.removeItem("parking_realtime_cache"),localStorage.removeItem("parking_history_cache")),R.setState({fetchInProgress:!1,cacheCleared:!0});const e=R.getState().stopAutoRefresh;if(typeof e=="function")try{e()}catch(t){console.warn("stopAutoRefresh failed",t)}console.log("Cache cleared and auto-refresh stopped")}catch(e){console.error("clearCache failed",e)}};typeof window<"u"&&(window.clearCache=Ae);const tt=j.createContext(),at=["https://gd.zaparkuj.pl/api/freegroupcountervalue.json","https://gd.zaparkuj.pl/api/freegroupcountervalue-green.json"],rt="https://corsproxy.io/?",st="https://docs.google.com/spreadsheets/d/e/2PACX-1vTwLNDbg8KjlVHsZWj9JUnO_OBIyZaRgZ4gZ8_Gbyly2J3f6rlCW6lDHAihwbuLhxWbBkNMI1wdWRAq/pub?gid=411529798&single=true&output=csv",ot="https://docs.google.com/forms/d/e/1FAIpQLSdeQ-rmw_VfOidGmtSNb9DLkt1RfPdduu-jH898sf3lhj17LA/formResponse",J={GREENDAY_VALUE:"entry.2026993163",GREENDAY_TIME:"entry.51469670",UNI_VALUE:"entry.1412144904",UNI_TIME:"entry.364658642"},ge="parking_realtime_cache",re="parking_history_cache",U={GD_TIME:"gd_time",GD_VALUE:"greenday free",UNI_TIME:"uni_time",UNI_VALUE:"uni free"},fe=e=>e?e.trim().toLowerCase():"",nt=(e,t)=>{if(!e)return null;const a=fe(t);return Object.keys(e).find(r=>fe(r)===a)||null},Z=(e,t)=>{const a=nt(e,t);if(!a)return;const r=e[a];return typeof r=="string"?r.trim():r},it=e=>{if(!e)return null;const t=e.includes("T")?e:e.replace(" ","T"),a=new Date(t);return Number.isNaN(a.getTime())?null:a},ye=(e,t,a)=>{if(!e)return null;const r=Z(e,t),n=it(r);if(!n)return null;const o=Z(e,a),p=o==null||o===""?null:Number(o);return{raw:r,date:n,value:Number.isNaN(p)?null:p}},lt=e=>{if(!e||e.length===0)return{gd:null,uni:null};const t=e[e.length-1];return{gd:ye(t,U.GD_TIME,U.GD_VALUE),uni:ye(t,U.UNI_TIME,U.UNI_VALUE)}},be=(e=[])=>{const t=new Set,a=[];return e.forEach(r=>{const n=Z(r,U.GD_TIME)||"",o=Z(r,U.UNI_TIME)||"",p=`${n}|||${o}`;t.has(p)||(t.add(p),a.push(r))}),a},xe=e=>{if(!e||!e.Timestamp)return null;const t=e.Timestamp.trim();if(!t)return null;const a=t.includes("T")?t:t.replace(" ","T"),r=new Date(a);if(Number.isNaN(r.getTime()))return null;const n=Number(e.CurrentFreeGroupCounterValue);return{raw:t,date:r,value:Number.isNaN(n)?null:n}},ct=(e=[])=>Array.isArray(e)?e.map(t=>({...t||{}})):[],ut=(e,t)=>({[U.GD_TIME]:e?.Timestamp||"",[U.GD_VALUE]:e?.CurrentFreeGroupCounterValue??"",[U.UNI_TIME]:t?.Timestamp||"",[U.UNI_VALUE]:t?.CurrentFreeGroupCounterValue??""}),Se=()=>{if(typeof localStorage>"u")return{rows:[],timestamp:null,last:{gd:null,uni:null}};const e=localStorage.getItem(re);if(!e)return{rows:[],timestamp:null,last:{gd:null,uni:null}};try{const t=JSON.parse(e),a=Array.isArray(t.data)?t.data:[];return{rows:a,timestamp:t.timestamp||null,last:lt(a)}}catch(t){return console.error("Failed to parse history cache snapshot:",t),{rows:[],timestamp:null,last:{gd:null,uni:null}}}},De=({children:e})=>{const t=R(i=>i.setRealtimeData),a=R(i=>i.setRealtimeLoading),r=R(i=>i.setRealtimeError),n=R(i=>i.setLastRealtimeUpdate),o=R(i=>i.setHistoryData),p=R(i=>i.setHistoryLoading),d=R(i=>i.setLastHistoryUpdate),l=R(i=>i.setRefreshCallback),g=R(i=>i.setStopAutoRefresh),m=R(i=>i.historyData),x=j.useRef(!1),v=R(i=>i.cacheCleared),u=j.useCallback(i=>{const y=Array.isArray(i)?i:[],f=new Date;o(y),d(f);try{localStorage.setItem(re,JSON.stringify({data:y,timestamp:f.toISOString()})),console.log("History cache updated")}catch(c){console.error("Failed to cache history data:",c)}},[o,d]),M=j.useCallback(async i=>{try{const y=i[0],f=i[1];if(!y||!f){console.log("Missing data for form submission");return}const c=y.CurrentFreeGroupCounterValue||0,D=y.Timestamp||"",h=f.CurrentFreeGroupCounterValue||0,C=f.Timestamp||"",N=new URLSearchParams;N.append(J.GREENDAY_VALUE,c.toString()),N.append(J.GREENDAY_TIME,D),N.append(J.UNI_VALUE,h.toString()),N.append(J.UNI_TIME,C),console.log("Submitting to Google Form:",{greenDay:{value:c,time:D},uni:{value:h,time:C}}),await fetch(ot,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:N.toString(),mode:"no-cors"}),console.log("Form submission completed")}catch(y){console.error("Failed to submit to Google Form:",y)}},[]),I=j.useCallback(async()=>{if(v){console.log("Cache cleared â€” skipping history fetch");return}p(!0);try{const y=await(await fetch(`${st}&time=${Date.now()}`,{cache:"no-store"})).text();Ye.parse(y,{header:!0,skipEmptyLines:!0,complete:f=>{const c=be(f.data||[]);console.log("CSV fetched, parsed, and deduplicated"),u(c),p(!1)}})}catch(i){console.error("Failed to fetch history data:",i),p(!1)}},[u,p,v]),V=j.useCallback(async i=>{try{const y=xe(i[0]),f=xe(i[1]);console.log("API timestamps:",{gd:y?.date?.toISOString(),uni:f?.date?.toISOString()});let c=Se();c.rows.length&&m.length===0&&(o(c.rows),c.timestamp&&d(new Date(c.timestamp)));const D=!y?.date||c.last.gd?.date&&y.date.getTime()<=c.last.gd.date.getTime(),h=!f?.date||c.last.uni?.date&&f.date.getTime()<=c.last.uni.date.getTime();if(c.rows.length>0&&D&&h){console.log("Fast path hit â€” cache already covers API timestamps");return}console.log("Slow path triggered â€” fetching CSV for reconciliation"),await I(),c=Se(),c.rows.length&&(o(c.rows),c.timestamp&&d(new Date(c.timestamp)));const N=y?.date?!c.last.gd?.date||y.date.getTime()>c.last.gd.date.getTime():!1,F=f?.date?!c.last.uni?.date||f.date.getTime()>c.last.uni.date.getTime():!1;if(!N&&!F){console.log("After reconciliation, no newer timestamps detected");return}const L=ct(i);for(;L.length<2;)L.push({});if(c.last.gd?.date){const E=y?.date;(!E||E.getTime()<c.last.gd.date.getTime())&&(L[0]={...L[0],Timestamp:c.last.gd.raw,CurrentFreeGroupCounterValue:c.last.gd.value??L[0].CurrentFreeGroupCounterValue??0})}if(c.last.uni?.date){const E=f?.date;(!E||E.getTime()<c.last.uni.date.getTime())&&(L[1]={...L[1],Timestamp:c.last.uni.raw,CurrentFreeGroupCounterValue:c.last.uni.value??L[1].CurrentFreeGroupCounterValue??0})}await M(L);const G=be([...c.rows,ut(L[0],L[1])]);u(G)}catch(y){console.error("Error checking history update:",y)}},[I,m.length,u,M,o,d]),k=j.useCallback(async()=>{if(v){console.log("Cache cleared â€” skipping realtime fetch");return}if(x.current){console.log("Fetch already in progress, skipping...");return}x.current=!0,a(!0),r(null);try{const i=localStorage.getItem(ge);if(i)try{const c=JSON.parse(i);t(c.data),n(new Date(c.timestamp)),console.log("Real-time cache loaded")}catch(c){console.error("Failed to parse real-time cache:",c)}const y=await Promise.all(at.map(c=>fetch(`${rt}${encodeURIComponent(c+"?time="+Date.now())}`).then(D=>D.ok?D.json():Promise.reject(`HTTP ${D.status}`))));t(y);const f=new Date;n(f);try{localStorage.setItem(ge,JSON.stringify({data:y,timestamp:f.toISOString()}))}catch(c){console.error("Failed to cache real-time data:",c)}await V(y)}catch(i){console.error("Failed to fetch real-time data:",i),r(i.toString())}finally{a(!1),x.current=!1}},[t,a,r,n,V,v]);j.useEffect(()=>{const i=localStorage.getItem(re);if(i)try{const y=JSON.parse(i);o(y.data),d(new Date(y.timestamp)),console.log("History cache loaded on mount")}catch(y){console.error("Failed to load history cache on mount:",y)}},[o,d]),j.useEffect(()=>{if(v){console.log("Cache cleared â€” skipping initial realtime fetch and auto-refresh");return}k();const i=setInterval(k,300*1e3);try{g(()=>()=>clearInterval(i))}catch(y){console.warn("Failed to register stopAutoRefresh",y)}return()=>clearInterval(i)},[k,g,v]);const b=j.useCallback(async()=>{console.log("Manual refresh triggered"),await k()},[k]);j.useEffect(()=>{l(b)},[b,l]);const S=R(i=>i.realtimeData),w=R(i=>i.realtimeLoading),P=R(i=>i.realtimeError),O=R(i=>i.lastRealtimeUpdate),A=R(i=>i.historyLoading),H=R(i=>i.lastHistoryUpdate),q={realtimeData:S,realtimeLoading:w,realtimeError:P,lastRealtimeUpdate:O,historyData:m,historyLoading:A,lastHistoryUpdate:H,refresh:b};return s.jsx(tt.Provider,{value:q,children:e})};De.propTypes={children:T.node.isRequired};const oe=({title:e,shortTitle:t,icon:a,onRefresh:r,updateStatus:n,currentView:o,setView:p,children:d})=>{const{isLight:l,toggleTheme:g}=Ee();return s.jsxs("header",{className:"header-controls",role:"banner",children:[s.jsxs("div",{className:"header-title-group",children:[s.jsxs("h1",{children:[s.jsx("span",{className:"title-icon",role:"img","aria-label":`${e} icon`,children:a}),s.jsxs("span",{className:"title-text-full",children:[" ",e]}),s.jsxs("span",{className:"title-text-short",children:[" ",t||e]})]}),s.jsx("div",{className:"status-info",role:"status","aria-live":"polite",children:n})]}),s.jsxs("div",{className:"header-actions",role:"navigation","aria-label":"Main navigation",children:[d,(typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams).has("clear_cache")?s.jsxs("button",{className:"nav-btn",onClick:()=>Ae(),"aria-label":"Clear cache",children:[s.jsx("span",{className:"btn-icon",role:"img","aria-label":"Broom icon",children:"ðŸ§¹"}),s.jsx("span",{className:"btn-text",children:"Clear Cache"})]}):r?s.jsxs("button",{className:"nav-btn",onClick:r,"aria-label":"Refresh data",children:[s.jsx("span",{className:"btn-icon",role:"img","aria-label":"Refresh icon",children:"âŸ³"}),s.jsx("span",{className:"btn-text",children:"Refresh"})]}):null,o==="stats"&&s.jsxs("button",{className:"nav-btn",onClick:()=>p("dashboard"),"aria-label":"Go to dashboard",children:[s.jsx("span",{className:"btn-icon",role:"img","aria-label":"Home icon",children:"ðŸ "}),s.jsx("span",{className:"btn-text",children:"Dashboard"})]}),o==="dashboard"&&s.jsxs("button",{className:"nav-btn",onClick:()=>p("stats"),"aria-label":"Go to statistics",children:[s.jsx("span",{className:"btn-icon",role:"img","aria-label":"Chart icon",children:"ðŸ“Š"}),s.jsx("span",{className:"btn-text",children:"Statistics"})]}),s.jsx("button",{className:"theme-toggle",onClick:g,"aria-label":l?"Switch to dark theme":"Switch to light theme",children:l?"ðŸŒ™":"â˜€ï¸"})]})]})};oe.propTypes={title:T.string.isRequired,shortTitle:T.string,icon:T.string.isRequired,onRefresh:T.func,updateStatus:T.string.isRequired,currentView:T.oneOf(["dashboard","stats"]).isRequired,setView:T.func.isRequired,children:T.node};const Ce={"Green Day":187,"Uni Wroc":41},B=30,dt=e=>e?e==="Bank_1"?"Uni Wroc":e:"Unknown",W=(e,t=new Date)=>{if(!e)return 1/0;const a=new Date(e.replace(" ","T"));return Math.max(0,Math.floor((t-a)/1e3/60))},pt=e=>{if(!Number.isFinite(e))return{display:"--",aria:"Data age unavailable"};const t=Math.max(0,Math.round(e));if(t<60){const l=`${t} min ago`,g=`Data from ${t} minute${t===1?"":"s"} ago`;return{display:l,aria:g}}if(t<1440){const l=Math.round(t/60),g=`${l} h ago`,m=`Data from ${l} hour${l===1?"":"s"} ago`;return{display:g,aria:m}}const a=t/1440,r=Math.round(a*2)/2,o=Number.isInteger(r)?r.toString():r.toFixed(1),p=`${o} d ago`,d=`Data from ${o} day${o==="1"?"":"s"} ago`;return{display:p,aria:d}},Re=e=>Ce[e]||Ce[dt(e)],Ne=(e,t,a=new Date)=>{if(!e||!t)return{approximated:null,original:null,isApproximated:!1,reason:"Missing data"};const r=W(e.Timestamp,a);if(r<B)return{approximated:e.CurrentFreeGroupCounterValue||0,original:e.CurrentFreeGroupCounterValue||0,isApproximated:!1,ageMinutes:r};const n=Re(e.ParkingGroupName),o=Re(t.ParkingGroupName);if(!n||!o)return{approximated:e.CurrentFreeGroupCounterValue||0,original:e.CurrentFreeGroupCounterValue||0,isApproximated:!1,ageMinutes:r,reason:"Unknown capacity"};const p=t.CurrentFreeGroupCounterValue||0,d=p/o,l=Math.round(d*n);return{approximated:l,original:e.CurrentFreeGroupCounterValue||0,isApproximated:!0,ageMinutes:r,freshRatio:d,calculation:`(${p} / ${o}) * ${n} = ${l}`}};let ae=null,ve=null,Te=null;const mt=(e,t=new Date)=>{if(!Array.isArray(e)||e.length===0)return[];if(e.length!==2)return e.map(m=>({...m,approximationInfo:{isApproximated:!1,original:m.CurrentFreeGroupCounterValue||0,approximated:m.CurrentFreeGroupCounterValue||0,ageMinutes:W(m?.Timestamp,t)}}));const a=e[0],r=e[1],n=W(a?.Timestamp,t),o=W(r?.Timestamp,t),p=n>=B&&o<B,d=o>=B&&n<B,l=JSON.stringify({area1Name:a?.ParkingGroupName,area1Value:a?.CurrentFreeGroupCounterValue,area1Timestamp:a?.Timestamp,area1NeedsApprox:p,area2Name:r?.ParkingGroupName,area2Value:r?.CurrentFreeGroupCounterValue,area2Timestamp:r?.Timestamp,area2NeedsApprox:d});if(ve===e&&Te===l&&ae)return ae;const g=[];if(p){const m=Ne(a,r,t);g.push({...a,approximationInfo:m})}else g.push({...a,approximationInfo:{isApproximated:!1,original:a?.CurrentFreeGroupCounterValue||0,approximated:a?.CurrentFreeGroupCounterValue||0,ageMinutes:n}});if(d){const m=Ne(r,a,t);g.push({...r,approximationInfo:m})}else g.push({...r,approximationInfo:{isApproximated:!1,original:r?.CurrentFreeGroupCounterValue||0,approximated:r?.CurrentFreeGroupCounterValue||0,ageMinutes:o}});return ve=e,Te=l,ae=g,g},_e=({data:e,now:t,allOffline:a})=>{const r=W(e.Timestamp,t),{display:n,aria:o}=pt(r);let p="",d=null,l="",g=e.ParkingGroupName;g==="Bank_1"&&(g="Uni Wroc");const m=e.approximationInfo||{},x=!!m.isApproximated,v=x?m.approximated:e.CurrentFreeGroupCounterValue||0,u=m.original||e.CurrentFreeGroupCounterValue||0;return x?r>=15?p="age-old":r>5&&(p="age-medium"):a?(p="age-old",d="ðŸ“µ",l="Offline"):r>=15?(p="age-old",d="ðŸš¨",l="Error - data outdated"):r>5&&(p="age-medium",d="âš ï¸",l="Warning - data slightly outdated"),s.jsxs("div",{className:"parking-card",role:"article","aria-label":`${g} parking information`,children:[s.jsx("div",{className:"parking-name",children:g}),s.jsxs("div",{className:`free-spots ${p}`,"aria-label":`${v} free parking spaces${x?" (approximated)":""}`,children:[d&&s.jsx("span",{className:"status-icon-number",role:"img","aria-label":l,title:l,children:d}),x&&s.jsx("span",{className:"approx-indicator",title:"Approximated value",children:"â‰ˆ"}),v]}),x&&s.jsxs("div",{className:"original-value","aria-label":`Original value: ${u}`,children:["(orig: ",u,")"]}),s.jsx("div",{className:"age-indicator-small","aria-label":o,children:n})]})};_e.propTypes={data:T.shape({ParkingGroupName:T.string.isRequired,CurrentFreeGroupCounterValue:T.number,Timestamp:T.string.isRequired,approximationInfo:T.shape({isApproximated:T.bool,approximated:T.number,original:T.number})}).isRequired,now:T.instanceOf(Date).isRequired,allOffline:T.bool.isRequired};const ke=({setView:e})=>{const t=R(b=>b.realtimeData),a=R(b=>b.realtimeLoading),r=R(b=>b.realtimeError),n=R(b=>b.lastRealtimeUpdate),[o,p]=j.useState(new Date);j.useEffect(()=>{const b=setInterval(()=>p(new Date),1e3);return()=>clearInterval(b)},[]);const d=j.useMemo(()=>mt(t,o),[t,o]),l=d.some(b=>b.approximationInfo?.isApproximated),g=d.reduce((b,S)=>{const w=S.approximationInfo||{},P=w.isApproximated?w.approximated:S.CurrentFreeGroupCounterValue||0;return b+P},0),m=t.reduce((b,S)=>b+(S.CurrentFreeGroupCounterValue||0),0),x=n?`Last update: ${n.toLocaleTimeString("pl-PL")}`:"Loading...",v=t.length>0&&t.every(b=>{const S=new Date(b.Timestamp.replace(" ","T"));return Math.max(0,Math.floor((o-S)/1e3/60))>=1440}),u=({allowIcons:b=!0}={})=>{if(d.length===0)return{colorClass:"",statusMessage:"No data available",statusIcon:null,statusLabel:""};let S=0;d.forEach(H=>{const q=W(H.Timestamp,o);S=Math.max(S,q)});let w=null,P="",O="",A="";return v?(O="age-old",A="All parking feeds appear offline",b&&(w="ðŸ“µ",P="Offline")):S>=15?(O="age-old",A="Data outdated - figures may not reflect actual free spaces",b&&(w="ðŸš¨",P="Error - data outdated")):S>5?(O="age-medium",A="Data slightly outdated - refresh recommended",b&&(w="âš ï¸",P="Warning - data slightly outdated")):(O="",A="Data is current and reliable"),{colorClass:O,statusMessage:A,statusIcon:w,statusLabel:P}},{colorClass:M,statusMessage:I,statusIcon:V,statusLabel:k}=u({allowIcons:!l});return s.jsxs(s.Fragment,{children:[s.jsx(oe,{title:"Parking Monitor",icon:"ðŸ…¿ï¸",onRefresh:Ie,updateStatus:x,currentView:"dashboard",setView:e}),s.jsxs("main",{className:"container-main",role:"main","aria-label":"Parking dashboard",children:[s.jsx("div",{className:"subtitle",children:"Real-time parking availability â€¢ UBS WrocÅ‚aw"}),r&&s.jsxs("div",{className:"error",role:"alert","aria-live":"polite",children:[s.jsx("strong",{children:"ERROR:"})," ",r]}),s.jsx("div",{className:"grid-container",role:"list","aria-label":"Parking facilities",children:a&&t.length===0?s.jsx("div",{className:"loader",role:"status","aria-live":"polite",children:"Loading parking data..."}):d.map((b,S)=>s.jsx(_e,{data:b,now:o,allOffline:v},S))}),s.jsx("div",{className:`status-description ${M}`,"aria-label":"Status description",children:I}),s.jsx("div",{className:"status-panel",role:"complementary","aria-label":"Status information",children:s.jsxs("div",{className:"panel-sections-wrapper",children:[s.jsxs("div",{className:"panel-section",children:[s.jsx("div",{className:"status-label",children:"Total Spaces"}),s.jsxs("div",{className:`status-value big-value ${M}`,"aria-label":`Total free spaces: ${a?"loading":g}`,children:[V&&s.jsx("span",{className:"status-icon-number",role:"img","aria-label":k,title:k,children:V}),l&&!a&&s.jsx("span",{className:"approx-indicator-small",title:"Includes approximated values",children:"â‰ˆ"}),a?"---":g]}),l&&!a&&s.jsxs("div",{className:"original-total","aria-label":`Original total: ${m}`,children:["(orig: ",m,")"]})]}),s.jsxs("div",{className:"panel-section",children:[s.jsx("div",{className:"status-label",children:"Last Update / Current Time"}),s.jsxs("div",{className:"time-group",children:[s.jsx("span",{"aria-label":`Last updated at ${n?n.toLocaleTimeString("pl-PL"):"unknown"}`,children:n?n.toLocaleTimeString("pl-PL"):"--:--:--"}),s.jsx("span",{className:"status-current-inline","aria-label":`Current time ${o.toLocaleTimeString("pl-PL")}`,children:o.toLocaleTimeString("pl-PL")})]})]}),s.jsxs("div",{className:"panel-section",children:[s.jsx("div",{className:"status-label",children:"Data Status"}),s.jsx("div",{className:"status-value",style:{color:r?"var(--warning)":l?"var(--age-medium)":"var(--success)"},role:"status","aria-live":"polite",children:a?"LOADING":r?"OFFLINE":l?"APPROX":"ONLINE"})]})]})})]})]})};ke.propTypes={setView:T.func.isRequired};const Y={neon:{gd:"#05ffa1",uni:"#01beff"},classic:{gd:"#3b82f6",uni:"#f59e0b"},cyberpunk:{gd:"#00d9ff",uni:"#ff00cc"},modern:{gd:"#10b981",uni:"#6366f1"}},Pe=({setView:e})=>{const t=R(u=>u.historyData),a=R(u=>u.historyLoading),[r,n]=$.useState("neon"),[o,p]=$.useState(!1),{isLight:d}=Ee(),[l,g]=j.useState({start:0,end:100}),m=j.useRef(null),x=j.useMemo(()=>{if(!t||t.length===0)return null;const u=d?"#1e293b":"#8b95c9",M=d?"#cbd5e1":"#2d3b6b",I=window.innerWidth<=600,V=new Map,k=new Map;t.forEach(h=>{const C=E=>Object.keys(h).find(_=>_.trim().toLowerCase()===E),N=C("gd_time"),F=C("greenday free"),L=C("uni_time"),G=C("uni free");if(N&&F&&h[N]&&h[F]){const E=h[N].trim(),_=parseFloat(h[F]);isNaN(_)||V.set(E,_)}if(L&&G&&h[L]&&h[G]){const E=h[L].trim(),_=parseFloat(h[G]);isNaN(_)||k.set(E,_)}});const b=h=>Array.from(h.entries()).map(([C,N])=>({t:new Date(C),v:N,raw:C})).filter(C=>!isNaN(C.t.getTime())).sort((C,N)=>C.t-N.t);let S=b(V),w=b(k);const P=h=>{const C=new Set;return h.filter(N=>{const F=`${N.raw}|${N.v}`;return C.has(F)?!1:(C.add(F),!0)})};if(S=P(S),w=P(w),S.length>0&&w.length>0){const h=S[0].t.getTime(),C=w[0].t.getTime();C<h&&(w[0].t=new Date(h),w[0].raw=S[0].raw),h<C&&(S[0].t=new Date(C),S[0].raw=w[0].raw)}const O=[...S.map(h=>h.t.getTime()),...w.map(h=>h.t.getTime())],A=O.length>0?Math.max(...O):null;let H=null;if(A){const h=S.find(N=>N.t.getTime()===A),C=w.find(N=>N.t.getTime()===A);H=(h||C)?.raw}const q=(h,C,N)=>{if(h.length===0)return{solid:[],gaps:[],projections:[]};const F=[],L=[],G=[];for(let _=0;_<h.length;_++)F.push([h[_].raw,h[_].v]);const E=h[h.length-1];return E&&C&&C-E.t.getTime()>1e3&&(G.push([E.raw,E.v]),G.push([N,E.v])),{solid:F,gaps:L,projections:G}},i=q(S,A,H),y=q(w,A,H),f=Y[r],c=S.length>0?"GreenDay":"GreenDay - not found",D=w.length>0?"Uni Wroc":"Uni Wroc - not found";return{backgroundColor:"transparent",animation:!0,animationDuration:300,tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"cross"}},legend:{data:[c,D],top:5,textStyle:{color:u}},grid:{left:I?10:15,right:I?10:15,bottom:I?80:50,top:40,containLabel:!0},xAxis:{type:"time",axisLabel:{color:u,margin:10},axisLine:{lineStyle:{color:M}},splitLine:{show:!1}},yAxis:{type:"value",min:-5,max:200,splitLine:{lineStyle:{color:M,opacity:.3}},axisLabel:{color:u,formatter:h=>h<0?"":h}},dataZoom:[{type:"inside",start:l.start,end:l.end,filterMode:"none"},{type:"slider",start:l.start,end:l.end,bottom:I?40:10,height:I?30:25,textStyle:{color:u,fontSize:I?11:12},filterMode:"none",handleSize:I?"180%":"100%",borderColor:u,fillerColor:"rgba(100, 149, 237, 0.3)",dataBackground:{lineStyle:{color:u,opacity:.5},areaStyle:{color:u,opacity:.2}},moveHandleSize:I?10:7,emphasis:{handleStyle:{borderWidth:2}}}],series:[{name:c,type:"line",data:i.solid,showSymbol:o,lineStyle:{width:3,color:f.gd},itemStyle:{color:f.gd},areaStyle:{color:new ne(0,0,0,1,[{offset:0,color:`${f.gd}33`},{offset:1,color:`${f.gd}00`}])},markLine:{symbol:"none",data:[{yAxis:187,lineStyle:{color:f.gd,type:"dotted",opacity:1},label:{position:"start",formatter:"187",color:f.gd,fontWeight:"bold",fontSize:13}}]}},{name:c,type:"line",data:i.gaps,showSymbol:!1,lineStyle:{width:2,color:f.gd,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:c,type:"line",data:i.projections,showSymbol:!1,lineStyle:{width:1.5,color:f.gd,type:[5,5],opacity:.5},tooltip:{show:!1}},{name:D,type:"line",data:y.solid,showSymbol:o,lineStyle:{width:3,color:f.uni},itemStyle:{color:f.uni},areaStyle:{color:new ne(0,0,0,1,[{offset:0,color:`${f.uni}33`},{offset:1,color:`${f.uni}00`}])},markLine:{symbol:"none",data:[{yAxis:41,lineStyle:{color:f.uni,type:"dotted",opacity:1},label:{position:"start",formatter:"41",color:f.uni,fontWeight:"bold",fontSize:13}}]}},{name:D,type:"line",data:y.gaps,showSymbol:!1,lineStyle:{width:2,color:f.uni,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:D,type:"line",data:y.projections,showSymbol:!1,lineStyle:{width:1.5,color:f.uni,type:[5,5],opacity:.5},tooltip:{show:!1}}]}},[t,r,o,d,l]),v={datazoom:u=>{u.batch&&u.batch[0]?g({start:u.batch[0].start,end:u.batch[0].end}):u.start!==void 0&&u.end!==void 0&&g({start:u.start,end:u.end})}};return s.jsxs("div",{className:"page-wrapper",children:[s.jsx(oe,{title:"Parking History",shortTitle:"Hist",icon:"ðŸ“ˆ",onRefresh:Ie,updateStatus:a?"Updating...":"Ready",currentView:"stats",setView:e,children:s.jsxs("div",{className:"palette-group",children:[s.jsx("span",{className:"palette-label",children:"Palette:"}),Object.keys(Y).map(u=>s.jsx("div",{className:`palette-btn ${r===u?"active":""}`,style:{background:`linear-gradient(135deg, ${Y[u].gd} 50%, ${Y[u].uni} 50%)`},onClick:()=>n(u),title:u.charAt(0).toUpperCase()+u.slice(1)},u)),s.jsxs("button",{className:"palette-toggle-btn",onClick:()=>p(!o),children:["Dots: ",o?"Off":"On"]})]})}),s.jsx("main",{className:"stats-container",children:a&&t.length===0?s.jsx("div",{className:"loader",children:"Loading history data..."}):x?s.jsx(Oe,{ref:m,option:x,style:{height:"100%",width:"100%",touchAction:"none"},onEvents:v,notMerge:!1,lazyUpdate:!0,opts:{renderer:"canvas"}}):s.jsx("div",{className:"loader",children:"No data available to display."})})]})};Pe.propTypes={setView:T.func.isRequired};function ht(){const[e,t]=j.useState("dashboard");return s.jsx(we,{children:s.jsx(Le,{children:s.jsx(De,{children:e==="dashboard"?s.jsx(ke,{setView:t}):s.jsx(Pe,{setView:t})})})})}const gt=qe.createRoot(document.getElementById("root"));gt.render(s.jsx($.StrictMode,{children:s.jsx(ht,{})}));
