import{r as i,L as B,E as Y,R as Q}from"./vendor-echarts-CH7RThay.js";import{r as ee}from"./vendor-react-bthqeG5T.js";import{P as te}from"./vendor-utils-C-a--0RZ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function c(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=c(a);fetch(a.href,o)}})();var V={exports:{}},O={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var se=i,ae=Symbol.for("react.element"),ne=Symbol.for("react.fragment"),oe=Object.prototype.hasOwnProperty,re=se.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ie={key:!0,ref:!0,__self:!0,__source:!0};function Z(l,t,c){var r,a={},o=null,m=null;c!==void 0&&(o=""+c),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(m=t.ref);for(r in t)oe.call(t,r)&&!ie.hasOwnProperty(r)&&(a[r]=t[r]);if(l&&l.defaultProps)for(r in t=l.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:ae,type:l,key:o,ref:m,props:a,_owner:re.current}}O.Fragment=ne;O.jsx=Z;O.jsxs=Z;V.exports=O;var e=V.exports,$={},H=ee;$.createRoot=H.createRoot,$.hydrateRoot=H.hydrateRoot;const q=i.createContext(),le=({children:l})=>{const[t,c]=i.useState(localStorage.getItem("parking_theme")==="light");i.useEffect(()=>{t?(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("parking_theme","light")):(document.documentElement.removeAttribute("data-theme"),localStorage.setItem("parking_theme","dark"))},[t]);const r=()=>c(!t);return e.jsx(q.Provider,{value:{isLight:t,toggleTheme:r},children:l})},J=()=>i.useContext(q),X=({title:l,icon:t,onRefresh:c,updateStatus:r,currentView:a,setView:o,children:m})=>{const{isLight:f,toggleTheme:R}=J();return e.jsxs("header",{className:"header-controls",children:[e.jsxs("div",{className:"header-title-group",children:[e.jsxs("h1",{children:[e.jsx("span",{className:"title-icon",children:t})," ",l]}),e.jsx("div",{className:"status-info",children:r})]}),e.jsxs("div",{className:"header-actions",children:[m,c&&e.jsxs("button",{className:"nav-btn",onClick:c,children:[e.jsx("span",{style:{marginRight:"8px",fontSize:"1.1rem"},children:"âŸ³"}),e.jsx("span",{className:"btn-text",children:"Refresh"})]}),a==="stats"&&e.jsxs("button",{className:"nav-btn",onClick:()=>o("dashboard"),children:[e.jsx("span",{style:{marginRight:"8px",fontSize:"1.1rem"},children:"ðŸ "}),e.jsx("span",{className:"btn-text",children:"Dashboard"})]}),a==="dashboard"&&e.jsxs("button",{className:"nav-btn",onClick:()=>o("stats"),children:[e.jsx("span",{style:{marginRight:"8px",fontSize:"1.1rem"},children:"ðŸ“Š"}),e.jsx("span",{className:"btn-text",children:"Statistics"})]}),e.jsx("button",{className:"theme-toggle",onClick:R,"aria-label":"Toggle theme",children:f?"ðŸŒ™":"â˜€ï¸"})]})]})},ce=["https://gd.zaparkuj.pl/api/freegroupcountervalue.json","https://gd.zaparkuj.pl/api/freegroupcountervalue-green.json"],de="https://corsproxy.io/?",ue=({data:l,now:t})=>{const c=new Date(l.Timestamp.replace(" ","T")),r=Math.max(0,Math.floor((t-c)/1e3/60));let a="";r>=15?a="age-old":r>5&&(a="age-medium");let o=l.ParkingGroupName;return o==="Bank_1"&&(o="Uni Wroc"),e.jsxs("div",{className:"parking-card",children:[e.jsx("div",{className:"parking-name",children:o}),e.jsx("div",{className:`free-spots ${a}`,children:l.CurrentFreeGroupCounterValue||0}),e.jsxs("div",{className:"age-indicator-small",children:[r," min ago"]}),e.jsxs("div",{className:"timestamp-small",children:["@",c.toLocaleTimeString("pl-PL")]})]})},me=({setView:l})=>{const[t,c]=i.useState([]),[r,a]=i.useState(!0),[o,m]=i.useState(null),[f,R]=i.useState(null),[L,x]=i.useState(new Date),j=i.useCallback(async()=>{a(!0),m(null);try{const n=await Promise.all(ce.map(y=>fetch(`${de}${encodeURIComponent(y+"?time="+Date.now())}`).then(b=>b.ok?b.json():Promise.reject(`HTTP ${b.status}`))));c(n),R(new Date)}catch(n){m(n.toString())}finally{a(!1)}},[]);i.useEffect(()=>{j();const n=setInterval(()=>x(new Date),1e3),y=setInterval(j,5*60*1e3);return()=>{clearInterval(n),clearInterval(y)}},[j]);const P=t.reduce((n,y)=>n+(y.CurrentFreeGroupCounterValue||0),0),I=f?`Last update: ${f.toLocaleTimeString("pl-PL")}`:"Loading...";return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Parking Monitor",icon:"ðŸ…¿ï¸",onRefresh:j,updateStatus:I,currentView:"dashboard",setView:l}),e.jsxs("main",{className:"container",children:[e.jsx("div",{className:"subtitle",children:"Real-time parking availability â€¢ UBS WrocÅ‚aw"}),o&&e.jsxs("div",{className:"error",children:[e.jsx("strong",{children:"ERROR:"})," ",o]}),e.jsx("div",{className:"grid-container",children:r&&t.length===0?e.jsx("div",{className:"loader",children:"Loading parking data..."}):t.map((n,y)=>e.jsx(ue,{data:n,now:L},y))}),e.jsxs("div",{className:"status-panel",children:[e.jsxs("div",{className:"panel-section",children:[e.jsx("div",{className:"status-label",children:"Total Spaces"}),e.jsx("div",{className:"status-value big-value",children:r?"---":P})]}),e.jsxs("div",{className:"panel-section",children:[e.jsx("div",{className:"status-label",children:"Data Status"}),e.jsx("div",{className:"status-value",style:{color:o?"var(--warning)":"var(--success)"},children:r?"LOADING":o?"OFFLINE":"ONLINE"})]}),e.jsxs("div",{className:"panel-section",children:[e.jsx("div",{className:"status-label",children:"Last Update / Current Time"}),e.jsxs("div",{className:"time-group",children:[e.jsx("span",{children:f?f.toLocaleTimeString("pl-PL"):"--:--:--"}),e.jsx("span",{className:"status-current-inline",children:L.toLocaleTimeString("pl-PL")})]})]})]})]})]})},pe="https://docs.google.com/spreadsheets/d/e/2PACX-1vTwLNDbg8KjlVHsZWj9JUnO_OBIyZaRgZ4gZ8_Gbyly2J3f6rlCW6lDHAihwbuLhxWbBkNMI1wdWRAq/pub?gid=411529798&single=true&output=csv",D={neon:{gd:"#05ffa1",uni:"#01beff"},classic:{gd:"#3b82f6",uni:"#f59e0b"},cyberpunk:{gd:"#00d9ff",uni:"#ff00cc"},modern:{gd:"#10b981",uni:"#6366f1"}},he=({setView:l})=>{const[t,c]=i.useState([]),[r,a]=i.useState(!0),[o,m]=i.useState("neon"),[f,R]=i.useState(!1),{isLight:L}=J(),x=i.useRef({start:80,end:100}),j=async()=>{a(!0);try{const y=await(await fetch(`${pe}&time=${Date.now()}`)).text();te.parse(y,{header:!0,skipEmptyLines:!0,complete:b=>{c(b.data),a(!1)}})}catch(n){console.error(n),a(!1)}};i.useEffect(()=>{j()},[]);const P=i.useMemo(()=>{var K;if(!t||t.length===0)return null;const n=L?"#1e293b":"#8b95c9",y=L?"#cbd5e1":"#2d3b6b",b=new Map,F=new Map;t.forEach(s=>{const u=N=>Object.keys(s).find(h=>h.trim().toLowerCase()===N),p=u("gd_time"),v=u("greenday free"),w=u("uni_time"),S=u("uni free");if(p&&v&&s[p]&&s[v]){const N=s[p].trim(),h=parseFloat(s[v]);isNaN(h)||b.set(N,h)}if(w&&S&&s[w]&&s[S]){const N=s[w].trim(),h=parseFloat(s[S]);isNaN(h)||F.set(N,h)}});const W=s=>Array.from(s.entries()).map(([u,p])=>({t:new Date(u),v:p,raw:u})).filter(u=>!isNaN(u.t.getTime())).sort((u,p)=>u.t-p.t),k=W(b),C=W(F),G=[...k.map(s=>s.t.getTime()),...C.map(s=>s.t.getTime())],T=G.length>0?Math.max(...G):null;let A=null;if(T){const s=k.find(p=>p.t.getTime()===T),u=C.find(p=>p.t.getTime()===T);A=(K=s||u)==null?void 0:K.raw}const z=(s,u,p)=>{if(s.length===0)return{solid:[],gaps:[],projections:[]};const v=[],w=[],S=[],N=40*60*1e3;for(let g=0;g<s.length;g++)v.push([s[g].raw,s[g].v]),g<s.length-1&&s[g+1].t-s[g].t>N&&(v.push([s[g+1].raw,null]),w.push([s[g].raw,s[g].v],[s[g+1].raw,s[g+1].v],[s[g+1].raw,null]));const h=s[s.length-1];return h&&u&&u-h.t.getTime()>1e3&&(S.push([h.raw,h.v]),S.push([p,h.v])),{solid:v,gaps:w,projections:S}},M=z(k,T,A),U=z(C,T,A),d=D[o],_=k.length>0?"GreenDay":"GreenDay - not found",E=C.length>0?"Uni Wroc":"Uni Wroc - not found";return{backgroundColor:"transparent",animation:!0,tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"cross"}},legend:{data:[_,E],top:5,textStyle:{color:n}},grid:{left:40,right:20,bottom:65,top:40,containLabel:!0},xAxis:{type:"time",axisLabel:{color:n,margin:10},axisLine:{lineStyle:{color:y}},splitLine:{show:!1}},yAxis:{type:"value",min:-5,max:200,splitLine:{lineStyle:{color:y,opacity:.3}},axisLabel:{color:n,formatter:s=>s<0?"":s}},dataZoom:[{type:"inside",start:x.current.start,end:x.current.end,filterMode:"none"},{type:"slider",start:x.current.start,end:x.current.end,bottom:10,height:25,textStyle:{color:n},filterMode:"none"}],series:[{name:_,type:"line",data:M.solid,showSymbol:f,lineStyle:{width:3,color:d.gd},itemStyle:{color:d.gd},areaStyle:{color:new B(0,0,0,1,[{offset:0,color:`${d.gd}33`},{offset:1,color:`${d.gd}00`}])},markLine:{symbol:"none",data:[{yAxis:187,lineStyle:{color:d.gd,type:"dotted",opacity:1},label:{position:"start",formatter:"187",color:d.gd,fontWeight:"bold",fontSize:13}}]}},{name:_,type:"line",data:M.gaps,showSymbol:!1,lineStyle:{width:2,color:d.gd,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:_,type:"line",data:M.projections,showSymbol:!1,lineStyle:{width:1.5,color:d.gd,type:[5,5],opacity:.5},tooltip:{show:!1}},{name:E,type:"line",data:U.solid,showSymbol:f,lineStyle:{width:3,color:d.uni},itemStyle:{color:d.uni},areaStyle:{color:new B(0,0,0,1,[{offset:0,color:`${d.uni}33`},{offset:1,color:`${d.uni}00`}])},markLine:{symbol:"none",data:[{yAxis:41,lineStyle:{color:d.uni,type:"dotted",opacity:1},label:{position:"start",formatter:"41",color:d.uni,fontWeight:"bold",fontSize:13}}]}},{name:E,type:"line",data:U.gaps,showSymbol:!1,lineStyle:{width:2,color:d.uni,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:E,type:"line",data:U.projections,showSymbol:!1,lineStyle:{width:1.5,color:d.uni,type:[5,5],opacity:.5},tooltip:{show:!1}}]}},[t,o,f,L]),I={datazoom:n=>{n.batch&&n.batch[0]?x.current={start:n.batch[0].start,end:n.batch[0].end}:n.start!==void 0&&n.end!==void 0&&(x.current={start:n.start,end:n.end})}};return e.jsxs("div",{className:"page-wrapper",children:[e.jsx(X,{title:"Parking History",icon:"ðŸ“ˆ",onRefresh:j,updateStatus:r?"Updating...":"Ready",currentView:"stats",setView:l,children:e.jsxs("div",{className:"palette-group",children:[e.jsx("span",{className:"palette-label",children:"Palette:"}),Object.keys(D).map(n=>e.jsx("div",{className:`palette-btn ${o===n?"active":""}`,style:{background:`linear-gradient(135deg, ${D[n].gd} 50%, ${D[n].uni} 50%)`},onClick:()=>m(n),title:n.charAt(0).toUpperCase()+n.slice(1)},n)),e.jsxs("button",{className:"palette-toggle-btn",onClick:()=>R(!f),children:["Dots: ",f?"Off":"On"]})]})}),e.jsx("main",{className:"stats-container",children:r&&t.length===0?e.jsx("div",{className:"loader",children:"Loading history data..."}):P?e.jsx(Y,{option:P,style:{height:"100%",width:"100%"},onEvents:I,notMerge:!1,lazyUpdate:!0}):e.jsx("div",{className:"loader",children:"No data available to display."})})]})};function ge(){const[l,t]=i.useState("dashboard");return e.jsx(le,{children:l==="dashboard"?e.jsx(me,{setView:t}):e.jsx(he,{setView:t})})}$.createRoot(document.getElementById("root")).render(e.jsx(Q.StrictMode,{children:e.jsx(ge,{})}));
