import{r as Le,g as te,R as A,a as v,L as re,E as Ee}from"./vendor-echarts-nZu8rBDa.js";import{r as De}from"./vendor-react-BVyvVbwp.js";import{r as _e}from"./vendor-utils-F0zOxUcV.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();var Y={exports:{}},H={};var se;function Ie(){if(se)return H;se=1;var e=Le(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,n=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function h(b,g,w){var x,R={},u=null,c=null;w!==void 0&&(u=""+w),g.key!==void 0&&(u=""+g.key),g.ref!==void 0&&(c=g.ref);for(x in g)s.call(g,x)&&!i.hasOwnProperty(x)&&(R[x]=g[x]);if(b&&b.defaultProps)for(x in g=b.defaultProps,g)R[x]===void 0&&(R[x]=g[x]);return{$$typeof:t,type:b,key:u,ref:c,props:R,_owner:n.current}}return H.Fragment=a,H.jsx=h,H.jsxs=h,H}var oe;function ke(){return oe||(oe=1,Y.exports=Ie()),Y.exports}var r=ke(),K={},ne;function Pe(){if(ne)return K;ne=1;var e=De();return K.createRoot=e.createRoot,K.hydrateRoot=e.hydrateRoot,K}var Ue=Pe();const Ae=te(Ue);var Z={exports:{}},Q,ie;function Oe(){if(ie)return Q;ie=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Q=e,Q}var X,le;function Fe(){if(le)return X;le=1;var e=Oe();function t(){}function a(){}return a.resetWarningCache=t,X=function(){function s(h,b,g,w,x,R){if(R!==e){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}s.isRequired=s;function n(){return s}var i={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:n,element:s,elementType:s,instanceOf:n,node:s,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:a,resetWarningCache:t};return i.PropTypes=i,i},X}var ce;function Me(){return ce||(ce=1,Z.exports=Fe()()),Z.exports}var Ge=Me();const C=te(Ge);class be extends A.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Error caught by boundary:",t,a),this.setState({errorInfo:a})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()};render(){return this.state.hasError?r.jsx("div",{className:"error-boundary",children:r.jsxs("div",{className:"error-content",children:[r.jsx("h1",{children:"ðŸš¨ Oops! Something went wrong"}),r.jsx("p",{className:"error-message",children:"The application encountered an unexpected error."}),this.state.error&&r.jsxs("details",{className:"error-details",children:[r.jsx("summary",{children:"Error Details"}),r.jsx("pre",{children:this.state.error.toString()}),this.state.errorInfo&&r.jsx("pre",{children:this.state.errorInfo.componentStack})]}),r.jsx("button",{onClick:this.handleReset,className:"error-reset-btn",children:"ðŸ”„ Reload Application"})]})}):this.props.children}}be.propTypes={children:C.node.isRequired};const Se=v.createContext(),xe=({children:e})=>{const[t,a]=v.useState(localStorage.getItem("parking_theme")==="light");v.useEffect(()=>{t?(document.body.classList.remove("dark"),localStorage.setItem("parking_theme","light")):(document.body.classList.add("dark"),localStorage.setItem("parking_theme","dark"))},[t]);const s=()=>a(!t);return r.jsx(Se.Provider,{value:{isLight:t,toggleTheme:s},children:e})};xe.propTypes={children:C.node.isRequired};const Re=()=>v.useContext(Se);var Ve=_e();const He=te(Ve),de=e=>{let t;const a=new Set,s=(w,x)=>{const R=typeof w=="function"?w(t):w;if(!Object.is(R,t)){const u=t;t=x??(typeof R!="object"||R===null)?R:Object.assign({},t,R),a.forEach(c=>c(t,u))}},n=()=>t,b={setState:s,getState:n,getInitialState:()=>g,subscribe:w=>(a.add(w),()=>a.delete(w))},g=t=e(s,n,b);return b},qe=(e=>e?de(e):de),$e=e=>e;function We(e,t=$e){const a=A.useSyncExternalStore(e.subscribe,A.useCallback(()=>t(e.getState()),[e,t]),A.useCallback(()=>t(e.getInitialState()),[e,t]));return A.useDebugValue(a),a}const ue=e=>{const t=qe(e),a=s=>We(t,s);return Object.assign(a,t),a},Ke=(e=>e?ue(e):ue),y=Ke(e=>({realtimeData:[],realtimeLoading:!0,realtimeError:null,lastRealtimeUpdate:null,historyData:[],historyLoading:!1,lastHistoryUpdate:null,fetchInProgress:!1,refreshCallback:null,stopAutoRefresh:null,cacheCleared:!1,setRealtimeData:a=>e({realtimeData:a}),setRealtimeLoading:a=>e({realtimeLoading:a}),setRealtimeError:a=>e({realtimeError:a}),setLastRealtimeUpdate:a=>e({lastRealtimeUpdate:a}),setHistoryData:a=>e({historyData:a}),setHistoryLoading:a=>e({historyLoading:a}),setLastHistoryUpdate:a=>e({lastHistoryUpdate:a}),setFetchInProgress:a=>e({fetchInProgress:a}),setRefreshCallback:a=>e({refreshCallback:a}),setStopAutoRefresh:a=>e({stopAutoRefresh:a}),setCacheCleared:a=>e({cacheCleared:a}),updateRealtimeState:a=>e(a),updateHistoryState:a=>e(a),resetStore:()=>e({realtimeData:[],realtimeLoading:!0,realtimeError:null,lastRealtimeUpdate:null,historyData:[],historyLoading:!1,lastHistoryUpdate:null,fetchInProgress:!1,refreshCallback:null})})),ve=async()=>{const e=y.getState().refreshCallback;e?await e():console.warn("Refresh callback not set yet")},we=()=>{try{typeof localStorage<"u"&&(localStorage.removeItem("parking_realtime_cache"),localStorage.removeItem("parking_history_cache")),y.setState({fetchInProgress:!1,cacheCleared:!0});const e=y.getState().stopAutoRefresh;if(typeof e=="function")try{e()}catch(t){console.warn("stopAutoRefresh failed",t)}console.log("Cache cleared and auto-refresh stopped")}catch(e){console.error("clearCache failed",e)}};typeof window<"u"&&(window.clearCache=we);const ze=v.createContext(),Be=["https://gd.zaparkuj.pl/api/freegroupcountervalue.json","https://gd.zaparkuj.pl/api/freegroupcountervalue-green.json"],Je="https://corsproxy.io/?",Ye="https://docs.google.com/spreadsheets/d/e/2PACX-1vTwLNDbg8KjlVHsZWj9JUnO_OBIyZaRgZ4gZ8_Gbyly2J3f6rlCW6lDHAihwbuLhxWbBkNMI1wdWRAq/pub?gid=411529798&single=true&output=csv",Ze="https://docs.google.com/forms/d/e/1FAIpQLSdeQ-rmw_VfOidGmtSNb9DLkt1RfPdduu-jH898sf3lhj17LA/formResponse",z={GREENDAY_VALUE:"entry.2026993163",GREENDAY_TIME:"entry.51469670",UNI_VALUE:"entry.1412144904",UNI_TIME:"entry.364658642"},me="parking_realtime_cache",ee="parking_history_cache",k={GD_TIME:"gd_time",GD_VALUE:"greenday free",UNI_TIME:"uni_time",UNI_VALUE:"uni free"},pe=e=>e?e.trim().toLowerCase():"",Qe=(e,t)=>{if(!e)return null;const a=pe(t);return Object.keys(e).find(s=>pe(s)===a)||null},J=(e,t)=>{const a=Qe(e,t);if(!a)return;const s=e[a];return typeof s=="string"?s.trim():s},Xe=e=>{if(!e)return null;const t=e.includes("T")?e:e.replace(" ","T"),a=new Date(t);return Number.isNaN(a.getTime())?null:a},he=(e,t,a)=>{if(!e)return null;const s=J(e,t),n=Xe(s);if(!n)return null;const i=J(e,a),h=i==null||i===""?null:Number(i);return{raw:s,date:n,value:Number.isNaN(h)?null:h}},et=e=>{if(!e||e.length===0)return{gd:null,uni:null};const t=e[e.length-1];return{gd:he(t,k.GD_TIME,k.GD_VALUE),uni:he(t,k.UNI_TIME,k.UNI_VALUE)}},ge=(e=[])=>{const t=new Set,a=[];return e.forEach(s=>{const n=J(s,k.GD_TIME)||"",i=J(s,k.UNI_TIME)||"",h=`${n}|||${i}`;t.has(h)||(t.add(h),a.push(s))}),a},fe=e=>{if(!e||!e.Timestamp)return null;const t=e.Timestamp.trim();if(!t)return null;const a=t.includes("T")?t:t.replace(" ","T"),s=new Date(a);if(Number.isNaN(s.getTime()))return null;const n=Number(e.CurrentFreeGroupCounterValue);return{raw:t,date:s,value:Number.isNaN(n)?null:n}},tt=(e=[])=>Array.isArray(e)?e.map(t=>({...t||{}})):[],at=(e,t)=>({[k.GD_TIME]:e?.Timestamp||"",[k.GD_VALUE]:e?.CurrentFreeGroupCounterValue??"",[k.UNI_TIME]:t?.Timestamp||"",[k.UNI_VALUE]:t?.CurrentFreeGroupCounterValue??""}),ye=()=>{if(typeof localStorage>"u")return{rows:[],timestamp:null,last:{gd:null,uni:null}};const e=localStorage.getItem(ee);if(!e)return{rows:[],timestamp:null,last:{gd:null,uni:null}};try{const t=JSON.parse(e),a=Array.isArray(t.data)?t.data:[];return{rows:a,timestamp:t.timestamp||null,last:et(a)}}catch(t){return console.error("Failed to parse history cache snapshot:",t),{rows:[],timestamp:null,last:{gd:null,uni:null}}}},Ce=({children:e})=>{const t=y(o=>o.setRealtimeData),a=y(o=>o.setRealtimeLoading),s=y(o=>o.setRealtimeError),n=y(o=>o.setLastRealtimeUpdate),i=y(o=>o.setHistoryData),h=y(o=>o.setHistoryLoading),b=y(o=>o.setLastHistoryUpdate),g=y(o=>o.setRefreshCallback),w=y(o=>o.setStopAutoRefresh),x=y(o=>o.historyData),R=v.useRef(!1),u=y(o=>o.cacheCleared),c=v.useCallback(o=>{const p=Array.isArray(o)?o:[],m=new Date;i(p),b(m);try{localStorage.setItem(ee,JSON.stringify({data:p,timestamp:m.toISOString()})),console.log("History cache updated")}catch(l){console.error("Failed to cache history data:",l)}},[i,b]),O=v.useCallback(async o=>{try{const p=o[0],m=o[1];if(!p||!m){console.log("Missing data for form submission");return}const l=p.CurrentFreeGroupCounterValue||0,D=p.Timestamp||"",d=m.CurrentFreeGroupCounterValue||0,f=m.Timestamp||"",S=new URLSearchParams;S.append(z.GREENDAY_VALUE,l.toString()),S.append(z.GREENDAY_TIME,D),S.append(z.UNI_VALUE,d.toString()),S.append(z.UNI_TIME,f),console.log("Submitting to Google Form:",{greenDay:{value:l,time:D},uni:{value:d,time:f}}),await fetch(Ze,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:S.toString(),mode:"no-cors"}),console.log("Form submission completed")}catch(p){console.error("Failed to submit to Google Form:",p)}},[]),j=v.useCallback(async()=>{if(u){console.log("Cache cleared â€” skipping history fetch");return}h(!0);try{const p=await(await fetch(`${Ye}&time=${Date.now()}`,{cache:"no-store"})).text();He.parse(p,{header:!0,skipEmptyLines:!0,complete:m=>{const l=ge(m.data||[]);console.log("CSV fetched, parsed, and deduplicated"),c(l),h(!1)}})}catch(o){console.error("Failed to fetch history data:",o),h(!1)}},[c,h,u]),G=v.useCallback(async o=>{try{const p=fe(o[0]),m=fe(o[1]);console.log("API timestamps:",{gd:p?.date?.toISOString(),uni:m?.date?.toISOString()});let l=ye();l.rows.length&&x.length===0&&(i(l.rows),l.timestamp&&b(new Date(l.timestamp)));const D=!p?.date||l.last.gd?.date&&p.date.getTime()<=l.last.gd.date.getTime(),d=!m?.date||l.last.uni?.date&&m.date.getTime()<=l.last.uni.date.getTime();if(l.rows.length>0&&D&&d){console.log("Fast path hit â€” cache already covers API timestamps");return}console.log("Slow path triggered â€” fetching CSV for reconciliation"),await j(),l=ye(),l.rows.length&&(i(l.rows),l.timestamp&&b(new Date(l.timestamp)));const S=p?.date?!l.last.gd?.date||p.date.getTime()>l.last.gd.date.getTime():!1,I=m?.date?!l.last.uni?.date||m.date.getTime()>l.last.uni.date.getTime():!1;if(!S&&!I){console.log("After reconciliation, no newer timestamps detected");return}const N=tt(o);for(;N.length<2;)N.push({});if(l.last.gd?.date){const T=p?.date;(!T||T.getTime()<l.last.gd.date.getTime())&&(N[0]={...N[0],Timestamp:l.last.gd.raw,CurrentFreeGroupCounterValue:l.last.gd.value??N[0].CurrentFreeGroupCounterValue??0})}if(l.last.uni?.date){const T=m?.date;(!T||T.getTime()<l.last.uni.date.getTime())&&(N[1]={...N[1],Timestamp:l.last.uni.raw,CurrentFreeGroupCounterValue:l.last.uni.value??N[1].CurrentFreeGroupCounterValue??0})}await O(N);const P=ge([...l.rows,at(N[0],N[1])]);c(P)}catch(p){console.error("Error checking history update:",p)}},[j,x.length,c,O,i,b]),U=v.useCallback(async()=>{if(u){console.log("Cache cleared â€” skipping realtime fetch");return}if(R.current){console.log("Fetch already in progress, skipping...");return}R.current=!0,a(!0),s(null);try{const o=localStorage.getItem(me);if(o)try{const l=JSON.parse(o);t(l.data),n(new Date(l.timestamp)),console.log("Real-time cache loaded")}catch(l){console.error("Failed to parse real-time cache:",l)}const p=await Promise.all(Be.map(l=>fetch(`${Je}${encodeURIComponent(l+"?time="+Date.now())}`).then(D=>D.ok?D.json():Promise.reject(`HTTP ${D.status}`))));t(p);const m=new Date;n(m);try{localStorage.setItem(me,JSON.stringify({data:p,timestamp:m.toISOString()}))}catch(l){console.error("Failed to cache real-time data:",l)}await G(p)}catch(o){console.error("Failed to fetch real-time data:",o),s(o.toString())}finally{a(!1),R.current=!1}},[t,a,s,n,G,u]);v.useEffect(()=>{const o=localStorage.getItem(ee);if(o)try{const p=JSON.parse(o);i(p.data),b(new Date(p.timestamp)),console.log("History cache loaded on mount")}catch(p){console.error("Failed to load history cache on mount:",p)}},[i,b]),v.useEffect(()=>{if(u){console.log("Cache cleared â€” skipping initial realtime fetch and auto-refresh");return}U();const o=setInterval(U,300*1e3);try{w(()=>()=>clearInterval(o))}catch(p){console.warn("Failed to register stopAutoRefresh",p)}return()=>clearInterval(o)},[U,w,u]);const M=v.useCallback(async()=>{console.log("Manual refresh triggered"),await U()},[U]);v.useEffect(()=>{g(M)},[M,g]);const L=y(o=>o.realtimeData),E=y(o=>o.realtimeLoading),q=y(o=>o.realtimeError),$=y(o=>o.lastRealtimeUpdate),F=y(o=>o.historyLoading),V=y(o=>o.lastHistoryUpdate),W={realtimeData:L,realtimeLoading:E,realtimeError:q,lastRealtimeUpdate:$,historyData:x,historyLoading:F,lastHistoryUpdate:V,refresh:M};return r.jsx(ze.Provider,{value:W,children:e})};Ce.propTypes={children:C.node.isRequired};const ae=({title:e,shortTitle:t,icon:a,onRefresh:s,updateStatus:n,currentView:i,setView:h,children:b})=>{const{isLight:g,toggleTheme:w}=Re();return r.jsxs("header",{className:"header-controls",role:"banner",children:[r.jsxs("div",{className:"header-title-group",children:[r.jsxs("h1",{children:[r.jsx("span",{className:"title-icon",role:"img","aria-label":`${e} icon`,children:a}),r.jsxs("span",{className:"title-text-full",children:[" ",e]}),r.jsxs("span",{className:"title-text-short",children:[" ",t||e]})]}),r.jsx("div",{className:"status-info",role:"status","aria-live":"polite",children:n})]}),r.jsxs("div",{className:"header-actions",role:"navigation","aria-label":"Main navigation",children:[b,(typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams).has("clear_cache")?r.jsxs("button",{className:"nav-btn",onClick:()=>we(),"aria-label":"Clear cache",children:[r.jsx("span",{className:"btn-icon",role:"img","aria-label":"Broom icon",children:"ðŸ§¹"}),r.jsx("span",{className:"btn-text",children:"Clear Cache"})]}):s?r.jsxs("button",{className:"nav-btn",onClick:s,"aria-label":"Refresh data",children:[r.jsx("span",{className:"btn-icon",role:"img","aria-label":"Refresh icon",children:"âŸ³"}),r.jsx("span",{className:"btn-text",children:"Refresh"})]}):null,i==="stats"&&r.jsxs("button",{className:"nav-btn",onClick:()=>h("dashboard"),"aria-label":"Go to dashboard",children:[r.jsx("span",{className:"btn-icon",role:"img","aria-label":"Home icon",children:"ðŸ "}),r.jsx("span",{className:"btn-text",children:"Dashboard"})]}),i==="dashboard"&&r.jsxs("button",{className:"nav-btn",onClick:()=>h("stats"),"aria-label":"Go to statistics",children:[r.jsx("span",{className:"btn-icon",role:"img","aria-label":"Chart icon",children:"ðŸ“Š"}),r.jsx("span",{className:"btn-text",children:"Statistics"})]}),r.jsx("button",{className:"theme-toggle",onClick:w,"aria-label":g?"Switch to dark theme":"Switch to light theme",children:g?"ðŸŒ™":"â˜€ï¸"})]})]})};ae.propTypes={title:C.string.isRequired,shortTitle:C.string,icon:C.string.isRequired,onRefresh:C.func,updateStatus:C.string.isRequired,currentView:C.oneOf(["dashboard","stats"]).isRequired,setView:C.func.isRequired,children:C.node};const Ne=({data:e,now:t})=>{const a=new Date(e.Timestamp.replace(" ","T")),s=Math.max(0,Math.floor((t-a)/1e3/60));let n="";s>=15?n="age-old":s>5&&(n="age-medium");let i=e.ParkingGroupName;i==="Bank_1"&&(i="Uni Wroc");const h=e.CurrentFreeGroupCounterValue||0;return r.jsxs("div",{className:"parking-card",role:"article","aria-label":`${i} parking information`,children:[r.jsx("div",{className:"parking-name",children:i}),r.jsx("div",{className:`free-spots ${n}`,"aria-label":`${h} free parking spaces`,children:h}),r.jsxs("div",{className:"age-indicator-small","aria-label":`Data from ${s} minutes ago`,children:[s," min ago"]}),r.jsxs("div",{className:"timestamp-small","aria-label":`Timestamp at ${a.toLocaleTimeString("pl-PL")}`,children:["@",a.toLocaleTimeString("pl-PL")]})]})};Ne.propTypes={data:C.shape({ParkingGroupName:C.string.isRequired,CurrentFreeGroupCounterValue:C.number,Timestamp:C.string.isRequired}).isRequired,now:C.instanceOf(Date).isRequired};const Te=({setView:e})=>{const t=y(u=>u.realtimeData),a=y(u=>u.realtimeLoading),s=y(u=>u.realtimeError),n=y(u=>u.lastRealtimeUpdate),[i,h]=v.useState(new Date);v.useEffect(()=>{const u=setInterval(()=>h(new Date),1e3);return()=>clearInterval(u)},[]);const b=t.reduce((u,c)=>u+(c.CurrentFreeGroupCounterValue||0),0),g=n?`Last update: ${n.toLocaleTimeString("pl-PL")}`:"Loading...",w=()=>{if(t.length===0)return{colorClass:"",statusMessage:"No data available"};let u=0;return t.forEach(c=>{const O=new Date(c.Timestamp.replace(" ","T")),j=Math.max(0,Math.floor((i-O)/1e3/60));u=Math.max(u,j)}),u>=15?{colorClass:"age-old",statusMessage:"Data outdated - figures may not reflect actual free spaces"}:u>5?{colorClass:"age-medium",statusMessage:"Data slightly outdated - refresh recommended"}:{colorClass:"",statusMessage:"Data is current and reliable"}},{colorClass:x,statusMessage:R}=w();return r.jsxs(r.Fragment,{children:[r.jsx(ae,{title:"Parking Monitor",icon:"ðŸ…¿ï¸",onRefresh:ve,updateStatus:g,currentView:"dashboard",setView:e}),r.jsxs("main",{className:"container-main",role:"main","aria-label":"Parking dashboard",children:[r.jsx("div",{className:"subtitle",children:"Real-time parking availability â€¢ UBS WrocÅ‚aw"}),s&&r.jsxs("div",{className:"error",role:"alert","aria-live":"polite",children:[r.jsx("strong",{children:"ERROR:"})," ",s]}),r.jsx("div",{className:"grid-container",role:"list","aria-label":"Parking facilities",children:a&&t.length===0?r.jsx("div",{className:"loader",role:"status","aria-live":"polite",children:"Loading parking data..."}):t.map((u,c)=>r.jsx(Ne,{data:u,now:i},c))}),r.jsx("div",{className:`status-description ${x}`,"aria-label":"Status description",children:R}),r.jsxs("div",{className:"status-panel",role:"complementary","aria-label":"Status information",children:[r.jsxs("div",{className:"panel-section",children:[r.jsx("div",{className:"status-label",children:"Total Spaces"}),r.jsx("div",{className:`status-value big-value ${x}`,"aria-label":`Total free spaces: ${a?"loading":b}`,children:a?"---":b})]}),r.jsxs("div",{className:"panel-section",children:[r.jsx("div",{className:"status-label",children:"Last Update / Current Time"}),r.jsxs("div",{className:"time-group",children:[r.jsx("span",{"aria-label":`Last updated at ${n?n.toLocaleTimeString("pl-PL"):"unknown"}`,children:n?n.toLocaleTimeString("pl-PL"):"--:--:--"}),r.jsx("span",{className:"status-current-inline","aria-label":`Current time ${i.toLocaleTimeString("pl-PL")}`,children:i.toLocaleTimeString("pl-PL")})]})]}),r.jsxs("div",{className:"panel-section",children:[r.jsx("div",{className:"status-label",children:"Data Status"}),r.jsx("div",{className:"status-value",style:{color:s?"var(--warning)":"var(--success)"},role:"status","aria-live":"polite",children:a?"LOADING":s?"OFFLINE":"ONLINE"})]})]})]})]})};Te.propTypes={setView:C.func.isRequired};const B={neon:{gd:"#05ffa1",uni:"#01beff"},classic:{gd:"#3b82f6",uni:"#f59e0b"},cyberpunk:{gd:"#00d9ff",uni:"#ff00cc"},modern:{gd:"#10b981",uni:"#6366f1"}},je=({setView:e})=>{const t=y(c=>c.historyData),a=y(c=>c.historyLoading),[s,n]=A.useState("neon"),[i,h]=A.useState(!1),{isLight:b}=Re(),[g,w]=v.useState({start:0,end:100}),x=v.useRef(null),R=v.useMemo(()=>{if(!t||t.length===0)return null;const c=b?"#1e293b":"#8b95c9",O=b?"#cbd5e1":"#2d3b6b",j=window.innerWidth<=600,G=new Map,U=new Map;t.forEach(d=>{const f=T=>Object.keys(d).find(_=>_.trim().toLowerCase()===T),S=f("gd_time"),I=f("greenday free"),N=f("uni_time"),P=f("uni free");if(S&&I&&d[S]&&d[I]){const T=d[S].trim(),_=parseFloat(d[I]);isNaN(_)||G.set(T,_)}if(N&&P&&d[N]&&d[P]){const T=d[N].trim(),_=parseFloat(d[P]);isNaN(_)||U.set(T,_)}});const M=d=>Array.from(d.entries()).map(([f,S])=>({t:new Date(f),v:S,raw:f})).filter(f=>!isNaN(f.t.getTime())).sort((f,S)=>f.t-S.t);let L=M(G),E=M(U);const q=d=>{const f=new Set;return d.filter(S=>{const I=`${S.raw}|${S.v}`;return f.has(I)?!1:(f.add(I),!0)})};if(L=q(L),E=q(E),L.length>0&&E.length>0){const d=L[0].t.getTime(),f=E[0].t.getTime();f<d&&(E[0].t=new Date(d),E[0].raw=L[0].raw),d<f&&(L[0].t=new Date(f),L[0].raw=E[0].raw)}const $=[...L.map(d=>d.t.getTime()),...E.map(d=>d.t.getTime())],F=$.length>0?Math.max(...$):null;let V=null;if(F){const d=L.find(S=>S.t.getTime()===F),f=E.find(S=>S.t.getTime()===F);V=(d||f)?.raw}const W=(d,f,S)=>{if(d.length===0)return{solid:[],gaps:[],projections:[]};const I=[],N=[],P=[];for(let _=0;_<d.length;_++)I.push([d[_].raw,d[_].v]);const T=d[d.length-1];return T&&f&&f-T.t.getTime()>1e3&&(P.push([T.raw,T.v]),P.push([S,T.v])),{solid:I,gaps:N,projections:P}},o=W(L,F,V),p=W(E,F,V),m=B[s],l=L.length>0?"GreenDay":"GreenDay - not found",D=E.length>0?"Uni Wroc":"Uni Wroc - not found";return{backgroundColor:"transparent",animation:!0,animationDuration:300,tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"cross"}},legend:{data:[l,D],top:5,textStyle:{color:c}},grid:{left:j?10:15,right:j?10:15,bottom:j?80:50,top:40,containLabel:!0},xAxis:{type:"time",axisLabel:{color:c,margin:10},axisLine:{lineStyle:{color:O}},splitLine:{show:!1}},yAxis:{type:"value",min:-5,max:200,splitLine:{lineStyle:{color:O,opacity:.3}},axisLabel:{color:c,formatter:d=>d<0?"":d}},dataZoom:[{type:"inside",start:g.start,end:g.end,filterMode:"none"},{type:"slider",start:g.start,end:g.end,bottom:j?40:10,height:j?30:25,textStyle:{color:c,fontSize:j?11:12},filterMode:"none",handleSize:j?"180%":"100%",borderColor:c,fillerColor:"rgba(100, 149, 237, 0.3)",dataBackground:{lineStyle:{color:c,opacity:.5},areaStyle:{color:c,opacity:.2}},moveHandleSize:j?10:7,emphasis:{handleStyle:{borderWidth:2}}}],series:[{name:l,type:"line",data:o.solid,showSymbol:i,lineStyle:{width:3,color:m.gd},itemStyle:{color:m.gd},areaStyle:{color:new re(0,0,0,1,[{offset:0,color:`${m.gd}33`},{offset:1,color:`${m.gd}00`}])},markLine:{symbol:"none",data:[{yAxis:187,lineStyle:{color:m.gd,type:"dotted",opacity:1},label:{position:"start",formatter:"187",color:m.gd,fontWeight:"bold",fontSize:13}}]}},{name:l,type:"line",data:o.gaps,showSymbol:!1,lineStyle:{width:2,color:m.gd,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:l,type:"line",data:o.projections,showSymbol:!1,lineStyle:{width:1.5,color:m.gd,type:[5,5],opacity:.5},tooltip:{show:!1}},{name:D,type:"line",data:p.solid,showSymbol:i,lineStyle:{width:3,color:m.uni},itemStyle:{color:m.uni},areaStyle:{color:new re(0,0,0,1,[{offset:0,color:`${m.uni}33`},{offset:1,color:`${m.uni}00`}])},markLine:{symbol:"none",data:[{yAxis:41,lineStyle:{color:m.uni,type:"dotted",opacity:1},label:{position:"start",formatter:"41",color:m.uni,fontWeight:"bold",fontSize:13}}]}},{name:D,type:"line",data:p.gaps,showSymbol:!1,lineStyle:{width:2,color:m.uni,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:D,type:"line",data:p.projections,showSymbol:!1,lineStyle:{width:1.5,color:m.uni,type:[5,5],opacity:.5},tooltip:{show:!1}}]}},[t,s,i,b,g]),u={datazoom:c=>{c.batch&&c.batch[0]?w({start:c.batch[0].start,end:c.batch[0].end}):c.start!==void 0&&c.end!==void 0&&w({start:c.start,end:c.end})}};return r.jsxs("div",{className:"page-wrapper",children:[r.jsx(ae,{title:"Parking History",shortTitle:"Hist",icon:"ðŸ“ˆ",onRefresh:ve,updateStatus:a?"Updating...":"Ready",currentView:"stats",setView:e,children:r.jsxs("div",{className:"palette-group",children:[r.jsx("span",{className:"palette-label",children:"Palette:"}),Object.keys(B).map(c=>r.jsx("div",{className:`palette-btn ${s===c?"active":""}`,style:{background:`linear-gradient(135deg, ${B[c].gd} 50%, ${B[c].uni} 50%)`},onClick:()=>n(c),title:c.charAt(0).toUpperCase()+c.slice(1)},c)),r.jsxs("button",{className:"palette-toggle-btn",onClick:()=>h(!i),children:["Dots: ",i?"Off":"On"]})]})}),r.jsx("main",{className:"stats-container",children:a&&t.length===0?r.jsx("div",{className:"loader",children:"Loading history data..."}):R?r.jsx(Ee,{ref:x,option:R,style:{height:"100%",width:"100%",touchAction:"none"},onEvents:u,notMerge:!1,lazyUpdate:!0,opts:{renderer:"canvas"}}):r.jsx("div",{className:"loader",children:"No data available to display."})})]})};je.propTypes={setView:C.func.isRequired};function rt(){const[e,t]=v.useState("dashboard");return r.jsx(be,{children:r.jsx(xe,{children:r.jsx(Ce,{children:e==="dashboard"?r.jsx(Te,{setView:t}):r.jsx(je,{setView:t})})})})}const st=Ae.createRoot(document.getElementById("root"));st.render(r.jsx(A.StrictMode,{children:r.jsx(rt,{})}));
