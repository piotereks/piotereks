import{r as Me,g as ie,R as O,a as N,L as ce,E as Ge}from"./vendor-echarts-nZu8rBDa.js";import{r as Ve}from"./vendor-react-BVyvVbwp.js";import{r as $e}from"./vendor-utils-F0zOxUcV.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();var te={exports:{}},q={};var ue;function He(){if(ue)return q;ue=1;var e=Me(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,n=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function c(d,l,h){var m,S={},T=null,p=null;h!==void 0&&(T=""+h),l.key!==void 0&&(T=""+l.key),l.ref!==void 0&&(p=l.ref);for(m in l)a.call(l,m)&&!o.hasOwnProperty(m)&&(S[m]=l[m]);if(d&&d.defaultProps)for(m in l=d.defaultProps,l)S[m]===void 0&&(S[m]=l[m]);return{$$typeof:t,type:d,key:T,ref:p,props:S,_owner:n.current}}return q.Fragment=r,q.jsx=c,q.jsxs=c,q}var de;function qe(){return de||(de=1,te.exports=He()),te.exports}var s=qe(),J={},pe;function We(){if(pe)return J;pe=1;var e=Ve();return J.createRoot=e.createRoot,J.hydrateRoot=e.hydrateRoot,J}var Ke=We();const ze=ie(Ke);var ae={exports:{}},re,me;function Be(){if(me)return re;me=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return re=e,re}var oe,he;function Je(){if(he)return oe;he=1;var e=Be();function t(){}function r(){}return r.resetWarningCache=t,oe=function(){function a(c,d,l,h,m,S){if(S!==e){var T=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw T.name="Invariant Violation",T}}a.isRequired=a;function n(){return a}var o={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:n,element:a,elementType:a,instanceOf:n,node:a,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:r,resetWarningCache:t};return o.PropTypes=o,o},oe}var fe;function Ye(){return fe||(fe=1,ae.exports=Je()()),ae.exports}var Ze=Ye();const w=ie(Ze);class Le extends O.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){console.error("Error caught by boundary:",t,r),this.setState({errorInfo:r})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.location.reload()};render(){return this.state.hasError?s.jsx("div",{className:"error-boundary",children:s.jsxs("div",{className:"error-content",children:[s.jsx("h1",{children:"ðŸš¨ Oops! Something went wrong"}),s.jsx("p",{className:"error-message",children:"The application encountered an unexpected error."}),this.state.error&&s.jsxs("details",{className:"error-details",children:[s.jsx("summary",{children:"Error Details"}),s.jsx("pre",{children:this.state.error.toString()}),this.state.errorInfo&&s.jsx("pre",{children:this.state.errorInfo.componentStack})]}),s.jsx("button",{onClick:this.handleReset,className:"error-reset-btn",children:"ðŸ”„ Reload Application"})]})}):this.props.children}}Le.propTypes={children:w.node.isRequired};const Ae=N.createContext(),Ie=({children:e})=>{const[t,r]=N.useState(localStorage.getItem("parking_theme")==="light");N.useEffect(()=>{t?(document.body.classList.remove("dark"),localStorage.setItem("parking_theme","light")):(document.body.classList.add("dark"),localStorage.setItem("parking_theme","dark"))},[t]);const a=()=>r(!t);return s.jsx(Ae.Provider,{value:{isLight:t,toggleTheme:a},children:e})};Ie.propTypes={children:w.node.isRequired};const _e=()=>N.useContext(Ae);var Xe=$e();const Qe=ie(Xe),ge=e=>{let t;const r=new Set,a=(h,m)=>{const S=typeof h=="function"?h(t):h;if(!Object.is(S,t)){const T=t;t=m??(typeof S!="object"||S===null)?S:Object.assign({},t,S),r.forEach(p=>p(t,T))}},n=()=>t,d={setState:a,getState:n,getInitialState:()=>l,subscribe:h=>(r.add(h),()=>r.delete(h))},l=t=e(a,n,d);return d},et=(e=>e?ge(e):ge),tt=e=>e;function at(e,t=tt){const r=O.useSyncExternalStore(e.subscribe,O.useCallback(()=>t(e.getState()),[e,t]),O.useCallback(()=>t(e.getInitialState()),[e,t]));return O.useDebugValue(r),r}const ye=e=>{const t=et(e),r=a=>at(t,a);return Object.assign(r,t),r},rt=(e=>e?ye(e):ye);var xe={"Green Day":187,"Uni Wroc":41},W=30,ot=e=>e?e==="Bank_1"?"Uni Wroc":e:"Unknown",$=(e,t=new Date)=>{if(!e)return 1/0;const r=new Date(e.replace(" ","T"));return Math.max(0,Math.floor((t-r)/1e3/60))},st=e=>{if(!Number.isFinite(e))return{display:"--",aria:"Data age unavailable"};const t=Math.max(0,Math.round(e));if(t<60){const l=`${t} min ago`,h=`Data from ${t} minute${t===1?"":"s"} ago`;return{display:l,aria:h}}if(t<1440){const l=Math.round(t/60),h=`${l} h ago`,m=`Data from ${l} hour${l===1?"":"s"} ago`;return{display:h,aria:m}}const r=t/1440,a=Math.round(r*2)/2,o=Number.isInteger(a)?a.toString():a.toFixed(1),c=`${o} d ago`,d=`Data from ${o} day${o==="1"?"":"s"} ago`;return{display:c,aria:d}},be=e=>xe[e]||xe[ot(e)],ve=(e,t,r=new Date)=>{if(!e||!t)return{approximated:null,original:null,isApproximated:!1,reason:"Missing data"};const a=$(e.Timestamp,r);if(a<W)return{approximated:e.CurrentFreeGroupCounterValue||0,original:e.CurrentFreeGroupCounterValue||0,isApproximated:!1,ageMinutes:a};const n=be(e.ParkingGroupName),o=be(t.ParkingGroupName);if(!n||!o)return{approximated:e.CurrentFreeGroupCounterValue||0,original:e.CurrentFreeGroupCounterValue||0,isApproximated:!1,ageMinutes:a,reason:"Unknown capacity"};const c=t.CurrentFreeGroupCounterValue||0,d=c/o,l=Math.round(d*n);return{approximated:l,original:e.CurrentFreeGroupCounterValue||0,isApproximated:!0,ageMinutes:a,freshRatio:d,calculation:`(${c} / ${o}) * ${n} = ${l}`}},se=null,Se=null,Ce=null,nt=(e,t=new Date)=>{if(!Array.isArray(e)||e.length===0)return[];if(e.length!==2)return e.map(m=>({...m,approximationInfo:{isApproximated:!1,original:m.CurrentFreeGroupCounterValue||0,approximated:m.CurrentFreeGroupCounterValue||0,ageMinutes:$(m?.Timestamp,t)}}));const r=e[0],a=e[1],n=$(r?.Timestamp,t),o=$(a?.Timestamp,t),c=n>=W&&o<W,d=o>=W&&n<W,l=JSON.stringify({area1Name:r?.ParkingGroupName,area1Value:r?.CurrentFreeGroupCounterValue,area1Timestamp:r?.Timestamp,area1NeedsApprox:c,area2Name:a?.ParkingGroupName,area2Value:a?.CurrentFreeGroupCounterValue,area2Timestamp:a?.Timestamp,area2NeedsApprox:d});if(Se===e&&Ce===l&&se)return se;const h=[];if(c){const m=ve(r,a,t);h.push({...r,approximationInfo:m})}else h.push({...r,approximationInfo:{isApproximated:!1,original:r?.CurrentFreeGroupCounterValue||0,approximated:r?.CurrentFreeGroupCounterValue||0,ageMinutes:n}});if(d){const m=ve(a,r,t);h.push({...a,approximationInfo:m})}else h.push({...a,approximationInfo:{isApproximated:!1,original:a?.CurrentFreeGroupCounterValue||0,approximated:a?.CurrentFreeGroupCounterValue||0,ageMinutes:o}});return Se=e,Ce=l,se=h,h},it=e=>{if(!e)return null;const t=e.includes("T")?e:e.replace(" ","T"),r=new Date(t);return Number.isNaN(r.getTime())?null:r},G={GD_TIME:"gd_time",GD_VALUE:"greenday free",UNI_TIME:"uni_time",UNI_VALUE:"uni free"},Re=e=>e?e.trim().toLowerCase():"",lt=(e,t)=>{if(!e)return null;const r=Re(t);return Object.keys(e).find(a=>Re(a)===r)||null},Q=(e,t)=>{const r=lt(e,t);if(!r)return;const a=e[r];return typeof a=="string"?a.trim():a},ct=e=>it(e),we=(e,t,r)=>{if(!e)return null;const a=Q(e,t),n=ct(a);if(!n)return null;const o=Q(e,r),c=o==null||o===""?null:Number(o);return{raw:a,date:n,value:Number.isNaN(c)?null:c}},Ne=(e=[])=>{const t=new Set,r=[];return e.forEach(a=>{const n=Q(a,G.GD_TIME)||"",o=Q(a,G.UNI_TIME)||"",c=`${n}|||${o}`;t.has(c)||(t.add(c),r.push(a))}),r},Te=e=>{if(!e||!e.Timestamp)return null;const t=e.Timestamp.trim();if(!t)return null;const r=t.includes("T")?t:t.replace(" ","T"),a=new Date(r);if(Number.isNaN(a.getTime()))return null;const n=Number(e.CurrentFreeGroupCounterValue);return{raw:t,date:a,value:Number.isNaN(n)?null:n}},ut=(e=[])=>Array.isArray(e)?e.map(t=>({...t||{}})):[],dt=(e,t)=>({[G.GD_TIME]:e?.Timestamp||"",[G.GD_VALUE]:e?.CurrentFreeGroupCounterValue??"",[G.UNI_TIME]:t?.Timestamp||"",[G.UNI_VALUE]:t?.CurrentFreeGroupCounterValue??""}),pt={log:(...e)=>console.log(...e),warn:(...e)=>console.warn(...e),error:(...e)=>console.error(...e),debug:(...e)=>console.debug(...e)},mt=(e={})=>{const{storage:t,logger:r=pt}=e;return rt((a,n)=>({realtimeData:[],realtimeLoading:!0,realtimeError:null,lastRealtimeUpdate:null,historyData:[],historyLoading:!1,lastHistoryUpdate:null,fetchInProgress:!1,refreshCallback:null,stopAutoRefresh:null,cacheCleared:!1,setRealtimeData:o=>a({realtimeData:o}),setRealtimeLoading:o=>a({realtimeLoading:o}),setRealtimeError:o=>a({realtimeError:o}),setLastRealtimeUpdate:o=>a({lastRealtimeUpdate:o}),setHistoryData:o=>a({historyData:o}),setHistoryLoading:o=>a({historyLoading:o}),setLastHistoryUpdate:o=>a({lastHistoryUpdate:o}),setFetchInProgress:o=>a({fetchInProgress:o}),setRefreshCallback:o=>a({refreshCallback:o}),setStopAutoRefresh:o=>a({stopAutoRefresh:o}),setCacheCleared:o=>a({cacheCleared:o}),updateRealtimeState:o=>a(o),updateHistoryState:o=>a(o),clearCache:async()=>{try{t&&(await t.remove("parking_realtime_cache"),await t.remove("parking_history_cache")),a({fetchInProgress:!1,cacheCleared:!0});const o=n().stopAutoRefresh;if(typeof o=="function")try{o()}catch(c){r.warn("stopAutoRefresh failed",c)}r.log("Cache cleared and auto-refresh stopped")}catch(o){r.error("clearCache failed",o)}},resetStore:()=>a({realtimeData:[],realtimeLoading:!0,realtimeError:null,lastRealtimeUpdate:null,historyData:[],historyLoading:!1,lastHistoryUpdate:null,fetchInProgress:!1,refreshCallback:null,stopAutoRefresh:null,cacheCleared:!1})}))};const V={get:async e=>{try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.error(`Failed to get item ${e} from localStorage:`,t),null}},set:async(e,t)=>{try{localStorage.setItem(e,JSON.stringify(t))}catch(r){throw console.error(`Failed to set item ${e} in localStorage:`,r),r}},remove:async e=>{try{localStorage.removeItem(e)}catch(t){throw console.error(`Failed to remove item ${e} from localStorage:`,t),t}},clear:async()=>{try{localStorage.clear()}catch(e){throw console.error("Failed to clear localStorage:",e),e}}},v=mt({storage:V,logger:console}),De=async()=>{const e=v.getState().refreshCallback;e?await e():console.warn("Refresh callback not set yet")},Fe=async()=>{try{const e=v.getState().clearCache;typeof e=="function"&&await e();const t=v.getState().stopAutoRefresh;if(typeof t=="function")try{t()}catch(r){console.warn("stopAutoRefresh failed",r)}console.log("Cache cleared and auto-refresh stopped")}catch(e){console.error("clearCache failed",e)}};typeof window<"u"&&(window.clearCache=Fe);const ht="https://corsproxy.io/?",ft=["zaparkuj.pl","docs.google.com"];function gt(e){return ft.some(t=>e.includes(t))}function yt(e){const t=e.includes("?")?"&":"?",r=`${e}${t}t=${Date.now()}`;return gt(e)?`${ht}${encodeURIComponent(r)}`:r}const ee={fetch:async(e,t={})=>{const r=yt(e);try{const a=await fetch(r,t);if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);return a}catch(a){throw console.error(`Fetch failed for ${e}:`,a),a}},fetchJSON:async(e,t={})=>{const r=await ee.fetch(e,t);try{return await r.json()}catch(a){throw console.error(`Failed to parse JSON from ${e}:`,a),a}},fetchText:async(e,t={})=>{const r=await ee.fetch(e,t);try{return await r.text()}catch(a){throw console.error(`Failed to parse text from ${e}:`,a),a}}},xt=N.createContext(),bt=["https://gd.zaparkuj.pl/api/freegroupcountervalue.json","https://gd.zaparkuj.pl/api/freegroupcountervalue-green.json"],vt="https://docs.google.com/spreadsheets/d/e/2PACX-1vTwLNDbg8KjlVHsZWj9JUnO_OBIyZaRgZ4gZ8_Gbyly2J3f6rlCW6lDHAihwbuLhxWbBkNMI1wdWRAq/pub?gid=411529798&single=true&output=csv",St="https://docs.google.com/forms/d/e/1FAIpQLSdeQ-rmw_VfOidGmtSNb9DLkt1RfPdduu-jH898sf3lhj17LA/formResponse",Y={GREENDAY_VALUE:"entry.2026993163",GREENDAY_TIME:"entry.51469670",UNI_VALUE:"entry.1412144904",UNI_TIME:"entry.364658642"},Ee="parking_realtime_cache",ne="parking_history_cache",Z={GD_TIME:"gd_time",GD_VALUE:"greenday free",UNI_TIME:"uni_time",UNI_VALUE:"uni free"},Ct=e=>{if(!e||e.length===0)return{gd:null,uni:null};const t=e[e.length-1];return{gd:we(t,Z.GD_TIME,Z.GD_VALUE),uni:we(t,Z.UNI_TIME,Z.UNI_VALUE)}},je=async()=>{const e=await V.get(ne);if(!e)return{rows:[],timestamp:null,last:{gd:null,uni:null}};try{const t=Array.isArray(e.data)?e.data:[];return{rows:t,timestamp:e.timestamp||null,last:Ct(t)}}catch(t){return console.error("Failed to parse history cache snapshot:",t),{rows:[],timestamp:null,last:{gd:null,uni:null}}}},ke=({children:e})=>{const t=v(i=>i.setRealtimeData),r=v(i=>i.setRealtimeLoading),a=v(i=>i.setRealtimeError),n=v(i=>i.setLastRealtimeUpdate),o=v(i=>i.setHistoryData),c=v(i=>i.setHistoryLoading),d=v(i=>i.setLastHistoryUpdate),l=v(i=>i.setRefreshCallback),h=v(i=>i.setStopAutoRefresh),m=v(i=>i.historyData),S=N.useRef(!1),T=v(i=>i.cacheCleared),p=N.useCallback(async i=>{const y=Array.isArray(i)?i:[],g=new Date;o(y),d(g);try{await V.set(ne,{data:y,timestamp:g.toISOString()}),console.log("History cache updated")}catch(u){console.error("Failed to cache history data:",u)}},[o,d]),U=N.useCallback(async i=>{try{const y=i[0],g=i[1];if(!y||!g){console.log("Missing data for form submission");return}const u=y.CurrentFreeGroupCounterValue||0,k=y.Timestamp||"",f=g.CurrentFreeGroupCounterValue||0,b=g.Timestamp||"",C=new URLSearchParams;C.append(Y.GREENDAY_VALUE,u.toString()),C.append(Y.GREENDAY_TIME,k),C.append(Y.UNI_VALUE,f.toString()),C.append(Y.UNI_TIME,b),console.log("Submitting to Google Form:",{greenDay:{value:u,time:k},uni:{value:f,time:b}}),await fetch(St,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:C.toString(),mode:"no-cors"}),console.log("Form submission completed")}catch(y){console.error("Failed to submit to Google Form:",y)}},[]),_=N.useCallback(async()=>{if(T){console.log("Cache cleared â€” skipping history fetch");return}c(!0);try{const i=await ee.fetchText(vt);Qe.parse(i,{header:!0,skipEmptyLines:!0,complete:y=>{const g=Ne(y.data||[]);console.log("CSV fetched, parsed, and deduplicated"),p(g),c(!1)}})}catch(i){console.error("Failed to fetch history data:",i),c(!1)}},[p,c,T]),x=N.useCallback(async i=>{try{const y=Te(i[0]),g=Te(i[1]);console.log("API timestamps:",{gd:y?.date?.toISOString(),uni:g?.date?.toISOString()});let u=await je();u.rows.length&&m.length===0&&(o(u.rows),u.timestamp&&d(new Date(u.timestamp)));const k=!y?.date||u.last.gd?.date&&y.date.getTime()<=u.last.gd.date.getTime(),f=!g?.date||u.last.uni?.date&&g.date.getTime()<=u.last.uni.date.getTime();if(u.rows.length>0&&k&&f){console.log("Fast path hit â€” cache already covers API timestamps");return}console.log("Slow path triggered â€” fetching CSV for reconciliation"),await _(),u=await je(),u.rows.length&&(o(u.rows),u.timestamp&&d(new Date(u.timestamp)));const C=y?.date?!u.last.gd?.date||y.date.getTime()>u.last.gd.date.getTime():!1,F=g?.date?!u.last.uni?.date||g.date.getTime()>u.last.uni.date.getTime():!1;if(!C&&!F){console.log("After reconciliation, no newer timestamps detected");return}const j=ut(i);for(;j.length<2;)j.push({});if(u.last.gd?.date){const L=y?.date;(!L||L.getTime()<u.last.gd.date.getTime())&&(j[0]={...j[0],Timestamp:u.last.gd.raw,CurrentFreeGroupCounterValue:u.last.gd.value??j[0].CurrentFreeGroupCounterValue??0})}if(u.last.uni?.date){const L=g?.date;(!L||L.getTime()<u.last.uni.date.getTime())&&(j[1]={...j[1],Timestamp:u.last.uni.raw,CurrentFreeGroupCounterValue:u.last.uni.value??j[1].CurrentFreeGroupCounterValue??0})}await U(j);const P=Ne([...u.rows,dt(j[0],j[1])]);p(P)}catch(y){console.error("Error checking history update:",y)}},[_,m.length,p,U,o,d]),R=N.useCallback(async()=>{if(T){console.log("Cache cleared â€” skipping realtime fetch");return}if(S.current){console.log("Fetch already in progress, skipping...");return}S.current=!0,r(!0),a(null);try{const i=await V.get(Ee);if(i)try{t(i.data),n(new Date(i.timestamp)),console.log("Real-time cache loaded")}catch(u){console.error("Failed to parse real-time cache:",u)}const y=await Promise.all(bt.map(u=>ee.fetchJSON(u)));t(y);const g=new Date;n(g);try{await V.set(Ee,{data:y,timestamp:g.toISOString()})}catch(u){console.error("Failed to cache real-time data:",u)}await x(y)}catch(i){console.error("Failed to fetch real-time data:",i),a(i.toString())}finally{r(!1),S.current=!1}},[t,r,a,n,x,T]);N.useEffect(()=>{(async()=>{const y=await V.get(ne);if(y)try{o(y.data),d(new Date(y.timestamp)),console.log("History cache loaded on mount")}catch(g){console.error("Failed to load history cache on mount:",g)}})()},[o,d]),N.useEffect(()=>{if(T){console.log("Cache cleared â€” skipping initial realtime fetch and auto-refresh");return}R();const i=setInterval(R,300*1e3);try{h(()=>()=>clearInterval(i))}catch(y){console.warn("Failed to register stopAutoRefresh",y)}return()=>clearInterval(i)},[R,h,T]);const A=N.useCallback(async()=>{console.log("Manual refresh triggered"),await R()},[R]);N.useEffect(()=>{l(A)},[A,l]);const E=v(i=>i.realtimeData),I=v(i=>i.realtimeLoading),K=v(i=>i.realtimeError),z=v(i=>i.lastRealtimeUpdate),M=v(i=>i.historyLoading),H=v(i=>i.lastHistoryUpdate),B={realtimeData:E,realtimeLoading:I,realtimeError:K,lastRealtimeUpdate:z,historyData:m,historyLoading:M,lastHistoryUpdate:H,refresh:A};return s.jsx(xt.Provider,{value:B,children:e})};ke.propTypes={children:w.node.isRequired};const le=({title:e,shortTitle:t,icon:r,onRefresh:a,updateStatus:n,currentView:o,setView:c,children:d})=>{const{isLight:l,toggleTheme:h}=_e(),m=typeof r=="string"&&(r.endsWith(".png")||r.endsWith(".svg")||r.startsWith("/")||r.startsWith("http"));return s.jsxs("header",{className:"header-controls",role:"banner",children:[s.jsxs("div",{className:"header-title-group",children:[s.jsxs("h1",{children:[m?s.jsx("img",{className:"title-icon",src:r,alt:`${e} icon`}):s.jsx("span",{className:"title-icon",role:"img","aria-label":`${e} icon`,children:r}),s.jsxs("span",{className:"title-text-full",children:[" ",e]}),s.jsxs("span",{className:"title-text-short",children:[" ",t||e]})]}),s.jsx("div",{className:"status-info",role:"status","aria-live":"polite",children:n})]}),s.jsxs("div",{className:"header-actions",role:"navigation","aria-label":"Main navigation",children:[d,(typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams).has("clear_cache")?s.jsxs("button",{className:"nav-btn",onClick:()=>Fe(),"aria-label":"Clear cache",children:[s.jsx("span",{className:"btn-icon",role:"img","aria-label":"Broom icon",children:"ðŸ§¹"}),s.jsx("span",{className:"btn-text",children:"Clear Cache"})]}):a?s.jsxs("button",{className:"nav-btn",onClick:a,"aria-label":"Refresh data",children:[s.jsx("span",{className:"btn-icon",role:"img","aria-label":"Refresh icon",children:"âŸ³"}),s.jsx("span",{className:"btn-text",children:"Refresh"})]}):null,o==="stats"&&s.jsxs("button",{className:"nav-btn",onClick:()=>c("dashboard"),"aria-label":"Go to dashboard",children:[s.jsx("span",{className:"btn-icon",role:"img","aria-label":"Home icon",children:"ðŸ "}),s.jsx("span",{className:"btn-text",children:"Dashboard"})]}),o==="dashboard"&&s.jsxs("button",{className:"nav-btn",onClick:()=>c("stats"),"aria-label":"Go to statistics",children:[s.jsx("span",{className:"btn-icon",role:"img","aria-label":"Chart icon",children:"ðŸ“Š"}),s.jsx("span",{className:"btn-text",children:"Statistics"})]}),s.jsx("button",{className:"theme-toggle",onClick:h,"aria-label":l?"Switch to dark theme":"Switch to light theme",children:l?"ðŸŒ™":"â˜€ï¸"})]})]})};le.propTypes={title:w.string.isRequired,shortTitle:w.string,icon:w.string.isRequired,onRefresh:w.func,updateStatus:w.string.isRequired,currentView:w.oneOf(["dashboard","stats"]).isRequired,setView:w.func.isRequired,children:w.node};const Pe=({data:e,now:t,allOffline:r})=>{const a=$(e.Timestamp,t),{display:n,aria:o}=st(a);let c="",d=e.ParkingGroupName;d==="Bank_1"&&(d="Uni Wroc");const l=e.approximationInfo||{},h=!!l.isApproximated,m=h?l.approximated:e.CurrentFreeGroupCounterValue||0,S=l.original||e.CurrentFreeGroupCounterValue||0;return h?a>=15?c="age-old":a>5&&(c="age-medium"):r||a>=15?c="age-old":a>5&&(c="age-medium"),s.jsxs("div",{className:"parking-card",role:"article","aria-label":`${d} parking information`,children:[s.jsx("div",{className:"parking-name",children:d}),s.jsxs("div",{className:`free-spots ${c}`,"aria-label":`${m} free parking spaces${h?" (approximated)":""}`,children:[h&&s.jsx("span",{className:"approx-indicator",title:"Approximated value",children:"â‰ˆ"}),m]}),h&&s.jsxs("div",{className:"original-value","aria-label":`Original value: ${S}`,children:["(orig: ",S,")"]}),s.jsx("div",{className:"age-indicator-small","aria-label":o,children:n})]})};Pe.propTypes={data:w.shape({ParkingGroupName:w.string.isRequired,CurrentFreeGroupCounterValue:w.number,Timestamp:w.string.isRequired,approximationInfo:w.shape({isApproximated:w.bool,approximated:w.number,original:w.number})}).isRequired,now:w.instanceOf(Date).isRequired,allOffline:w.bool.isRequired};const Ue=({setView:e})=>{const t=v(x=>x.realtimeData),r=v(x=>x.realtimeLoading),a=v(x=>x.realtimeError),n=v(x=>x.lastRealtimeUpdate),[o,c]=N.useState(new Date);N.useEffect(()=>{const x=setInterval(()=>c(new Date),1e3);return()=>clearInterval(x)},[]);const d=N.useMemo(()=>nt(t,o),[t,o]),l=d.some(x=>x.approximationInfo?.isApproximated),h=d.reduce((x,R)=>{const A=R.approximationInfo||{},E=A.isApproximated?A.approximated:R.CurrentFreeGroupCounterValue||0;return x+E},0),m=t.reduce((x,R)=>x+(R.CurrentFreeGroupCounterValue||0),0),S=n?`Last update: ${n.toLocaleTimeString("pl-PL")}`:"Loading...",T=t.length>0&&t.every(x=>{const R=new Date(x.Timestamp.replace(" ","T"));return Math.max(0,Math.floor((o-R)/1e3/60))>=1440}),p=()=>{if(d.length===0)return{colorClass:"",statusMessage:"No data available",statusIcon:null,statusLabel:""};let x=0;d.forEach(E=>{const I=$(E.Timestamp,o);x=Math.max(x,I)});let R="",A="";return T?(R="age-old",A="All parking feeds appear offline"):x>=15?(R="age-old",A="Data outdated - figures may not reflect actual free spaces"):x>5?(R="age-medium",A="Data slightly outdated - refresh recommended"):(R="",A="Data is current and reliable"),{colorClass:R,statusMessage:A}},{colorClass:U,statusMessage:_}=p();return s.jsxs(s.Fragment,{children:[s.jsx(le,{title:"Parking Monitor",icon:"ðŸ…¿ï¸",onRefresh:De,updateStatus:S,currentView:"dashboard",setView:e}),s.jsxs("main",{className:"container-main",role:"main","aria-label":"Parking dashboard",children:[s.jsx("div",{className:"subtitle",children:"Real-time parking availability â€¢ GDx WrocÅ‚aw"}),a&&s.jsxs("div",{className:"error",role:"alert","aria-live":"polite",children:[s.jsx("strong",{children:"ERROR:"})," ",a]}),s.jsx("div",{className:"grid-container",role:"list","aria-label":"Parking facilities",children:r&&t.length===0?s.jsx("div",{className:"loader",role:"status","aria-live":"polite",children:"Loading parking data..."}):d.map((x,R)=>s.jsx(Pe,{data:x,now:o,allOffline:T},R))}),s.jsx("div",{className:`status-description ${U}`,"aria-label":"Status description",children:_}),s.jsx("div",{className:"status-panel",role:"complementary","aria-label":"Status information",children:s.jsxs("div",{className:"panel-sections-wrapper",children:[s.jsxs("div",{className:"panel-section",children:[s.jsx("div",{className:"status-label",children:"Total Spaces"}),s.jsxs("div",{className:`status-value big-value ${U}`,"aria-label":`Total free spaces: ${r?"loading":h}`,children:[l&&!r&&s.jsx("span",{className:"approx-indicator-small",title:"Includes approximated values",children:"â‰ˆ"}),r?"---":h]}),l&&!r&&s.jsxs("div",{className:"original-total","aria-label":`Original total: ${m}`,children:["(orig: ",m,")"]})]}),s.jsxs("div",{className:"panel-section",children:[s.jsx("div",{className:"status-label",children:"Last Update / Current Time"}),s.jsxs("div",{className:"time-group",children:[s.jsx("span",{"aria-label":`Last updated at ${n?n.toLocaleTimeString("pl-PL"):"unknown"}`,children:n?n.toLocaleTimeString("pl-PL"):"--:--:--"}),s.jsx("span",{className:"status-current-inline","aria-label":`Current time ${o.toLocaleTimeString("pl-PL")}`,children:o.toLocaleTimeString("pl-PL")})]})]}),s.jsxs("div",{className:"panel-section",children:[s.jsx("div",{className:"status-label",children:"Data Status"}),s.jsx("div",{className:`status-value ${a?"age-old":l?"age-medium":""}`,role:"status","aria-live":"polite",children:r?"LOADING":a?"OFFLINE":l?"APPROX":"ONLINE"})]})]})})]})]})};Ue.propTypes={setView:w.func.isRequired};const X={neon:{gd:"#05ffa1",uni:"#01beff"},classic:{gd:"#3b82f6",uni:"#f59e0b"},cyberpunk:{gd:"#00d9ff",uni:"#ff00cc"},modern:{gd:"#10b981",uni:"#6366f1"}},Oe=({setView:e})=>{const t=v(p=>p.historyData),r=v(p=>p.historyLoading),[a,n]=O.useState("neon"),[o,c]=O.useState(!1),{isLight:d}=_e(),[l,h]=N.useState({start:0,end:100}),m=N.useRef(null),S=N.useMemo(()=>{if(!t||t.length===0)return null;const p=d?"#1e293b":"#8b95c9",U=d?"#cbd5e1":"#2d3b6b",_=window.innerWidth<=600,x=new Map,R=new Map;t.forEach(f=>{const b=L=>Object.keys(f).find(D=>D.trim().toLowerCase()===L),C=b("gd_time"),F=b("greenday free"),j=b("uni_time"),P=b("uni free");if(C&&F&&f[C]&&f[F]){const L=f[C].trim(),D=parseFloat(f[F]);isNaN(D)||x.set(L,D)}if(j&&P&&f[j]&&f[P]){const L=f[j].trim(),D=parseFloat(f[P]);isNaN(D)||R.set(L,D)}});const A=f=>Array.from(f.entries()).map(([b,C])=>({t:new Date(b),v:C,raw:b})).filter(b=>!isNaN(b.t.getTime())).sort((b,C)=>b.t-C.t);let E=A(x),I=A(R);const K=f=>{const b=new Set;return f.filter(C=>{const F=`${C.raw}|${C.v}`;return b.has(F)?!1:(b.add(F),!0)})};if(E=K(E),I=K(I),E.length>0&&I.length>0){const f=E[0].t.getTime(),b=I[0].t.getTime();b<f&&(I[0].t=new Date(f),I[0].raw=E[0].raw),f<b&&(E[0].t=new Date(b),E[0].raw=I[0].raw)}const z=[...E.map(f=>f.t.getTime()),...I.map(f=>f.t.getTime())],M=z.length>0?Math.max(...z):null;let H=null;if(M){const f=E.find(C=>C.t.getTime()===M),b=I.find(C=>C.t.getTime()===M);H=(f||b)?.raw}const B=(f,b,C)=>{if(f.length===0)return{solid:[],gaps:[],projections:[]};const F=[],j=[],P=[];for(let D=0;D<f.length;D++)F.push([f[D].raw,f[D].v]);const L=f[f.length-1];return L&&b&&b-L.t.getTime()>1e3&&(P.push([L.raw,L.v]),P.push([C,L.v])),{solid:F,gaps:j,projections:P}},i=B(E,M,H),y=B(I,M,H),g=X[a],u=E.length>0?"GreenDay":"GreenDay - not found",k=I.length>0?"Uni Wroc":"Uni Wroc - not found";return{backgroundColor:"transparent",animation:!0,animationDuration:300,tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"cross"}},legend:{data:[u,k],top:5,textStyle:{color:p}},grid:{left:_?10:15,right:_?10:15,bottom:_?80:50,top:40,containLabel:!0},xAxis:{type:"time",axisLabel:{color:p,margin:10},axisLine:{lineStyle:{color:U}},splitLine:{show:!1}},yAxis:{type:"value",min:-5,max:200,splitLine:{lineStyle:{color:U,opacity:.3}},axisLabel:{color:p,formatter:f=>f<0?"":f}},dataZoom:[{type:"inside",start:l.start,end:l.end,filterMode:"none"},{type:"slider",start:l.start,end:l.end,bottom:_?40:10,height:_?30:25,textStyle:{color:p,fontSize:_?11:12},filterMode:"none",handleSize:_?"180%":"100%",borderColor:p,fillerColor:"rgba(100, 149, 237, 0.3)",dataBackground:{lineStyle:{color:p,opacity:.5},areaStyle:{color:p,opacity:.2}},moveHandleSize:_?10:7,emphasis:{handleStyle:{borderWidth:2}}}],series:[{name:u,type:"line",data:i.solid,showSymbol:o,lineStyle:{width:3,color:g.gd},itemStyle:{color:g.gd},areaStyle:{color:new ce(0,0,0,1,[{offset:0,color:`${g.gd}33`},{offset:1,color:`${g.gd}00`}])},markLine:{symbol:"none",data:[{yAxis:187,lineStyle:{color:g.gd,type:"dotted",opacity:1},label:{position:"start",formatter:"187",color:g.gd,fontWeight:"bold",fontSize:13}}]}},{name:u,type:"line",data:i.gaps,showSymbol:!1,lineStyle:{width:2,color:g.gd,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:u,type:"line",data:i.projections,showSymbol:!1,lineStyle:{width:1.5,color:g.gd,type:[5,5],opacity:.5},tooltip:{show:!1}},{name:k,type:"line",data:y.solid,showSymbol:o,lineStyle:{width:3,color:g.uni},itemStyle:{color:g.uni},areaStyle:{color:new ce(0,0,0,1,[{offset:0,color:`${g.uni}33`},{offset:1,color:`${g.uni}00`}])},markLine:{symbol:"none",data:[{yAxis:41,lineStyle:{color:g.uni,type:"dotted",opacity:1},label:{position:"start",formatter:"41",color:g.uni,fontWeight:"bold",fontSize:13}}]}},{name:k,type:"line",data:y.gaps,showSymbol:!1,lineStyle:{width:2,color:g.uni,type:"dashed",opacity:.4},tooltip:{show:!1}},{name:k,type:"line",data:y.projections,showSymbol:!1,lineStyle:{width:1.5,color:g.uni,type:[5,5],opacity:.5},tooltip:{show:!1}}]}},[t,a,o,d,l]),T={datazoom:p=>{p.batch&&p.batch[0]?h({start:p.batch[0].start,end:p.batch[0].end}):p.start!==void 0&&p.end!==void 0&&h({start:p.start,end:p.end})}};return s.jsxs("div",{className:"page-wrapper",children:[s.jsx(le,{title:"Parking History",shortTitle:"Hist",icon:"ðŸ“ˆ",onRefresh:De,updateStatus:r?"Updating...":"Ready",currentView:"stats",setView:e,children:s.jsxs("div",{className:"palette-group",children:[s.jsx("span",{className:"palette-label",children:"Palette:"}),Object.keys(X).map(p=>s.jsx("div",{className:`palette-btn ${a===p?"active":""}`,style:{background:`linear-gradient(135deg, ${X[p].gd} 50%, ${X[p].uni} 50%)`},onClick:()=>n(p),title:p.charAt(0).toUpperCase()+p.slice(1)},p)),s.jsxs("button",{className:"palette-toggle-btn",onClick:()=>c(!o),children:["Dots: ",o?"Off":"On"]})]})}),s.jsx("main",{className:"stats-container",children:r&&t.length===0?s.jsx("div",{className:"loader",children:"Loading history data..."}):S?s.jsx(Ge,{ref:m,option:S,style:{height:"100%",width:"100%",touchAction:"none"},onEvents:T,notMerge:!1,lazyUpdate:!0,opts:{renderer:"canvas"}}):s.jsx("div",{className:"loader",children:"No data available to display."})})]})};Oe.propTypes={setView:w.func.isRequired};function Rt(){const[e,t]=N.useState("dashboard");return s.jsx(Le,{children:s.jsx(Ie,{children:s.jsx(ke,{children:e==="dashboard"?s.jsx(Ue,{setView:t}):s.jsx(Oe,{setView:t})})})})}const wt=ze.createRoot(document.getElementById("root"));wt.render(s.jsx(O.StrictMode,{children:s.jsx(Rt,{})}));
